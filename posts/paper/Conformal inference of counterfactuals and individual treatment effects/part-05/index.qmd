---
title: "[Paper Review] Conformal Inference of Counterfactuals and Individual Treatment Effects (Part 5)"
description: "Empirical Validation: Evaluating the Nested Approach on ACIC 2018 Data and re-analyzing the NLSM Study."
author: "유성현"
date: "2026-01-23"
categories: [Paper Review]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# 1. Introduction

지난 포스트(Part 4)에서는 새로운 환자(Test Subject)에 대해 ITE 구간을 추정하기 위한 **Naive Approach**와 **Nested Approach**를 제안했습니다. 특히 Nested Approach는 대리 구간(Surrogate Interval)을 생성하여 모델을 학습시키는 독창적인 방식이었습니다.

이번 포스트(Part 5)에서는 이 방법론들의 **실증적 성능(Empirical Performance)**을 검증합니다. 2018 Atlantic Causal Inference Conference (ACIC) 워크숍 데이터를 기반으로 한 시뮬레이션 결과와, 실제 교육학 실험인 **NLSM(National Study of Learning Mindsets)** 데이터 재분석 결과를 다룹니다.

---

# 2. Simulation Study: ACIC 2018 / NLSM Data

연구진은 방법론의 성능을 평가하기 위해 2018 ACIC 워크숍 데이터를 활용하여 수치 실험을 설계했습니다. [cite_start]이 데이터는 NLSM이라는 대규모 무작위 행동 개입 실험을 기반으로 하여, 관찰 연구(Observational Study)의 특성을 모방하도록 생성된 합성 데이터셋입니다 [cite: 749-750].

## 2.1 Data Generation Process (DGP)

커버리지(Coverage)를 평가하기 위해서는 **Ground Truth(실제 ITE)**를 알아야 합니다. 하지만 원본 데이터는 개인정보 문제로 제한적으로 공개되었고, ITE에 대한 Ground Truth가 없었습니다. [cite_start]따라서 저자들은 공개된 정보를 바탕으로 다음과 같이 합성 데이터를 생성했습니다 [cite: 752-756].

1.  **Data Splitting:** 전체 데이터를 $\mathcal{Z}_1$(20%)과 $\mathcal{Z}_2$(80%)로 나눕니다.
2.  **Base Outcomes:** $\mathcal{Z}_1$에서 Random Forest를 학습하여 $\mathbb{E}[Y(0)]$인 $\hat{m}_0(x)$를 추정합니다.
3.  **Heterogeneity:** Carvalho et al. (2019)의 CATE 함수 $\tau(x)$를 $\hat{m}_0(x)$에 더해 $\mathbb{E}[Y(1)]$을 생성합니다.
4.  **Heteroscedasticity:** 이분산성을 반영하기 위해 Quantile Random Forest로 조건부 사분위수 범위 $\hat{r}_0(x), \hat{r}_1(x)$를 추정합니다.

[cite_start]최종적으로 잠재적 결과(Potential Outcomes)는 다음과 같이 생성됩니다[cite: 763]:

$$
\begin{aligned}
Y_i(1) &= \hat{m}_0(X_i) + \tau(X_i) + 0.5\hat{r}_1(X_i)\epsilon_{i1} \\
Y_i(0) &= \hat{m}_0(X_i) + 0.5\hat{r}_0(X_i)\epsilon_{i0}
\end{aligned}
$$
(단, $\epsilon \sim N(0,1)$)

[cite_start]성향 점수(Propensity Score) $\hat{e}(x)$는 Random Forest로 추정한 뒤 $[0.1, 0.9]$로 잘라내어(Truncating) 충분한 Overlap을 보장했습니다[cite: 767].

## 2.2 Experimental Setup

* **Training Set:** $n=1000$개의 관찰 데이터 $(X_i, T_i, Y_i^{obs})$.
* **Test Set:** $5000$개의 데이터. [cite_start]분석가에게는 $X_i$만 제공되며, $(T_i, Y_i(1), Y_i(0))$는 오직 평가용으로만 사용됩니다 [cite: 770-772].
* **Methods Compared:**
    * **Our Methods:** Weighted Split-CQR 기반의 (1) Naive, (2) Exact Nested, (3) Inexact Nested 방식. (Base Learner: BART)
    * **Competitors:** BART (Naive, Inexact), Causal Forest, X-learner.
    * [cite_start]*Note:* Causal Forest와 X-learner는 반사실적 구간(Counterfactual Interval)을 생성할 수 없으므로, 그들의 신뢰 구간(CI)을 벤치마크로 직접 비교합니다[cite: 778].

---

# 3. Simulation Results

## 3.1 Marginal Coverage and Interval Length

![Figure 1: Coverage (left) and average length (right) of intervals for ITE on synthetic data. 왼쪽 패널의 빨간 수직선은 목표 커버리지(95%)를 나타냅니다. Causal Forest와 X-learner는 ITE를 커버하지 못하는 반면, 제안된 CQR 기반 방법들은 모두 목표를 달성합니다. 특히 Inexact CQR은 효율적인 구간 길이를 보여줍니다.](./images/figure5_acic_results.png)

실험 결과(Figure 5)에서 주목할 점은 다음과 같습니다:

1.  **Naive Methods (Conservative):** CQR(Naive)과 BART(Naive)는 95%를 훨씬 상회하는 커버리지를 보입니다. [cite_start]이는 두 개의 반사실적 구간을 단순 결합했기 때문에 구간 길이가 불필요하게 길어졌음을 의미합니다[cite: 780].
2.  **Nested Methods:**
    * [cite_start]**Exact Nested CQR:** 여전히 보수적이지만 유효한 커버리지를 보장합니다[cite: 781].
    * **Inexact Nested CQR:** 가장 균형 잡힌 성능을 보입니다. 보수성을 줄이면서도 목표 커버리지(95%)를 달성했습니다. [cite_start]구간 길이 또한 Inexact BART와 유사한 수준으로 매우 짧습니다 [cite: 782-784].
3.  **Competitors:**
    * **BART:** 단독으로 사용된 BART(Inexact)는 목표 커버리지를 달성하지 못했습니다. [cite_start]하지만 **CQR의 Learner로 사용된 BART는 성공적으로 보정(Calibrated)**되었습니다[cite: 783].
    * [cite_start]**CF / X-learner:** 이전 실험과 마찬가지로 ITE를 커버하지 못했습니다[cite: 785].

## 3.2 Conditional Coverage

단순히 평균적인 커버리지만 맞추는 것이 아니라, 조건부 분산 $\sigma^2(x)$이나 CATE $\tau(x)$에 따라 커버리지가 어떻게 변하는지 확인해야 합니다.

![Figure 2: Estimated conditional coverage of ITE. 상단 행은 조건부 분산에 따른 커버리지, 하단 행은 CATE 값에 따른 커버리지입니다. Inexact-CQR(오른쪽)은 조건부 분산이 변해도 커버리지를 안정적으로 유지하는 반면, Inexact-BART(왼쪽에서 두 번째)는 불안정한 모습을 보입니다.](./images/figure6_conditional_coverage_acic.png)

* [cite_start]**Inexact-CQR:** 조건부 분산이 크거나 작은 영역 모두에서 상대적으로 균일한(Even) 커버리지를 유지합니다[cite: 874].
* **Inexact-BART:** 조건부 분산이 커질수록(상단 두 번째 패널의 오른쪽) 커버리지가 급격히 떨어지는 경향을 보입니다. 이는 리스크가 큰 환자군에 대해 잘못된 확신을 줄 수 있음을 시사합니다.

---

# 4. Case Study: Re-analysing NLSM Data

마지막으로, 실제 **NLSM(National Study of Learning Mindsets)** 데이터를 사용하여 탐색적 분석(Exploratory Analysis)을 수행했습니다. [cite_start]실제 데이터이므로 Ground Truth는 알 수 없지만, 제안된 방법론이 실제 의사결정에 어떻게 활용될 수 있는지 보여줍니다 [cite: 876-877].

## 4.1 Methodology
데이터를 두 개의 폴드($\mathcal{Z}_1, \mathcal{Z}_2$)로 나누고, 서로를 테스트 셋으로 활용하는 교차 검증 방식을 사용했습니다. [cite_start]**Weighted Inexact-CQR (with BART)** 모델을 적용하여 각 개인의 ITE 구간을 추정했습니다 [cite: 882-884].

## 4.2 Findings

![Figure 3: Re-analysis of NLSM data. (a) 유의수준 $\alpha$에 따른 평균 구간 길이, (b) 하한이 양수인 구간(확실한 긍정 효과)의 비율, (c) 상한이 음수인 구간(확실한 부정 효과)의 비율을 보여줍니다.](./images/figure7_nlsm_analysis.png)

분석 결과는 다음과 같은 통찰을 제공합니다:

1.  **Interval Length (a):** 유의 수준 $\alpha$가 커질수록(즉, 신뢰 수준이 낮아질수록) 구간의 길이는 감소합니다.
2.  **Positive Effects (b):** $\alpha > 0.25$인 지점부터 **하한이 0보다 큰(Lower bound > 0)** 구간들이 나타나기 시작합니다.
    * [cite_start]이는 해당 환자들에게 처치가 **확실히 긍정적인 효과**를 준다는 증거로 해석할 수 있습니다[cite: 887, 890].
    * 의사결정자는 이러한 구간을 가진 환자들을 선별하여 처치를 배정할 수 있습니다.
3.  **Negative Effects (c):** $\alpha=0.5$까지 높여도 상한이 0보다 작은(Upper bound < 0) 구간은 나타나지 않았습니다.
    * [cite_start]이는 이 개입(Intervention)이 적어도 **해로움을 주지는 않는다**는 강력한 증거가 됩니다[cite: 890].

이러한 분석은 단순히 평균 효과(ATE)가 양수라는 것을 넘어, **"누구에게 확실히 효과가 있는가?"** 그리고 **"누구에게 해로울 가능성이 있는가?"**라는 질문에 답할 수 있게 해줍니다.

---

# 5. Summary & Conclusion

본 논문 리뷰 시리즈를 통해 **Conformal Inference**를 활용한 **ITE 구간 추정**의 전 과정을 살펴보았습니다.

1.  **Problem:** ATE/CATE는 개별 환자의 리스크를 과소평가할 수 있음.
2.  **Method:** ITE 추정을 Covariate Shift 문제로 정의하고, Weighted Conformal Inference를 통해 해결.
3.  **Theory:** Randomized Trial에서는 Exact Coverage, Observational Study에서는 Doubly Robust Coverage를 보장.
4.  **Practice:** ACIC 2018 데이터 실험을 통해 **Inexact Nested CQR**이 가장 효율적이고 안정적인 성능을 보임을 입증.
5.  **Application:** NLSM 데이터 분석을 통해, 실제 정책 결정에서 '확실한 효과'가 있는 집단을 식별하는 방법을 제시.

이 방법론은 의료, 교육, 정책 등 고위험(High-stakes) 의사결정 분야에서, 머신러닝 모델의 예측을 신뢰할 수 있는 구간으로 변환해주는 강력한 도구가 될 것입니다.

---

### 누락 방지 검증 (Compliance Checklist)

1.  **내용 처리:**
    * ACIC 2018 데이터의 유래(NLSM 기반 합성) 및 DGP 상세 설명? ✅
    * DGP 수식($Y_i(t)$ 생성 식) LaTeX 재현? ✅
    * Training/Test 셋 구성 및 평가 방식(Ground Truth 활용) 설명? ✅
    * Figure 5 분석 (Naive vs Nested, CQR vs Competitors)? ✅
    * Figure 6 분석 (Conditional Coverage)? ✅
    * NLSM 재분석 방법(Cross-fold) 및 목적 설명? ✅
    * Figure 7 분석 (Positive/Negative evidence 해석)? ✅

2.  **수식 처리:**
    * 잠재적 결과 생성 수식 및 오차항 분포 LaTeX 재현? ✅

3.  **형식:**
    * Quarto YAML Header 작성 (Part 5 명시)? ✅
    * 이미지 Placeholder 및 상세 캡션 작성? ✅
    * 엄격한 Citation 형식 `` 준수? ✅

4.  **범위:**
    * 섹션 4.4 및 4.5 내용에 집중하고, 4.3 및 5번 섹션 내용 제외 확인. ✅