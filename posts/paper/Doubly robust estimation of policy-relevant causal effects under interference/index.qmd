---
title: "[Paper Review] Doubly Robust Estimation of Policy-Relevant Causal Effects Under Interference"
description: "Philadelphia Beverage Tax 사례를 중심으로: 간섭 하에서의 이중 강건 DiD 추정 방법론"
author: "유성현"
date: "2026-02-06"
categories: [Paper Review]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
    theme: cosmo
---

# 1. Introduction

* 공공 정책(Public Policy)의 효과를 평가할 때, 연구자들은 종종 정책이 시행된 지역뿐만 아니라, 간접적으로 영향을 받는 인접 지역까지 고려해야 하는 문제에 직면합니다. 

* 대표적인 예시가 바로 2017년 필라델피아(Philadelphia)에서 시행된 가당 음료 소비세(Excise Tax on Sweetened Beverages)입니다. 이 정책은 필라델피아 내에서의 음료 판매량을 감소시켰을 뿐만 아니라, 세금이 부과되지 않는 인접 카운티(Bordering Counties)의 판매량을 증가시키는 결과를 낳았습니다. 이는 거주민들이 세금을 피하기 위해 지역 경계를 넘어 쇼핑(Cross-border shopping)을 했기 때문으로 추정되며, 이러한 현상은 정책의 순수 효과를 상쇄시킬 수 있습니다.

* 본 논문인 **"Doubly Robust Estimation of Policy-Relevant Causal Effects Under Interference"**는 이러한 **간섭(Interference)** 현상이 존재할 때, 정책 시행 지역과 인접 통제 지역에 미치는 인과 효과를 각각 분리하여 추정하기 위한 **이중 강건(Doubly Robust, DR) 이중차분(Difference-in-Differences, DiD)** 방법론을 제안합니다.

## 1.1 Motivation: The Limitation of Standard DiD

* 전통적인 인과추론 프레임워크, 특히 잠재적 결과(Potential Outcomes) 프레임워크에서 가장 중요한 가정 중 하나는 **SUTVA (Stable Unit Treatment Value Assumption)**입니다. 이는 한 개체의 잠재적 결과가 다른 개체의 처치(Treatment) 여부에 영향을 받지 않아야 함을 의미합니다.

* 하지만 필라델피아 음료 세금(PBT)과 같은 사례에서는 사람들이 세금을 피하기 위해 인접 지역으로 이동함에 따라 이 가정이 위배됩니다. 이를 무시하고 일반적인 DiD를 적용하거나, 단순히 인접 지역을 통제 집단(Control Group)으로 설정할 경우 추정량에 편향(Bias)이 발생하게 됩니다.

* 기존 연구들은 다음과 같은 한계를 가집니다:
  * 1.  **Standard TWFE (Two-Way Fixed Effects):** 처치와 결과 트렌드 간의 교란 요인이 없다는 강력한 무조건적 평행 추세(Unconditional Parallel Trends) 가정을 필요로 합니다.
  * 2.  **Observation Confounding:** 관측된 교란 변수를 보정하기 위한 기존 방법론들은 모델의 정확한 명시(Model Specification)에 의존하거나, 효과의 이질성(Heterogeneity)에 대해 엄격한 가정을 부과합니다.

## 1.2 Spillover vs. Bypass Effect

* 본 논문은 간섭(Interference)의 성격을 명확히 구분합니다. 문헌에서는 흔히 이를 'Spillover'라고 부르지만, 저자들은 이를 다음과 같이 구별하여 정의합니다.
  * **Spillover (파급 효과):** 백신 접종이 주변 사람들에게 집단 면역을 제공하는 것처럼, 처치의 효과가 직접적으로 인접 지역으로 확장되어 긍정적(혹은 추가적) 영향을 주는 경우.
  * **Bypass Effect (우회 효과):** 본 연구의 관심사입니다. 규제나 세금을 피하기 위해 개체들이 경계를 넘어가면서, 원래 의도된 정책 효과가 감소하거나 상쇄되는 현상입니다.

* 이 연구의 핵심 목표는 지리적으로 분리 가능한 그룹 간에 발생하는 이러한 Bypass Effect를 명시적으로 모델링하고 추정하는 것입니다.

## 1.3 Contribution

* 이 논문이 제안하는 방법론적 기여는 다음과 같습니다:
  * 1.  **Doubly Robust DiD:** 결과 모델(Outcome Model)이나 성향 점수 모델(Propensity Score Model) 중 하나만 맞게 명시되어도 일치 추정량(Consistent Estimator)을 제공합니다.
  * 2.  **Addressing Interference:** 지리적으로 분리된 인접 지역에 대한 간섭 효과를 명시적으로 추정합니다.
  * 3.  **Practical Adjustments:** 반복 측정(Repeated Observations), 공간적 상관관계(Spatial Correlation), 그리고 알려지지 않은 효과의 이질성(Effect Heterogeneity)을 모두 고려합니다.

---

# 2. Case Study: The Philadelphia Beverage Tax (PBT)

* 논문은 제안한 방법론을 검증하기 위해 **필라델피아 가당 음료 세금(PBT)** 데이터를 사용합니다.

## 2.1 Policy Background

* **시행일:** 2017년 1월
* **내용:** 설탕 및 인공 감미료가 포함된 음료에 대해 온스(oz)당 1.5센트의 소비세 부과.
* **목적:** 유치원 확장 및 커뮤니티 스쿨 프로그램 재원 마련, 그리고 비만 및 제2형 당뇨병과 같은 부정적 건강 결과 감소.
* **논쟁:** 2017년 1월부터 2021년 6월까지 3억 3천만 달러 이상의 수익을 창출했으나, 소매업체의 이익 손실과 경제적 부담을 이유로 폐지 논의가 존재함. 반면, 여러 연구는 판매량 감소(섭취 감소)의 긍정적 효과를 보고함.

## 2.2 Data Source & Study Design

* 연구진은 **Information Resources Inc (IRI)**에서 구매한 소매 판매 데이터를 사용했습니다.

### Time Period
* **기간:** 2016년 1월 1일 ~ 2017년 12월 31일 (2년)
* **구분:** 세금 시행 전 13개 기간(4주 단위) vs 시행 후 13개 기간

### Comparison Groups (Regions)
* 이 연구 디자인의 핵심은 **세 가지 지역**의 설정입니다.
  * 1.  **Treated Region (필라델피아):** 실제 세금이 부과된 지역.
  * 2.  **Neighboring Control Region (PA 인접 카운티):** 세금이 부과되지는 않았으나, 필라델피아 거주민들의 원정 쇼핑(Cross-border shopping)으로 인해 간섭 효과(Bypass Effect)가 발생할 것으로 예상되는 지역.
  * 3.  **Unaffected Control Region (볼티모어, MD):** 필라델피아와 인구통계학적/지리적으로 유사하지만, 거리가 멀어 직접적 세금 영향이나 간접적 간섭 효과가 없는 지역.

### Units of Analysis
* 데이터는 개별 음료의 UPC(Universal Product Code) 수준에서 제공되었으며, 이를 **상점(Store)** 단위로 집계했습니다. 상점은 소비자 구매 패턴이 다른 두 가지 카테고리로 분류되었습니다:
  * **Pharmacies:** 약국
  * **SGMs:** 슈퍼마켓(Supermarkets), 식료품점(Grocery stores), 대형 할인점(Mass merchandisers)

### Sample Size
* 총 **558개 상점**이 분석에 포함되었습니다:
  * **Philadelphia:** 180개 (약국 140, SGM 40)
  * **Bordering PA Counties:** 318개 (약국 195, SGM 123)
  * **Baltimore:** 60개 (약국 45, SGM 15)

* 추가적으로, 각 상점의 특성을 보정하기 위해 2012-2016 ACS 데이터를 바탕으로 한 **사회적 박탈 지수(Social Deprivation Index, SDI)**를 공변량으로 사용했습니다.

---

# 3 DiD methodology for causal effects on treated and neighbouring control regions

## 3.1 Exposure mapping for potential outcomes under interference

### 1. Introduction: 간섭(Interference)과 SUTVA의 위배

* 정책 평가, 특히 지역 단위의 정책을 평가할 때 가장 큰 난관 중 하나는 **간섭(Interference)** 또는 **파급 효과(Spillover Effect)**의 존재입니다.

* 본 논문에서 다루는 필라델피아 음료세(Philly Beverage Tax, PBT) 사례를 생각해 봅시다. 필라델피아 시에만 세금이 부과된다면, 경계 지역에 사는 사람들은 세금을 피하기 위해 인접한 다른 지역으로 넘어가 음료를 구매할 수 있습니다(Cross-border shopping). 이 경우, 비처치(Control) 지역의 매출은 처치(Treatment) 지역의 정책 유무에 영향을 받게 됩니다.

* 이는 인과추론의 핵심 가정인 **SUTVA(Stable Unit Treatment Value Assumption)**, 즉 "한 개체의 잠재적 결과는 다른 개체의 처치 여부에 영향을 받지 않는다"는 가정을 정면으로 위배합니다.

* 이 포스트에서는 Hettinger et al.(2025)이 제시한 방법론 중, 이러한 간섭 구조를 모형화하기 위한 첫 단계인 **Exposure Mapping(노출 매핑)**에 대해 다룹니다.

### 2. 기본 표기법 및 문제 정의 (Basic Setup)

* 먼저, 분석을 위한 기본적인 표기법(Notation)을 정의합니다.
  * **Units & Time:** $n$개의 상점(Store) $i = 1, \dots, n$이 존재하며, 시간은 정책 시행 전($t=0$)과 후($t=1$)로 나뉩니다.
  * **Covariates:** 각 상점 $i$에 대한 기저 공변량 벡터 $X_i$가 존재합니다.
  * **Treatment Assignment:**
      * $A_i \in \{0, 1\}$: 상점 $i$가 처치 그룹(예: 필라델피아)에 속하면 1, 아니면 0인 이진 지시자입니다.
      * $Z_{it} = t A_i$: 시점 $t$에서의 상점 $i$의 실제 처치 상태입니다.
          * $t=0$일 때: 모든 $i$에 대해 $Z_{i0} = 0$ (정책 시행 전이므로 모두 미처치 상태).
          * $t=1$일 때: $A_i=1$인 그룹만 처치 상태가 됨.
  * **Outcome:** $Y_{it}$는 시점 $t$에서 상점 $i$의 결과 변수(예: 음료 매출)입니다.

#### 2.1. 간섭 하에서의 잠재적 결과 (Potential Outcomes under Interference)

* 일반적인 인과추론에서는 상점 $i$의 잠재적 결과 $Y_{it}^{(z_{it})}$가 본인의 처치 상태 $z_{it}$에만 의존한다고 가정합니다. 하지만 간섭이 존재하면, 전체 모집단의 처치 벡터 $\mathbf{Z}_t = (Z_{1t}, \dots, Z_{nt})$가 개별 상점의 결과에 영향을 미칩니다.

$$
Y_{it}^{(\mathbf{z}_t)}
$$

* 문제는 가능한 처치 조합 $\mathbf{z}_t$의 경우의 수가 $2^n$개에 달한다는 점입니다. $n$이 조금만 커져도, 우리는 모든 처치 조합에 대한 잠재적 결과를 관측하는 것이 불가능합니다. 따라서 **차원을 축소(Dimensional Reduction)**하는 가정이 필수적입니다.

### 3. Exposure Mapping Framework

* 저자들은 **Aronow & Samii (2017)**가 제안한 **Exposure Mapping** 프레임워크를 도입하여 이 문제를 해결합니다.

#### 3.1. 개념적 정의

* 이 프레임워크는 전체 처치 벡터 $\mathbf{Z}_t$가 개별 유닛 $i$에게 미치는 영향을 두 가지 요소로 분해합니다.
  * 1.  **직접 효과 (Direct Effect):** 본인의 처치 상태 $Z_{it}$
  * 2.  **간접/노출 효과 (Indirect/Exposure Effect):** 다른 유닛들의 처치 상태를 요약한 함수 $b_{it}(\mathbf{Z}_t)$

* 이를 결합하여 상점 $i$의 **노출 상태(Exposure Status)** $g_{it}(\mathbf{Z}_t)$를 다음과 같이 정의합니다.

$$
g_{it}(\mathbf{Z}_t) = \begin{pmatrix} Z_{it} \\ b_{it}(\mathbf{Z}_t) \end{pmatrix}
$$

* 이제 수정된 SUTVA 가정 하에서, 잠재적 결과는 전체 벡터 $\mathbf{z}_t$가 아니라 노출 상태 $g_{it}(\mathbf{z}_t)$에만 의존한다고 가정할 수 있습니다 (Assumption A1).

$$
Y_{it}^{(\mathbf{z}_t)} = Y_{it}^{(g_{it}(\mathbf{z}_t))} \tag{A1}
$$

* 이 가정을 통해 $2^n$개의 잠재적 결과를 관리 가능한 수준으로 줄일 수 있습니다.

### 4. PBT 연구를 위한 구체적 Exposure Mapping

본*  연구의 핵심은 정책 우회(Policy Bypass) 효과를 포착하기 위해 $b_{it}(\cdot)$ 함수를 어떻게 설계했느냐에 있습니다. 저자들은 상점의 매출이 **(1) 본인의 과세 여부**와 **(2) 인접 지역의 과세 여부 불일치**에만 의존한다고 가정합니다.

#### 4.1. 노출 함수 $b_{ik}$의 정의

* 논문에서 정의한 구체적인 노출 함수는 다음과 같습니다.

$$
b_{ik}(\mathbf{Z}_t) =
\begin{cases}
1 & \text{if } Z_{ik}=0 \text{ and borders Taxed County} \\
0 & \text{if } Z_{ik}=0 \text{ and DOES NOT border Taxed County} \\
1 & \text{if } Z_{ik}=1 \text{ and DOES NOT border Untaxed County} \\
0 & \text{if } Z_{ik}=1 \text{ and borders Untaxed County}
\end{cases}
$$ {#eq-(1)}

* 이 함수는 $Z_{ik}$ (본인의 처치 상태)와 결합하여 총 4가지의 잠재적 노출 상태 $g_{it} \in \{(0,0), (0,1), (1,0), (1,1)\}$를 만들어냅니다.
  * **Control (0,0):** 본인도 세금을 안 내고, 주변도 세금을 안 냄. (순수 대조군)
  * **Neighboring Control (0,1):** 본인은 세금을 안 내지만, 바로 옆 동네는 세금을 냄. (풍선 효과로 인한 매출 증가 예상 지역)
  * **Treated (1,0):** 본인은 세금을 내고, 바로 옆 동네는 세금을 안 냄. (매출 감소 및 유출 예상 지역)
  * **Protected Treated (1,1):** 본인도 세금을 내고, 주변도 모두 세금을 냄. (도망갈 곳이 없어 유출이 적을 것으로 예상되는 지역)

#### 4.2. 실제 관측 데이터와의 매핑

* 이론적으로는 4가지 상태가 가능하지만, 실제 PBT 데이터($t=1$ 시점)에서 관측되는 그룹은 3가지입니다.

| Exposure Status $g_{i1}(\mathbf{Z}_1)$ | 의미 | 해당 지역 (PBT 연구) |
| :---: | :--- | :--- |
| **(0, 0)** | **Pure Control**<br>간섭이 없는 순수 통제 집단 | Baltimore, Non-adjacent PA counties |
| **(0, 1)** | **Neighboring Control**<br>간섭(유입)을 받는 통제 집단 | PA counties adjacent to Philadelphia (Border) |
| **(1, 0)** | **Treated**<br>간섭(유출) 위험이 있는 처치 집단 | Philadelphia stores |
| **(1, 1)** | **Protected Treated**<br>간섭으로부터 보호된 처치 집단 | *(관측되지 않음)* |

* **Pre-tax period ($t=0$):** 모든 상점은 $(0,0)$ 상태입니다.
* **Post-tax period ($t=1$):**
    * 필라델피아 상점들은 모두 경계 지역에 노출되어 있거나, 혹은 필라델피아 자체가 과세 지역으로 둘러싸여 있지 않으므로 $(1,0)$으로 간주됩니다.
    * 필라델피아와 인접한 PA 카운티 상점들은 $(0,1)$ 상태가 됩니다.
    * 멀리 떨어진 볼티모어나 비인접 PA 카운티는 $(0,0)$ 상태를 유지합니다.
    * $(1,1)$ 상태(주변이 모두 과세 지역이라 도망갈 곳이 없는 필라델피아 내의 상점 등)는 본 연구 데이터에서는 고려되지 않았거나 관측되지 않았습니다.

---

## 3.2. Policy-relevant causal estimands

### 1. Introduction: Why New Estimands?

* 전통적인 인과추론 프레임워크에서는 **SUTVA (Stable Unit Treatment Value Assumption)**를 가정합니다. 즉, 나의 결과는 타인의 처치 여부에 영향을 받지 않는다는 것입니다. 하지만 현실 세계, 특히 경제 정책의 영역에서는 이 가정이 빈번하게 위배됩니다.

* 본 논문이 다루는 **필라델피아 가당 음료세(PBT)** 사례가 대표적입니다. 특정 지역(Philadelphia)에만 세금이 부과되면, 경계 지역의 소비자들은 세금을 피하기 위해 인근의 세금이 없는 지역으로 이동하여 쇼핑(Cross-border shopping)을 할 수 있습니다.

* 이러한 **간섭(Interference)**이 존재할 때, 우리는 단순히 "처치군 vs 대조군"을 비교하는 것을 넘어, **"정책이 직접 적용된 지역(ATT)"**과 **"풍선 효과가 발생한 인접 지역(ATN)"**의 효과를 분리하여 추정해야 합니다. 본 포스트에서는 이 두 가지 핵심 추정량(Estimand)의 정의와 유도 과정을 살펴봅니다.

### 2. Mathematical Setup & Notation

* 추정량을 정의하기에 앞서, 논문에서 간섭 구조를 모델링하기 위해 도입한 표기법을 정리할 필요가 있습니다.

#### 2.1. Modified SUTVA & Exposure Mapping

* 기존 SUTVA 대신, Aronow and Samii (2017)의 **Modified SUTVA**를 채택합니다. 이는 개체의 결과가 "자신의 처치($Z_{it}$)"와 "타인의 처치 요약 함수($b_{it}$)"에만 의존한다고 가정하여 잠재 결과(Potential Outcome)의 차원을 축소하는 방식입니다.

* 각 단위 $i$의 시점 $t$에서의 **노출 상태(Exposure Status)** $g_{it}$는 다음과 같이 정의됩니다:

$$
g_{it}(Z_t) = (Z_{it}, b_{it}(Z_t))^T
$$

* 여기서 각 요소의 의미는 다음과 같습니다:
  * $Z_{it} \in \{0, 1\}$: 단위 $i$가 직접 처치(세금 부과)를 받았는지 여부.
  * $b_{it}(Z_t) \in \{0, 1\}$: 단위 $i$가 **"처치 상태가 다른 지역과 경계를 공유하는가?"** (즉, 간섭에 노출되었는가).

#### 2.2. Exposure Groups Categorization

* 이 정의에 따라 연구 대상은 총 4가지의 잠재적 노출 그룹으로 분류될 수 있습니다. 하지만 본 연구의 데이터(필라델피아)에서는 다음 3가지 그룹만 관찰됩니다.

| Exposure Status $g(A)$ | Label | Description |
| :--- | :--- | :--- |
| **(0, 0)** | **Control (Pure)** | 세금 없음 & 세금 지역과 인접하지 않음 (예: Baltimore, Non-border PA) |
| **(1, 0)** | **Treated** | 세금 부과됨 (예: Philadelphia) |
| **(0, 1)** | **Border (Neighboring Control)** | 세금 없음 & 세금 지역과 인접함 (예: PA counties adjacent to Philly) |
| *(1, 1)* | *Protected* | *세금 부과됨 & 비과세 지역과 인접하지 않음 (본 연구에서는 미관측)* |

### 3. Policy-Relevant Causal Estimands

* 이제 위에서 정의한 노출 상태를 바탕으로 두 가지 핵심 인과 추정량을 정의합니다.

#### 3.1. ATT (Average Treatment Effect on the Treated)

##### 정책적 질문 (Policy Question)
> "2017년 필라델피아 상점들의 가당 음료 판매량은, PBT(세금)가 시행되지 않았을 때와 비교하여 얼마나 변화했는가?"

##### 수식적 정의
* 이 질문은 인과추론의 고전적인 **ATT** 개념에 대응됩니다. 하지만 간섭이 존재하므로, 단순한 $A=1$ 조건이 아닌 노출 상태 $g(A)=(1,0)$에 대한 조건부 기댓값으로 정의됩니다.

$$
ATT := E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} \mid g(A)=(1,0)]
$$

* 이 수식의 의미를 단계별로 분해해 봅시다.
  * 1.  **반사실적 비교 (Counterfactual Comparison):**
      * $Y_{1}^{(1,0)}$: 실제 관측된 결과. (세금이 부과된 상태)
      * $Y_{1}^{(0,0)}$: 반사실적 결과. (만약 세금도 없고, 인근에 세금 이슈도 없었다면?)
  * 2.  **조건부 집단 (Target Population):**
      * $\mid g(A)=(1,0)$: 실제로 필라델피아(Treated)에 속한 상점들에 대한 효과만을 평균한다는 의미입니다.

##### 유도 과정과 가정
* 논문에서는 이 식을 다음과 같이 단순화하여 표현하기도 합니다.

$$
ATT := E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} \mid g(A)=(1,0)] = E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} \mid A=1]
$$ {#eq-(2)}

* **Why?**
  * 본 연구의 데이터 특성상, 처치를 받은 모든 단위($A=1$)는 노출 상태가 $(1,0)$입니다. 즉, "세금을 냈지만 국경 효과로부터 보호받는" $(1,1)$ 집단이 존재하지 않습니다. 
  * 만약 $(1,1)$ 집단이 존재했다면, ATT는 $(1,0)$ 집단과 $(1,1)$ 집단의 가중 평균으로 정의되어야 했을 것입니다.

#### 3.2. ATN (Average Treatment Effect on the Neighbouring Control)

##### 정책적 질문 (Policy Question)
> "2017년 인접 경계(Border) 지역 상점들의 가당 음료 판매량은, PBT가 시행되지 않았을 때와 비교하여 얼마나 변화했는가?"

* 이 질문은 정책의 **파급 효과(Spillover Effects)** 혹은 풍선 효과를 측정하기 위한 것입니다.

##### 수식적 정의
* 저자들은 이를 **ATN (Average Treatment Effect on the Neighbouring Control)**이라 명명하고 다음과 같이 정의합니다.

$$
ATN := E[Y_{1}^{(0,1)} - Y_{1}^{(0,0)} \mid g(A)=(0,1)]
$$ {#eq-(3)}

##### 상세 해석
* **Target Group ($g(A)=(0,1)$):** 실제로는 세금을 내지 않았지만, 세금을 내는 필라델피아 바로 옆에 위치한 상점들입니다.
* **Comparison ($Y_{1}^{(0,1)} - Y_{1}^{(0,0)}$):**
    * $Y_{1}^{(0,1)}$: (관측됨) 옆 동네에 세금이 생겼을 때의 내 매출.
    * $Y_{1}^{(0,0)}$: (반사실) 만약 옆 동네에도 세금이 없었다면 발생했을 내 매출.

* 즉, ATN은 **"단순히 옆 동네의 정책 변화로 인해 발생한 순수한 간접 효과"**를 의미합니다. 만약 $ATN > 0$라면, 필라델피아의 소비자들이 세금을 피해 경계 지역으로 넘어와 소비를 늘렸다는(Cross-border shopping) 강력한 증거가 됩니다.

---

## 3.3 Identifiability under the DiD framework

### 1. Introduction

* 일반적인 이중차분법(Difference-in-Differences, DiD)은 처치 그룹(Treated)과 통제 그룹(Control) 간의 상호작용이 없다는 SUTVA(Stable Unit Treatment Value Assumption)를 가정합니다. 
* 하지만 필라델피아 음료세(PBT)와 같은 정책 연구에서는 **간섭(Interference)**, 즉 파급 효과(Spillover effect)가 발생할 가능성이 높습니다. 예를 들어, 필라델피아 거주자가 세금을 피하기 위해 인접한 지역(Border county)으로 이동하여 음료를 구매할 수 있습니다.

* 이 논문은 이러한 간섭 구조를 반영하여 두 가지 주요 관심 효과(Estimand)를 정의하고, 이를 식별(Identification)하기 위해 필요한 가정들을 제시합니다.

### 2. Preliminaries: Estimands Recap

* 식별 전략을 논의하기 앞서, 우리가 구하고자 하는 인과 효과를 잠재적 결과(Potential Outcome) 프레임워크로 정의해 봅시다. 논문에서는 노출 그룹(Exposure Group) $g(A)$를 다음과 같이 구분합니다.
  * $g(A)=(1,0)$: **Treated (Philadelphia)** - 직접 처치를 받은 그룹
  * $g(A)=(0,1)$: **Neighboring Control (Border)** - 처치 지역에 인접하여 간섭 효과를 받는 그룹
  * $g(A)=(0,0)$: **Control (Non-border)** - 처치 지역과 멀리 떨어져 간섭이 없는 순수 통제 그룹

* 우리의 목표는 다음 두 가지 효과를 식별하는 것입니다.

#### 1) ATT (Average Treatment Effect on the Treated)
* 필라델피아(Treated) 매장들이 세금이 도입되었을 때($Y^{(1,0)}$)와 도입되지 않았을 때($Y^{(0,0)}$)의 차이입니다.

$$
ATT := E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} | g(A)=(1,0)] = E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} | A=1]
$$

#### 2) ATN (Average Treatment Effect on the Neighboring Control)
* 인접 지역(Border) 매장들이 간섭 효과를 받았을 때($Y^{(0,1)}$)와 받지 않았을 때($Y^{(0,0)}$)의 차이입니다.

$$
ATN := E[Y_{1}^{(0,1)} - Y_{1}^{(0,0)} | g(A)=(0,1)]
$$

### 3. The Identification Problem

* 인과추론의 근본적인 문제(Fundamental Problem of Causal Inference)는 우리가 특정 시점 $t$에서 단위 $i$에 대해 단 하나의 잠재적 결과만을 관측한다는 것입니다.

* **관측되는 것:**
    * 필라델피아 매장의 경우: $Y_{1}^{(1,0)}$ (세금 시행 후 실제 매출)
    * 인접 지역 매장의 경우: $Y_{1}^{(0,1)}$ (간섭 효과 하의 실제 매출)
* **관측되지 않는 것 (Counterfactuals):** [cite: 17]
    * 필라델피아 매장에 세금이 없었더라면? ($Y_{1}^{(0,0)}$)
    * 인접 지역 매장에 간섭이 없었더라면? ($Y_{1}^{(0,0)}$)

* 따라서 추가적인 가정 없이는 식별이 불가능합니다. 논문에서는 DiD 프레임워크를 확장하여 이를 해결합니다.

### 4. Identification Assumptions

* 저자들은 식별을 위해 세 가지 핵심 가정을 제시합니다. 특히 **조건부 평행 추세 가정(Conditional Parallel Trends Assumption)** 이 핵심입니다.

#### 4.1. Conditional Parallel Trends (A2 & A3)

* DiD의 핵심 가정은 "처치가 없었더라면, 처치 그룹의 결과 변수 변화 추세는 통제 그룹과 같았을 것"이라는 것입니다. 이 논문에서는 관측된 공변량 $X$를 조건부로 하여 이 가정을 완화합니다.

##### Assumption (A2): Parallel Trends for ATT
* 필라델피아(Treated) 지역과 순수 통제(Control) 지역 간의 잠재적 결과 변화량($Y_1^{(0,0)} - Y_0^{(0,0)}$)의 기댓값은 공변량 $X$가 주어졌을 때 동일해야 합니다.

$$
E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | A=1, X] = E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | g(A)=(0,0), X] \tag{A2}
$$

##### Assumption (A3): Parallel Trends for ATN
* 인접(Neighboring Control) 지역과 순수 통제(Control) 지역 간의 잠재적 결과 변화량 또한 동일해야 합니다.

$$
E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | g(A)=(0,1), X] = E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | g(A)=(0,0), X] \tag{A3}
$$

* **Why Conditional on $X$?**
  * 준실험(Quasi-experimental) 환경에서는 처치 할당이 무작위가 아니므로 교란 요인(Confounding)이 존재할 수 있습니다. $X$를 통제함으로써 관측된 교란 요인에 의한 편향을 제거합니다.

##### Violation Example
* 논문에서는 이 가정이 위배되는 구체적인 예시를 듭니다. 만약 다음 조건들이 동시에 충족된다면 평행 추세 가정은 깨집니다:
  * 1.  부유한 인구층이 세금 여부와 상관없이 건강을 위해 탄산음료 소비를 줄이는 추세이다.
  * 2.  지역별로 부의 분포가 다르다.
  * 3.  부(Wealth)에 대한 정보를 우리가 관측하지 못하거나($X$에 포함되지 않음), 부의 분포 자체가 시기별로 변한다.

#### 4.2. Other Essential Assumptions

* 평행 추세 외에도 다음 가정들이 필요합니다.
* 1.  **Consistency (일치성):** 관측된 결과 $Y_{it}$는 실제 노출 상태 $Z_t$ 하의 잠재적 결과와 같다.
    $$Y_{it} = Y_{it}^{(Z_{t})}$$
* 2.  **No Anticipation (예상 배제):** 정책 시행 전($t=0$)의 잠재적 결과는 미래의 처치 상태에 영향을 받지 않는다.
    $$Y_{i0}^{(z_{0}, z_{1})} = Y_{i0}^{(z_{0})}$$
* 3.  **Positivity (Overlap):** 공변량 $X$의 모든 값에 대해 각 노출 그룹에 속할 확률이 0보다 커야 한다. 이는 적절한 비교 대상을 찾기 위해 필수적이다.
    $$0 < P(g(A)=\gamma | X=x), \quad \forall \gamma \in \{(0,0), (0,1), (1,0)\}$$

### 5. Derivation of Identification Results

* 위의 가정들이 성립한다면, 관측 불가능했던 $ATT$와 $ATN$은 관측 가능한 데이터의 함수로 식별됩니다.

#### 5.1. Mathematical Derivation for ATT

* 우리의 목표인 $ATT$ 식을 다시 봅시다.
$$ATT = E[Y_{1}^{(1,0)} - Y_{1}^{(0,0)} | A=1]$$

* 여기서 $Y_{1}^{(1,0)}$은 관측되지만, $Y_{1}^{(0,0)}$은 반사실적(Counterfactual)입니다. 이를 식별 가능한 형태로 바꿔봅시다.

* **Step 1: 기댓값의 선형성 분해**
$$ATT = E[Y_{1}^{(1,0)} | A=1] - E[Y_{1}^{(0,0)} | A=1]$$

* **Step 2: 반사실적 항($E[Y_{1}^{(0,0)} | A=1]$) 재구성**
  * $A=1$ 그룹(Treated)의 $t=1$ 시점 반사실적 결과는, $t=0$ 시점의 결과에 '시간에 따른 자연스러운 변화량(Trend)'을 더한 것으로 생각할 수 있습니다.
$$E[Y_{1}^{(0,0)} | A=1] = E[Y_{0}^{(0,0)} | A=1] + \underbrace{E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | A=1]}_{\text{Trend under no treatment}}$$

* **Step 3: 평행 추세 가정(A2) 적용**
  * 가정 (A2)에 의해, $A=1$ 그룹의 "처치가 없었을 때의 추세"는 통제 그룹 $g(A)=(0,0)$의 추세로 대체할 수 있습니다 (공변량 $X$ 조건부 하에).
$$
\begin{aligned}
E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | A=1, X] &= E[Y_{1}^{(0,0)} - Y_{0}^{(0,0)} | g(A)=(0,0), X] \\
&= E[Y_1 - Y_0 | g(A)=(0,0), X] \quad (\because \text{Consistency})
\end{aligned}
$$

**Step 4: 최종 식 도출**
* 이를 종합하여 $X$에 대해 적분하면 논문에서 제시한 식 (29)를 얻습니다.

$$
ATT = E \Big[ \underbrace{E[Y_{1} - Y_{0} | A=1, X]}_{\text{Observed Change in Treated}} - \underbrace{E[Y_{1} - Y_{0} | g(A)=(0,0), X]}_{\text{Observed Change in Control}} \Big| A=1 \Big]
$$

#### 5.2. Mathematical Derivation for ATN

* 동일한 논리를 적용하여 $ATN$ 역시 식별 가능합니다. 여기서 비교 대상은 Neighboring Control ($g(A)=(0,1)$)과 Pure Control ($g(A)=(0,0)$)입니다.

$$
ATN = E \Big[ E[Y_{1} - Y_{0} | g(A)=(0,1), X] - E[Y_{1} - Y_{0} | g(A)=(0,0), X] \Big| g(A)=(0,1) \Big]
$$

---

## 3.4 Repeated observations

### 1. Introduction: 시점(Time)이 중요한 이유

* 정책 효과 분석, 특히 설탕세(Sugar Tax)와 같이 소비자의 구매 패턴에 영향을 미치는 정책을 분석할 때는 **시점(Time)**의 역할이 매우 중요합니다. 본 논문의 연구 환경에서는 전(Pre) 기간과 후(Post) 기간에 각각 13개의 시점이 존재합니다.

* 일반적인 이중차분법(DiD)이나 패널 데이터 분석에서는 단순히 전후 평균을 비교하거나, 모든 시점 간의 선형적 추세를 가정하곤 합니다. 하지만 음료 판매량과 같은 데이터는 **계절성(Seasonality)**이 매우 뚜렷하며, 그 패턴이 단순하지 않습니다(cyclic but complex).

* 이 섹션에서는 이러한 반복 관측(Repeated observations) 환경에서 연구자들이 어떻게 기존의 추정량(Estimator)을 강건(Robust)하게 변형하여 적용했는지, 그 논리적 흐름을 **'m-time'**이라는 개념을 통해 살펴봅니다.

### 2. Problem Setup & Notation

#### 2.1 m-time의 정의

* 논문에서는 정책 시행 후(post-tax) 기간의 관측 시점을 인덱싱하기 위해 $m$을 도입합니다.

$$
m = 1, ..., n_m
$$

* 여기서 $n_m$은 사후 기간의 총 관측 횟수입니다. 저자들은 치료 기간(Treatment period) 내의 시간 차원을 **"m-time"**이라고 명명합니다. 이를 통해 각 시점별로 데이터를 세분화하여 분석할 수 있는 기틀을 마련합니다.

#### 2.2 m-time Specific Effects

* 데이터가 $m$ 시점별로 구별되므로, 인과 효과(Causal Effect) 또한 특정 시점 $m$에 대해 정의될 수 있습니다. 이를 위해 관측치에 $m$ 아래첨자(subscript)를 추가하여 다음과 같이 정의합니다.

$$
\begin{aligned}
ATT(m) &:= E[Y_{1,m}^{(1,0)} - Y_{1,m}^{(0,0)} | A=1] \\
ATN(m) &:= E[Y_{1,m}^{(0,1)} - Y_{1,m}^{(0,0)} | g(A)=(0,1)]
\end{aligned}
$$ {#eq-(4)}

##### **ATT(Average Treatment Effect on the Treated) at time $m$**
* 처치군(Treatment Group)이 실제로 처치를 받았을 때와 받지 않았을 때의 차이입니다.

* 여기서:
  * $A=1$: 처치 그룹임을 나타냅니다.
  * $Y_{1,m}^{(1,0)}$: 사후 기간($t=1$), 시점 $m$에서 처치를 받았을 때($g(A)=(1,0)$)의 잠재적 결과(Potential Outcome)
  * $Y_{1,m}^{(0,0)}$: 사후 기간($t=1$), 시점 $m$에서 처치를 받지 않았을 때($g(A)=(0,0)$)의 잠재적 결과

##### **ATN(Average Treatment Effect on the Neighbours) at time $m$**
* 간섭(Interference) 효과를 측정하기 위한 지표로, 인접 통제군(Neighbouring Control Group)에 대한 파급 효과입니다.

* 여기서 $g(A)=(0,1)$은 "나는 처치를 받지 않았으나($0$), 이웃이 처치를 받은($1$)" 상태를 의미합니다.

#### 2.3 Aggregated Effects (종합 효과)

* 개별 시점의 효과도 중요하지만, 정책의 전반적인 영향을 파악하기 위해서는 이를 요약할 필요가 있습니다. 논문에서는 단순히 각 $m$ 시점의 효과를 평균(Average)하여 전체 효과를 정의합니다.

$$
\begin{aligned}
ATT &:= \frac{1}{n_{m}}\sum_{m=1}^{n_{m}} ATT(m) \\
ATN &:= \frac{1}{n_{m}}\sum_{m=1}^{n_{m}} ATN(m)
\end{aligned}
$$ {#eq-(4)}

* 이러한 접근은 특정 시점에 국한되지 않고, 정책 시행 기간 전체에 걸친 평균적인 효과를 추정하게 해줍니다.

### 3. Identification Strategy: 계절성을 고려한 평행 추세

* 이 논문의 핵심적인 기여 중 하나는 **평행 추세 가정(Parallel Trends Assumption)을 어떻게 설정했는가**에 있습니다.

#### 3.1 Data Structure Consideration
* 연구 데이터는 4주(4-week) 간격으로 관측되며, 2016년(Pre)과 2017년(Post)의 **동일한 달력 시점(Calendar time)**에 매칭됩니다. 즉, $n_m$개의 쌍(pair)이 존재합니다.

#### 3.2 Seasonal Parallel Trends vs. Sequential Parallel Trends

* 일반적인 DiD 연구(Callaway & Sant'Anna, 2021 등)에서는 시간의 흐름에 따른 연속적인 평행 추세를 가정합니다. 하지만 본 연구에서는 이를 완화하여 **"순차적인 연도(Sequential years)의 유사한 시점(Similar time points) 간의 평행 추세"**를 가정합니다.

#### 3.3 Why this approach?
* 음료 판매량은 계절에 따라 등락이 심하며(cyclic), 그 패턴이 지역마다 복잡하게 나타납니다. 따라서 계절 간의 변화량까지 맞추라고 요구하는 것은 지나치게 엄격한 가정일 수 있습니다. 대신, **"작년 이맘때와 올해 이맘때"**를 비교함으로써 계절성으로 인한 편향(Bias)을 자연스럽게 제거(differencing out)하는 전략을 취합니다.

---

## 3.5 DiD estimators for the ATT(m) and ATN(m)

### 3.5.1 Two-way gxed effects

#### 1. Introduction

* 패널 데이터 분석에서 인과 효과를 추정하기 위해 가장 널리 사용되는 방법론 중 하나는 **이중차분법(Difference-in-Differences, DiD)**입니다. 본 포스트에서는 Hettinger et al.의 논문 섹션 3.5.1을 바탕으로, **이원 고정 효과(Two-way Fixed Effects, TWFE)** 모델의 구조를 수식적으로 분석하고, 이것이 고전적인 평균 차이(Difference-in-Means, DIM) 추정량과 어떻게 연결되는지 살펴봅니다.

* 또한, Table 1에 제시된 여러 추정량(Estimator)들의 가정을 비교함으로써, TWFE가 가지는 '동질적 처치 효과(Homogeneous effects)' 가정의 한계와 이를 완화하기 위한 확장에 대해 논의합니다.

#### 2. Key Concepts & Notation

* **수정된 SUTVA(Stable Unit Treatment Value Assumption)** 하에서 $ATT(m)$(Average Treatment Effect on the Treated)과 $ATN(m)$(Average Treatment Effect on the Neighbour)을 추정하는 방법론을 다룹니다.

* 분석을 위한 기본적인 표기법(Notation)은 다음과 같습니다.
  * **$i$**: 개별 유닛 (Unit)
  * **$t$**: 시간 (Time)
  * **$m$**: 관심 있는 특정 노출(Exposure) 그룹
  * **$R_{im}$**: 노출 그룹에 대한 할당을 나타내는 이진 지시자(Binary Indicator).
      * $R_{im} = 1$: 처치 그룹 (ATT 비교 시)
      * $R_{im} = 0$: 통제 그룹
  * **$Z'_{itm} = t R_{im}$**: 시점 $t$에서의 처치 상태를 나타내는 지시자. (일종의 Interaction term)

* 이 설정은 기본적으로 **Longitudinal Panel Data**를 가정하고 있으며, SUTVA 가정 하에 추론이 진행됩니다.

#### 3. Two-way Fixed Effects (TWFE) Model

##### 3.1. Linear Outcome Model

* 가장 흔히 적용되는 TWFE 접근법은 결과를 선형 모델로 가정하는 것에서 출발합니다. 논문의 식 $(6)$은 다음과 같이 정의됩니다.

$$
Y_{itm} = \alpha_{0m} + \boldsymbol{\beta}_m^{'} \mathbf{X}_{im} + \alpha_{1m}t + \alpha_{2m}R_{im} + \tau^{fe}_m Z'_{itm} + \epsilon_{itm}
$$ {#eq-(6)}

* 이 식의 각 구성 요소는 다음과 같은 의미를 가집니다.
  * **$Y_{itm}$**: 결과 변수 (Outcome)
  * **$\alpha_{0m}$**: 절편 (Intercept)
  * **$\boldsymbol{\beta}_m^{'} \mathbf{X}_{im}$**: 시간 불변 공변량(Time-invariant covariates) $\mathbf{X}_{im}$에 의한 효과. (고정 효과 모델에서는 개체 고정 효과 $\alpha_i$로 흡수될 수 있음)
  * **$\alpha_{1m}t$**: 시간 고정 효과 (Time Fixed Effect). 시간이 흐름에 따라 변하는 공통적인 트렌드를 포착합니다.
  * **$\alpha_{2m}R_{im}$**: 그룹 고정 효과 (Group Fixed Effect). 처치 그룹과 통제 그룹 간의 내재적인 차이를 포착합니다.
  * **$\tau^{fe}_m Z'_{itm}$**: **관심 있는 인과 효과 (Estimand).** 여기서 $Z'_{itm} = t \times R_{im}$이므로, $\tau^{fe}_m$은 처치 시점 이후 처치 그룹에 추가적으로 발생하는 효과를 의미합니다.
  * **$\epsilon_{itm}$**: 오차항. 유닛 $i$ 내에서 상관관계(Correlated within unit $i$)를 가질 수 있습니다 (Cluster-Robust Standard Errors 필요).

##### 3.2. Simplified Setting: Equivalence to DIM

* 논문에서는 이해를 돕기 위해 **두 개의 기간(Pre, Post), 두 개의 그룹(Treated, Control)**이 있는 단순화된 설정을 제시합니다. 이 경우, TWFE 추정량 $\hat{\tau}^{fe}_m$은 고전적인 **Difference-in-Means (DIM) DiD 추정량**과 수학적으로 동일합니다.

* 이를 수식으로 유도해 보겠습니다.

* 1.  **기대값 정의 ($\mathbb{E}$는 표본 평균을 의미)**
    * **처치 그룹 ($R_{im}=1$), 사후 시점 ($t=1$):**
        $$\mathbb{E}[Y_{1m} | R_m=1] = \alpha_{0m} + \boldsymbol{\beta}_m \mathbf{X} + \alpha_{1m} + \alpha_{2m} + \tau^{fe}_m$$
    * **처치 그룹 ($R_{im}=1$), 사전 시점 ($t=0$):**
        $$\mathbb{E}[Y_{0m} | R_m=1] = \alpha_{0m} + \boldsymbol{\beta}_m \mathbf{X} + \alpha_{2m}$$
        * Note: $t=0$이므로 $\alpha_{1m}t$와 $\tau^{fe}_m Z'_{itm}$ 항이 소거됨

    * **처치 그룹의 전후 차이:**
        $$\mathbb{E}[Y_{1m} - Y_{0m} | R_m=1] = \alpha_{1m} + \tau^{fe}_m$$

* 2.  **통제 그룹 ($R_{im}=0$)의 경우**
    * **통제 그룹 ($R_{im}=0$), 사후 시점 ($t=1$):**
        $$\mathbb{E}[Y_{1m} | R_m=0] = \alpha_{0m} + \boldsymbol{\beta}_m \mathbf{X} + \alpha_{1m}$$
    * **통제 그룹 ($R_{im}=0$), 사전 시점 ($t=0$):**
        $$\mathbb{E}[Y_{0m} | R_m=0] = \alpha_{0m} + \boldsymbol{\beta}_m \mathbf{X}$$
    
    * **통제 그룹의 전후 차이:**
        $$\mathbb{E}[Y_{1m} - Y_{0m} | R_m=0] = \alpha_{1m}$$

* 3.  **Difference-in-Differences (이중차분)**
    처치 그룹의 전후 차이에서 통제 그룹의 전후 차이를 뺍니다.
    $$
    (\alpha_{1m} + \tau^{fe}_m) - (\alpha_{1m}) = \tau^{fe}_m
    $$

* 따라서, TWFE 계수 추정량은 다음과 같은 DIM 추정량과 같습니다.

$$
\hat{\tau}^{fe}_m = \mathbb{E}[Y_{1m} - Y_{0m} | R_m = 1] - \mathbb{E}[Y_{1m} - Y_{0m} | R_m = 0]
$$

* 이 등식이 성립하기 위해서는 **반사실적 평행 추세(Counterfactual Parallel Trends)** 가정이 **무조건적(Unconditionally)**으로 성립해야 합니다. 즉, 공변량 조절 없이도 두 그룹의 잠재적 결과(Potential Outcomes) 추세가 동일해야 합니다 (Angrist & Pischke, 2009).

#### 4. Assumption Check & Extensions

* 논문은 TWFE 모델의 한계와 이를 극복하기 위한 확장 모델들을 Table 1과 함께 설명합니다.

| Estimator | Parallel Trends (A2-A3) | Homogeneous Effects across X | Model Specification Requirements |
| :--- | :--- | :--- | :--- |
| **DIM** (Difference-in-Means) | Unconditional | No | None |
| **TWFE(adj)** (Two-Way Fixed Effects) | Conditional | **Yes** | Correct outcome model |
| **OR** (Outcome Regression) | Conditional | No | Correct outcome model |
| **IPW** (Inverse Probability Weighting) | Conditional | No | Correct treatment model |
| **DR** (Doubly Robust) | Conditional | No | Correct outcome **OR** treatment model |

* **Note**: 모든 추정량은 수정된 SUTVA 가정을 전제로 하며, 블록(Block) 단위의 군집(Cluster) 구조를 올바르게 명시해야 유효한 추론이 가능합니다.

##### 4.1. The Risk of Homogeneous Effects

* Table 1의 `TWFE(adj)` 행을 보면, **Homogeneous effects across X: Yes** 라고 명시되어 있습니다. 이는 TWFE 모델이 처치 효과가 모든 개체나 공변량 수준에서 일정하다고 가정함을 의미합니다.

* **문제점:** 만약 처치 효과가 이질적(Heterogeneous)이라면, 즉 $\mathbf{X}$에 따라 처치 효과가 달라진다면, 엄격한 모수적 가정(Strict parametric assumptions)을 하는 TWFE는 편향(Bias)된 추정치를 낳을 수 있습니다.
* **참고 문헌:** 이러한 편향의 위험성은 Abadie (2005)와 de Chaisemartin & D’Haultfoeuille (2022) 등 최근 계량경제학 문헌에서 지적된 바 있습니다.

##### 4.2. Relaxing Parallel Trends ($TWFE^{(adj)}$)

* 연구자들은 무조건적 평행 추세 가정을 완화하기 위해, 교란 요인(Confounder)들이 사전/사후 결과에 차별적인 영향을 미칠 수 있도록 허용하는 확장된 모델을 사용하기도 합니다.

* 식 $(6)$의 $\boldsymbol{\beta}_m^{'} \mathbf{X}_{im}$ 항을 다음과 같이 변경합니다.

$$
\boldsymbol{\beta}_m^{'} \mathbf{X}_{im} \rightarrow \boldsymbol{\beta}_{0m}^{'} \mathbf{X}_{im} + t \boldsymbol{\beta}_{1m}^{'} \mathbf{X}_{im}
$$

* **의미:** 공변량 $\mathbf{X}_{im}$의 효과가 시간 $t$에 따라 변할 수 있음($t \boldsymbol{\beta}_{1m}^{'}$)을 허용합니다.
* **효과:** 이를 통해 **Conditional Parallel Trends** 가정 하에서 추정량을 구할 수 있게 되며, 이는 시간 가변적 교란(Time-varying confounding)이 존재하는 상황에서 편향을 줄이는 데 도움을 줍니다. 이를 논문에서는 $TWFE^{(adj)}$라고 지칭합니다.

---

### 3.5.2 OR estimators

#### 1. Introduction

* 전통적인 이중차분법(DID)이나 Two-Way Fixed Effects (TWFE) 모델은 평행 추세 가정(Parallel Trends Assumption)에 의존하여 이 반사실적 상황을 추정합니다. 하지만 최근 연구들은 TWFE가 처치 효과의 이질성(Heterogeneity)이 존재할 때 편향될 수 있음을 지적합니다.

* 이번 포스트에서는 이러한 문제의 대안으로 제시되는 **OR(Outcome Regression) Estimators**를 다룹니다. 이 방법론은 통제 집단의 데이터를 활용해 결과 변수의 동태(Outcome Dynamics)를 직접 모델링하고, 이를 통해 처치 집단의 반사실적 추세를 임퓨테이션(Imputation)하는 방식입니다.

#### 2. Motivation: Imputation Approach

* 기존의 방법론들과 달리, OR 추정량은 **"결측치 대체(Imputation)"**의 관점에서 인과 효과를 바라봅니다.

* **관측된 데이터(Observed):** 처치 집단($R_m=1$)의 처치 후 결과 변화.
* **결측된 데이터(Missing):** 처치 집단이 처치를 받지 않았을 경우 겪었을 결과 변화.

* OR 추정량은 통제 집단(Control Group)의 정보를 활용하여, 처치 집단이 겪었을 '처치 없는 상태의 변화'를 예측 모델링합니다. 이는 **Heckman et al. (1997)**이 ATT(Average Treatment Effect on the Treated)를 추정하기 위해 처음 개발한 방법론을 확장한 것입니다.

#### 3. Mathematical Formulation

* OR 추정량을 이해하기 위해서는 먼저 **반사실적 추세(Counterfactual Outcome Trends)**를 정의하는 함수 $\mu_{\Delta, m}(\mathbf{X})$를 이해해야 합니다.

##### 3.1. Modeling Outcome Dynamics

* 우리는 처치 집단($R_m=1$)의 잠재적 결과를 예측하기 위해, 처치를 받지 않은 통제 집단($g(\mathbf{A})=(0,0)$)의 데이터만을 사용하여 공변량 $\mathbf{X}_m$과 결과 변수 변화량($Y_{1m} - Y_{0m}$) 사이의 관계를 모델링합니다.

* 이를 수식으로 정의하면 다음과 같습니다:
$$
\mu_{\Delta, m}(\mathbf{X}) = \mathbb{E}[Y_{1m} - Y_{0m} \mid g(\mathbf{A}) = (0, 0), \mathbf{X}_m]
$$
  * $\mu_{\Delta, m}(\mathbf{X})$: 공변량 $\mathbf{X}$가 주어졌을 때, 통제 집단에서 기대되는 결과 변수의 변화량(Trend).
  * $Y_{1m} - Y_{0m}$: 시점 $0$(Pre)에서 시점 $1$(Post)로의 결과 변수 변화.
  * $g(\mathbf{A}) = (0, 0)$: 두 시점 모두에서 처치를 받지 않은 순수 통제 집단(Clean Control Group).

* 이 함수는 **"공변량 $\mathbf{X}$를 가진 개체가 처치를 받지 않았을 때, 시간이 지남에 따라 결과가 얼마나 변하는가?"**를 나타냅니다.

##### 3.2. The OR Estimator Definition

* 위에서 학습한 모델 $\hat{\mu}_{\Delta, m}(\mathbf{X})$를 처치 집단($R_m=1$)에 적용(Plug-in)하면, 처치 집단의 반사실적 변화량을 추정할 수 있습니다.

* 따라서, **OR 추정량($\hat{\tau}_m^{or}$)**은 다음과 같이 정의됩니다:

$$
\hat{\tau}_m^{or} = \mathbb{E}[(Y_{1m} - Y_{0m}) - \hat{\mu}_{\Delta, m}(\mathbf{X}_m) \mid R_m = 1]
$$ {#eq-(7)}

* 이 수식의 의미를 직관적으로 분해해보면 다음과 같습니다:
  * 1.  **$(Y_{1m} - Y_{0m})$**: 처치 집단에서 실제로 관측된 전후 변화량.
  * 2.  **$\hat{\mu}_{\Delta, m}(\mathbf{X}_m)$**: 처치 집단의 특성($\mathbf{X}_m$)을 고려했을 때, 만약 처치를 받지 않았다면 겪었을 것으로 예측되는 변화량.
  * 3.  **차이(Difference)**: 이 둘의 차이가 곧 순수한 처치 효과(ATT)가 됩니다.

#### 4. Comparison: OR vs. TWFE

* 이 논문(섹션 3.5.2)에서는 OR 추정량을 기존의 TWFE 모델과 명확하게 대조하고 있습니다. 그 차이점은 데이터 사용 방식과 모델의 유연성에 있습니다.

| 구분 | TWFE (Two-Way Fixed Effects) | OR (Outcome Regression) |
| :--- | :--- | :--- |
| **데이터 활용** | 전체 데이터(처치군 + 대조군)를 모두 사용하여 단일 모델 추정 | **오직 통제 집단(Control Group)** 데이터만 사용하여 $\hat{\mu}_{\Delta, m}$ 추정 |
| **가정** | 처치 효과의 동태(Dynamics)에 대한 가정 필요 (주로 상수 효과) | 처치 효과의 동태를 명시할 필요 없음 (Avoid specifying treatment effect dynamics) |
| **모델 유연성** | 선형 회귀(Linear Regression) 기반 | 표준 선형 회귀보다 **더 유연한 모델(Flexible Models)** 사용 가능 (예: Random Forest, Boosting 등) |

##### 핵심 장점
* OR 방식의 가장 큰 장점은 **처치 효과의 동태를 모델링할 필요가 없다**는 점입니다. $\hat{\mu}_{\Delta, m}$를 추정할 때 통제 집단만 사용하기 때문에, 처치 집단 내에 존재할 수 있는 복잡한 처치 효과의 패턴이 베이스라인 추세 추정을 오염(Contamination)시키지 않습니다.

##### 핵심 한계 (Caveat)
* 공변량 $\mathbf{X}$와 결과 변화 사이의 관계를 잘못 모델링(Misspecification)할 경우, 추정된 반사실적 추세가 틀리게 되고, 결과적으로 인과 효과 추정치 전체가 편향될 수 있습니다.

---

### 3.5.3 Inverse probability weighting estimators

#### 1. Introduction: 결과 모델링을 넘어서

* 인과추론에서 처치 효과(Treatment Effect)를 추정하는 전통적인 방식 중 하나는 결과 변수(Outcome)의 생성 과정을 직접 모델링하는 것입니다(Outcome Dynamics Modelling). 하지만 이 섹션에서는 다른 접근법인 **역확률 가중치(Inverse Probability Weighting, IPW)** 기법을 소개합니다.

* IPW의 핵심 아이디어는 **가중치(Weighting)**를 사용하여 처치군(Exposed/Treated)과 대조군(Control) 사이의 교란 요인(Confounder) 불균형을 맞추는 것입니다. 이를 통해 관찰 연구(Observational Study) 데이터를 마치 무작위 배정 실험(Randomized Controlled Trial) 데이터처럼 보정할 수 있습니다.

* 본 포스트에서는 Abadie (2005)가 제안한 **Semiparametric IPW Estimator**를 중심으로, 패널 데이터 환경에서 **ATT(Average Treatment Effect on the Treated)**를 추정하는 수식적 배경과 그 의미를 살펴봅니다.

#### 2. Core Concepts: 성향 점수와 가중치

##### 2.1 Propensity Score (성향 점수)

* IPW 추정량의 핵심은 성향 점수(Propensity Score)입니다. 성향 점수는 공변량($\mathbf{X}$)이 주어졌을 때, 해당 관측치가 처치(Exposure of interest)에 할당될 확률로 정의됩니다.

* 이 논문에서는 특정 시점 혹은 그룹 $m$에서의 성향 점수 $\pi_{r,m}(\mathbf{X})$를 다음과 같이 정의합니다:
$$
\pi_{r,m}(\mathbf{X}) = P(R_m = 1 \mid \mathbf{X}_m)
$$
  * $R_m \in \{0, 1\}$: 처치 여부를 나타내는 지시 변수 (1: 처치, 0: 통제)
  * $\mathbf{X}_m$: 공변량 벡터

##### 2.2 Abadie (2005)의 가중치 (The Weights)

* Abadie (2005)는 **ATT(처치군에 대한 평균 처치 효과)**를 추정하기 위해 특별한 형태의 가중치를 제안합니다. 패널 데이터(Panel Data) 환경에서 개별 관측치 $i$와 시점 $m$에 대한 가중치 $w_{im}(\mathbf{X}_{im})$은 다음과 같이 계산됩니다:

$$
w_{im}(\mathbf{X}_{im}) = \frac{R_{im} - \pi_{r,m}(\mathbf{X}_{im})}{P(R_{im}=1)(1 - \pi_{r,m}(\mathbf{X}_{im}))}
$$

* 이 수식은 일반적인 ATE(Average Treatment Effect)를 구할 때 사용하는 IPW 가중치($\frac{R}{e} + \frac{1-R}{1-e}$)와는 형태가 다릅니다. 이 가중치가 어떻게 ATT를 도출해내는지에 대한 증명은 아래에서 자세히 다룹니다.

##### 2.3 IPW Estimator

* 위에서 구한 가중치를 사용하여 인과 효과($\hat{\tau}_m^{ipw}$)를 추정하는 식은 다음과 같이 표현됩니다:
$$
\hat{\tau}_m^{ipw} = \mathbb{E}[\hat{w}_m(\mathbf{X}_{im})(Y_{1m} - Y_{0m})]
$$ {#eq-(8)}
  * 기댓값 $\mathbb{E}$는 처치군과 대조군을 모두 포함한 전체 연구 모집단(Study Population)에 대한 표본 평균(Empirical Mean)을 의미합니다.
  * $Y_{1m}, Y_{0m}$: 잠재적 결과(Potential Outcomes).

#### 3. Mathematical Derivation: 가중치의 작동 원리

* 논문에서는 결과 식만 제시되어 있지만, 왜 $w_{im}$ 가중치가 ATT를 추정하게 되는지 단계별로 유도해 보겠습니다. 이해를 돕기 위해 시점 $m$ 표기를 생략하고 일반적인 확률 변수 관점에서 서술합니다.

* 우리가 구하고자 하는 목표는 **ATT**입니다:
$$
\tau_{ATT} = \mathbb{E}[Y_1 - Y_0 \mid R=1]
$$

##### Step 1: 가중치 기댓값의 전개

* 가중치 $w$와 결과변수 $Y$의 곱에 대한 기댓값 $\mathbb{E}[wY]$를 살펴봅시다. 여기서 $Y$는 관측된 결과($Y = R Y_1 + (1-R) Y_0$)입니다.
상수항인 분모의 $P(R=1)$을 $\rho$라고 편의상 치환하겠습니다.

$$
\mathbb{E}[wY] = \mathbb{E} \left[ \frac{R - \pi(X)}{\rho (1 - \pi(X))} Y \right]
$$

* 전체 기댓값의 법칙(Law of Iterated Expectations)을 사용하여 $X$에 대해 먼저 조건부 기댓값을 취합니다.

$$
= \mathbb{E}_X \left[ \mathbb{E} \left[ \frac{R - \pi(X)}{\rho (1 - \pi(X))} Y \Bigg| X \right] \right]
$$

##### Step 2: 조건부 기댓값 내부 계산

* 내부의 $\mathbb{E}[\cdot|X]$ 항을 계산해 봅시다. $X$가 고정되었으므로 $\pi(X)$는 상수 취급됩니다.

$$
\text{Inside} = \frac{1}{\rho(1-\pi)} \left( \mathbb{E}[R Y \mid X] - \pi \mathbb{E}[Y \mid X] \right)
$$

* 여기서 두 가지 성질을 이용합니다:
  * 1.  $\mathbb{E}[R Y \mid X] = 1 \cdot \mathbb{E}[Y_1 \mid X] \cdot P(R=1|X) = \pi \mu_1(X)$
  * 2.  $\mathbb{E}[Y \mid X] = \pi \mu_1(X) + (1-\pi) \mu_0(X)$
      * ($\mu_1(X) = \mathbb{E}[Y_1|X]$, $\mu_0(X) = \mathbb{E}[Y_0|X]$)

* 이를 대입하면:

$$
\begin{aligned}
\text{Numerator} &= \pi \mu_1 - \pi \{ \pi \mu_1 + (1-\pi) \mu_0 \} \\
&= \pi \mu_1 - \pi^2 \mu_1 - \pi(1-\pi) \mu_0 \\
&= \pi(1-\pi)\mu_1 - \pi(1-\pi)\mu_0 \\
&= \pi(1-\pi)(\mu_1 - \mu_0)
\end{aligned}
$$

##### Step 3: 최종 정리

* 이제 다시 전체 식에 대입합니다. $\rho(1-\pi)$ 분모와 약분되는 것을 볼 수 있습니다.

$$
\begin{aligned}
\mathbb{E}[wY] &= \mathbb{E}_X \left[ \frac{\pi(X)(1-\pi(X))(\mu_1(X) - \mu_0(X))}{\rho (1-\pi(X))} \right] \\
&= \mathbb{E}_X \left[ \frac{\pi(X)}{\rho} (\mu_1(X) - \mu_0(X)) \right] \\
&= \mathbb{E}_X \left[ \frac{P(R=1|X)}{P(R=1)} \mathbb{E}[Y_1 - Y_0 \mid X] \right]
\end{aligned}
$$

* 베이즈 정리와 조건부 기댓값의 성질에 의해, 위 식은 정확히 **ATT**의 정의와 일치합니다.

$$
\therefore \mathbb{E}[wY] = \mathbb{E}[Y_1 - Y_0 \mid R=1] = ATT
$$

> **결론:** 논문에서 제시한 가중치 $w_{im}$을 적용하여 평균을 구하면, 공변량 분포가 처치군에 맞춰 보정된 인과 효과(ATT)를 얻을 수 있습니다.

#### 4. Stability Issues: 유연함 뒤의 불안정성

* IPW 접근법은 결과 변수의 함수 형태(functional form)를 가정하지 않아도 된다는 점에서 매우 **유연(Flexible)**합니다. 하지만 논문은 다음과 같은 중요한 한계를 지적합니다.

##### 4.1 Finite Sample Instability (유한 표본 불안정성)
* 표본의 크기가 무한하지 않은 현실 데이터에서는 성향 점수 추정의 오차로 인해 가중치 추정량이 불안정할 수 있습니다.

##### 4.2 Non-overlap & Extreme Weights (비중첩과 극단적 가중치)
* 만약 특정 개체의 성향 점수 $\pi_{r,m}(\mathbf{X})$가 1에 매우 가깝다면 어떤 일이 발생할까요?

$$
w_{im} \propto \frac{1}{1 - \pi_{r,m}(\mathbf{X})}
$$

* 분모가 0에 수렴하게 되어 **가중치가 폭발적으로 증가(Explode)**합니다. 이는 특정 공변량 값을 가진 개체가 통제군(Control Group)에는 거의 존재하지 않는 **비중첩(Non-overlap)** 상황을 의미하며, 이 경우 추정된 인과 효과의 분산이 매우 커져 신뢰할 수 없게 됩니다.

---

### 3.5.4. DR estimators

#### 1. Introduction: Why Doubly Robust?

* 인과추론, 특히 관측 데이터(Observational Data)를 다루는 연구에서 우리는 종종 두 가지 갈림길에 섭니다.

* 1.  **Outcome Regression (OR)**: 결과 변수($Y$)의 메커니즘을 정확하게 모델링하여 반사실(Counterfactual)을 예측할 것인가?
* 2.  **Inverse Probability Weighting (IPW)**: 처치(Treatment) 할당 확률인 성향 점수(Propensity Score)를 모델링하여 선택 편향(Selection Bias)을 제거할 것인가?

* 본 포스트에서 다룰 **3.5.4 DR estimators** 섹션은 이 두 가지 접근법 중 하나를 택일하는 것이 아니라, 두 가지를 결합하여 추정의 안정성을 높이는 **이중 강건(Doubly Robust, DR)** 접근법을 제안합니다. 특히, 최근(Li & Li, 2019; Sant’Anna & Zhao, 2020) 개발된 **Influence Function (IF)** 기반의 Difference-in-Differences (DiD) 추정량을 차용하여, 이진 노출 매핑(Binary Exposure Mapping) 하에서의 인과 효과($ATT(m)$, $ATN(m)$)를 추정하는 방법을 다룹니다.

#### 2. The DR Estimator Framework

##### 2.1. Motivation
* 기존의 **Two-Way Fixed Effects (TWFE)** 모델은 처치 효과의 이질성(Heterogeneity)을 충분히 반영하지 못하거나, 공변량(Covariates)과 결과 변수 간의 관계를 선형으로 가정한다는 한계가 있습니다. 반면, DR 접근법은 이러한 가정에서 벗어나 더 유연한 모델링을 가능하게 합니다.

##### 2.2. Mathematical Formulation

* 제안된 DR 플러그인(Plug-in) 추정량은 다음 두 가지 요소를 결합합니다.
  * 1.  **Propensity Score ($w_m$)**: 처치 받을 확률에 기반한 가중치
  * 2.  **Outcome Trend under No Treatment ($\mu_{\Delta, m}$)**: 처치를 받지 않았을 때 예상되는 결과 변수의 변화 추세

* 이 둘을 결합하여 인과 효과 $\hat{\tau}_m^{dr}$를 추정하는 식은 다음과 같습니다.

$$
\hat{\tau}_m^{dr} = \mathbb{E}\left[ \hat{w}_m(\mathbf{X}_{im}) \left( (Y_{1m} - Y_{0m}) - \hat{\mu}_{\Delta, m}(\mathbf{X}_{m}) \right) \right] \quad (9)
$$

###### 수식의 단계별 해석

* 이 수식은 직관적으로 다음과 같이 분해하여 이해할 수 있습니다.

* 1.  **$(Y_{1m} - Y_{0m})$**:
    * 관측된 결과 변수의 시간(Time 0 $\rightarrow$ Time 1)에 따른 실제 변화량입니다.
    * DiD의 기본 아이디어인 '전후 차이'를 의미합니다.

* 2.  **$\hat{\mu}_{\Delta, m}(\mathbf{X}_{m})$**:
    * 공변량 $\mathbf{X}_m$을 조건부로 했을 때, **처치가 없었더라면(Counterfactual)** 발생했을 결과 변수의 변화량에 대한 추정치입니다.
    * 이는 Outcome Regression(OR) 모델에서 유도됩니다.

* 3.  **Residual $(Y_{1m} - Y_{0m}) - \hat{\mu}_{\Delta, m}(\mathbf{X}_{m})$**:
    * 실제 관측된 변화량에서 '처치가 없을 때 예상되는 변화량'을 뺀 값입니다.
    * 만약 OR 모델이 완벽하다면, 처치군(Treated)에 대해서 이 값은 순수한 처치 효과(Treatment Effect)가 됩니다.

* 4.  **$\hat{w}_m(\mathbf{X}_{im})$**:
    * 각 개체 혹은 그룹에 부여되는 가중치(Weight)입니다. IPW 접근법에서 유도되며, 처치군과 대조군 사이의 공변량 분포 불균형을 보정하는 역할을 합니다.

* 결과적으로 이 추정량은 **"Outcome Regression으로 설명되지 않는 잔차(Residual)에 대해, IPW 가중치를 적용하여 보정하는 형태"**를 띱니다.

![Figure 1: DR 추정량의 개념적 구조. Outcome Model과 Propensity Model이 상호 보완적으로 작동하여, 한 쪽 모델이 잘못 설정(Misspecification)되더라도 일치 추정량을 제공하는 원리를 나타냄.](./images/dr_estimator_concept.png)

##### 2.3. Double Robustness Property
* 이 추정량이 'Doubly Robust'라고 불리는 이유는 다음과 같습니다.
  * **Case 1**: 성향 점수 모델 $\hat{w}_m$이 정확하게 추정됨.
  * **Case 2**: 결과 회귀 모델 $\hat{\mu}_{\Delta, m}$이 정확하게 추정됨.

* 두 모델 중 **적어도 하나만 정확하다면(Consistent)**, 최종 추정량 $\hat{\tau}_m^{dr}$은 일치 추정량(Consistent Estimator)이 됩니다. 이는 모형 설정 오류(Misspecification)에 대한 강건성을 제공합니다.

#### 3. Integration with Machine Learning

* 이 섹션에서 강조하는 DR 접근법의 가장 큰 장점 중 하나는 **유연성(Flexibility)**입니다.

##### 3.1. Beyond TWFE
* 전통적인 TWFE 접근법과 달리, IPW, OR, 그리고 DR 접근법은 **Nuisance Functions**(여기서는 $w_m$과 $\mu_{\Delta, m}$)를 추정할 때 선형 회귀에 국한될 필요가 없습니다.

> **Nuisance Function이란?**
> 관심 있는 파라미터(여기서는 인과 효과 $\tau$)를 추정하기 위해 필요하지만, 그 자체로는 관심의 대상이 아닌 매개변수나 함수들을 말합니다.

##### 3.2. Leveraging ML Models
* 우리는 Random Forest, Gradient Boosting, Neural Networks 등 다양한 머신러닝 알고리즘을 사용하여 Nuisance Function을 모델링할 수 있습니다. 이는 공변량 간의 복잡한 비선형 관계나 교호작용(Interaction)을 포착하는 데 매우 유리합니다.

##### 3.3. The Condition regarding Overfitting (Important)
* 하지만 머신러닝 모델을 인과추론에 바로 적용할 때는 주의가 필요합니다. 논문에서는 다음의 조건을 만족해야 한다고 명시합니다.

> "However, these approaches typically require **sample splitting** or **under-smoothing** to avoid overfitting and achieve asymptotic properties..."

* 단순히 ML 모델을 피팅해서 식 (9)에 넣으면, 오버피팅(Overfitting)으로 인해 추정량의 분포가 왜곡될 수 있습니다. 이를 해결하기 위해 논문은 Chang (2020) 등을 인용하며 두 가지 해결책을 제시합니다.

* 1.  **Sample Splitting (Cross-fitting)**:
    * 데이터를 분할하여, Nuisance Function을 학습하는 데이터와 인과 효과를 추정하는 데이터를 분리합니다. 이를 통해 자신의 데이터로 자신을 예측할 때 발생하는 편향(Own-observation bias)을 제거합니다.
* 2.  **Under-smoothing**:
    * 모델의 복잡도를 의도적으로 조절하여 편향-분산 트레이드오프(Bias-Variance Tradeoff)를 관리합니다.
* 3.  **Donsker Class**:
    * 사용하는 함수 공간이 Donsker Class와 같은 특정 복잡도 제한을 만족해야 점근적 성질(Asymptotic Normality)이 보장됩니다.

---

## 3.6 Inference under spatial and temporal correlation

### 1. Introduction: 시공간 데이터 추론의 난점

* 인과추론이나 계량경제학 연구, 특히 파급 효과(Spillover effects)나 반복 관측(Repeated observations)이 포함된 연구에서 가장 까다로운 문제 중 하나는 **데이터의 독립성(Independence) 가정**이 깨진다는 점이다.

* 일반적인 통계적 추론은 관측치들이 서로 독립적이고 동일한 분포를 따른다는 **i.i.d. (independent and identically distributed)** 가정을 전제로 한다. 그러나 시공간(Spatial and Temporal) 데이터는 다음과 같은 특성을 가진다:
  * 1.  **공간적 상관성 (Spatial Correlation):** 인접한 지역이나 단위(Unit)끼리는 서로 영향을 주고받는다 (Spillover).
  * 2.  **시간적 상관성 (Temporal Correlation):** 동일한 단위의 과거 상태는 현재 상태에 영향을 미친다 (Autocorrelation).

* 이러한 상관성을 무시하고 일반적인 표준오차(Standard Error)를 계산할 경우, 불확실성이 과소평가되어 통계적 유의성을 잘못 판단하는 **1종 오류(Type I Error)**를 범할 가능성이 매우 높다.

* 본 포스트에서는 이러한 잔차의 시공간적 상관관계를 해결하기 위해 제안된 **비모수적 가중 블록 부트스트랩(Nonparametric Weighted Block Bootstrap)** 방법론을 다룬다.

### 2. Problem Definition: 잔차 상관성 (Residual Correlation)

* 본 논문의 저자들은 앞선 섹션에서 두 가지 장치를 통해 의존성(Dependence) 문제를 완화하려 시도했다.

* 1.  **가정 (Assumption A1) 및 하위 분석:** SUTVA(Stable Unit Treatment Value Assumption)가 성립하도록 지역 간 의존성을 고려한 별도의 하위 분석(Subanalyses)을 수행.
* 2.  **공변량 통제 (Covariates):** 연구에 포함된 시공간적 특징의 많은 부분을 설명할 수 있는 관련 공변량들을 조건부(Conditioning)로 통제.

* 하지만 저자들은 이것만으로는 충분하지 않다고 지적한다. 모델링되지 않은 **잔차 공간 및 시간 상관성(Residual Spatial and Temporal Correlation)**이 여전히 존재할 확률이 높기 때문이다. 따라서, 추론(Inference) 단계, 즉 95% 신뢰구간(Confidence Interval, CI)을 추정하는 단계에서는 이 구조적인 상관성을 반드시 반영해야 한다.

### 3. Methodology: Weighted Block Bootstrap

* 저자들은 효과 추정치(Effect Estimates)에 대한 신뢰구간을 구하기 위해 **비모수적 가중(Multiplier) 비중복 블록 부트스트랩(Nonparametric weighted non-overlapping block bootstrap)** 접근법을 채택했다. (참고: Carlstein, 1986; Efron & Tibshirani, 1993)

* 이 방법론의 핵심을 단계별로 분해해보자.

#### 3.1. Block Bootstrap의 직관

* 일반적인 부트스트랩은 개별 관측치를 복원 추출(Resampling)한다. 하지만 시공간 데이터에서 개별 관측치를 섞어버리면, 데이터 안에 내재된 시공간적 의존 구조가 파괴된다.

* **블록 부트스트랩(Block Bootstrap)**은 데이터를 개별 단위가 아닌 **'블록(Block)'** 단위로 묶어서 처리한다.
  * **아이디어:** 블록 내부(Within-block)의 데이터는 원래의 시공간적 상관관계를 그대로 유지한다.
  * **가정:** 블록과 블록 사이(Between-blocks)는 서로 독립적(Essentially Independent)이라고 가정한다.

#### 3.2. 가중(Multiplier) 부트스트랩 알고리즘

* 이 연구에서는 단순히 블록을 선택/비선택(0 or 1)하는 것이 아니라, 연속적인 **가중치(Weights)**를 부여하는 방식을 사용한다. 이를 수식적으로 표현하면 다음과 같다.

##### Step 1: 가중치 생성 (Weight Generation)
* 각 블록 $b$에 대하여 가중치 $W_b$를 지수분포(Exponential Distribution)에서 추출한다.

$$
W_b \sim \text{Exponential}(1)
$$

* 이때 $Exp(1)$을 사용하는 것은 베이지안 부트스트랩(Bayesian Bootstrap)과의 연관성 혹은 계산적 안정성을 위한 일반적인 선택이다.

##### Step 2: 가중치 스케일링 (Scaling)
* 추출된 가중치는 각 노출 집단(Exposure Group)의 표본 크기와 일치하도록 조정(Scale)되어야 한다.
노출 집단 $g$에 속한 단위들의 가중치 합이 해당 집단의 표본 크기 $N_g$와 같아지도록 정규화한다.

$$
\sum_{i \in \text{Group } g} w_{i} = N_g
$$

* 여기서 $w_i$는 단위 $i$가 속한 블록 $b$에 할당된 가중치 $W_b$에 스케일링 팩터를 적용한 값이다.

##### Step 3: 추정 (Estimation)
* 블록별로 부여된 가중치 $w_i$를 사용하여 관심 있는 추정량(Estimator, $\hat{\theta}^*$)을 다시 계산한다. 이 과정을 $B$번 반복하여 추정량의 분포를 얻고, 이를 통해 신뢰구간을 구성한다.

![Figure: 블록 부트스트랩의 개념도 (예시). 데이터를 시공간적 덩어리(Block)로 나누고, 각 블록에 가중치를 부여하여 리샘플링을 수행함으로써 내부 상관성을 보존한다.](./images/block_bootstrap_concept_placeholder.png)

*(위 이미지는 개념 이해를 돕기 위한 예시 공간입니다. 실제 논문에는 포함되지 않았으나, 블록 단위 리샘플링이 시공간 구조를 보존함을 보여주는 다이어그램이 적합합니다.)*

### 4. Theoretical Justification

* 이 방법론이 유효한(Valid) 이유는 무엇인가?

* 1.  **상관 구조의 자동 반영 (Structure-Agnostic):**
    * 블록 단위로 가중치를 부여함으로써, 블록 내부(Spatial)의 유닛 간 상관관계와 동일 유닛의 시계열(Temporal) 상관관계를 **자동으로(Automatically)** 반영한다.
    * 중요한 점은 AR(1)이나 Exchangeable 같은 구체적인 **상관 구조(Correlation Structure)를 사전에 명시(Specify)할 필요가 없다**는 것이다. 데이터가 가진 패턴을 비모수적으로 따르기 때문이다.

* 2.  **블록 간 독립성 가정:**
    * Carlstein (1986)에 따르면, 이 접근법의 타당성은 **"서로 다른 블록에 있는 단위들은 본질적으로 독립적이어야 한다"**는 조건에 의존한다.
    * 동시에, 적절한 혼합(Mixing)을 보장하기 위해 블록들은 충분히 다양해야 한다.

---

# 4 PBT analysis

## 4.1 Descriptive analyses



---

## 4.2 Estimation of treatment effects

### 4.2.1 Estimator implementation



### 4.2.2 Identigcation assumptions



### 4.2.3 Effects on Philadelphia and bordering counties



## 4.3 Estimation of effects by geographical proximity



---

# 5 Simulation studies

## 5.1 Design



---

## 5.2 Results



---

# 6 Discussion
