---
title: "[Causal Inference] Appendix 02. Direct and Indirect Effects (Part 2)"
description: "Mathematization"
author: "유성현"
date: "2026-02-04"
categories: [Causal Inference]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# Introduction

* 인과추론에서 총 효과(Total Effect)를 구하는 것만으로는 충분하지 않은 경우가 많습니다. 
* 우리는 원인 변수 $X$가 결과 변수 $Y$에 영향을 미칠 때, 그 메커니즘이 $X$가 $Y$에 **직접(Directly)** 영향을 미친 것인지, 아니면 중개 변수(Mediator, $Z$)를 거쳐 **간접(Indirectly)** 영향을 미친 것인지 구분하고자 합니다.
* 이번 포스트에서는 Pearl의 구조적 인과 모형(Structural Causal Model) 프레임워크를 기반으로 **통제된 직접 효과(Controlled Direct Effect, CDE)**와 **자연 직접 효과(Natural Direct Effect, NDE)**의 개념을 정의하고, 이를 실험적 데이터와 관찰 데이터에서 어떻게 식별(Identification)할 수 있는지 수식적으로 유도해 보겠습니다.

# 1. Notation & Framework

* $X$: 통제 변수 (Control variable, 원인)
* $Y$: 반응 변수 (Response variable, 결과)
* $Z$: $X$와 $Y$ 사이의 모든 중개 변수 집합 (Intermediate variables)
* $W$: 공변량 집합 (Covariates, $X$나 $Z$의 자손이 아님)

## Counterfactual Notation
* 인과 효과를 정의하기 위해 잠재적 결과(Potential Outcome) 표기법을 사용합니다.

$$Y_x(u)$$

* 이는 단위(unit) $u$에서 $X$를 $x$로 설정($do(X=x)$)했을 때 관측되는 $Y$의 값을 의미합니다.

# 2. Controlled Direct Effects (CDE)

## 2.1. Definition
* 가장 직관적인 직접 효과의 정의는 중개 변수 $Z$를 특정 값 $z$로 고정해버리는 것입니다. 이를 **통제된 직접 효과(CDE)**라고 합니다.

* 단위 $u$에 대하여, 중개 변수 $Z$를 $z$로 고정한 상태에서 $X$를 $x^*$에서 $x$로 바꿀 때의 효과는 다음과 같습니다.

$$CDE_z(x, x^*; Y, u) = Y_{xz}(u) - Y_{x^*z}(u)$$

## 2.2. Average CDE
* 개별 단위가 아닌 모집단 전체에 대한 평균 효과는 기대값을 취하여 정의합니다.

$$CDE_z(x, x^*; Y) = \mathbb{E}[Y_{xz} - Y_{x^*z}]$$

* 이 척도는 정책적으로 중개 변수 $Z$를 물리적으로 통제(예: 처방, 강제 설정)할 수 있을 때 유용합니다. 하지만 $Z$를 인위적으로 고정하는 것이 불가능하거나 무의미한 상황에서는 한계가 있습니다.

# 3. Natural Direct Effects (NDE)

## 3.1. Motivation & Formulation
* 우리가 자연스럽게 생각하는 "직접 효과"는, $X$가 변할 때 $Z$를 억지로 고정하는 것이 아니라, **$Z$가 $X$의 기준 값($x^*$) 하에서 가졌을 자연스러운 값**을 유지하게 한 상태에서 $X$만 $x$로 바꾸는 효과입니다. 이를 **자연 직접 효과(NDE)**라고 합니다.

* 이를 표현하기 위해 **중첩된 반사실(Nested Counterfactual)** 개념이 필요합니다.
  * $Z_{x^*}(u)$: $X$가 $x^*$일 때 단위 $u$가 가질 $Z$의 값.
  * $Y_{x Z_{x^*}(u)}(u)$: $X$를 $x$로 설정하되, $Z$는 **"$X$가 $x^*$였더라면 가졌을 값"**으로 설정했을 때의 $Y$.

## 3.2. Definition
* 단위 $u$에서의 자연 직접 효과는 다음과 같이 정의됩니다.
$$NDE(x, x^*; Y, u) = Y_{x Z_{x^*}(u)}(u) - Y_{x^*}(u)$$
  * 여기서 $Y_{x^*}(u)$는 $X=x^*$일 때의 자연스러운 $Y$값이므로, $Y_{x^* Z_{x^*}(u)}(u)$와 동일합니다. 즉, $Z$는 $X=x^*$일 때의 값으로 고정된 상태에서, $X$입력만 $x$로 바뀐 효과를 측정합니다.

* 모집단 평균에 대한 NDE는 다음과 같습니다.

$$NDE(x, x^*; Y) = \mathbb{E}[Y_{x Z_{x^*}}] - \mathbb{E}[Y_{x^*}]$$

# 4. Experimental Identification of NDE

## 4.1. The Identification Problem
* NDE 식별의 핵심 어려움은 $\mathbb{E}[Y_{x Z_{x^*}}]$ 항에 있습니다. 이 항은 $X=x$일 때의 결과 $Y$와 $X=x^*$일 때의 중개 변수 $Z$를 동시에 요구하기 때문입니다. 
* 현실에서는 하나의 단위에 대해 동시에 서로 다른 두 가지 $X$ 상태($x$와 $x^*$)를 관측할 수 없습니다. 
* 따라서 일반적인 $P(Y_x=y)$나 $P(Y_{xz}=y)$ 형태의 표현식으로 환원되지 않습니다.

## 4.2. Identification Conditions
* 하지만 특정 조건 하에서는 실험적 데이터(experimental data)나 관찰 데이터로부터 NDE를 식별할 수 있습니다.
* **조건:** $X$나 $Z$의 자손이 아닌 공변량 집합 $W$가 존재하여 다음을 만족해야 합니다.

$$Y_{xz} \perp\!\!\perp Z_{x^*} \mid W$$

* 이 조건은 $W$를 통제했을 때, "$Z$를 $z$로 고정하고 $X$를 $x$로 설정했을 때의 잠재적 결과($Y_{xz}$)"와 "$X$가 $x^*$일 때의 자연적 $Z$값($Z_{x^*}$)"이 독립이라는 의미입니다.

## 4.3. Derivation
* 위 조건이 만족될 때, $\mathbb{E}[Y_{x Z_{x^*}}]$는 다음과 같이 유도됩니다.

* 1.  **전체 확률의 법칙 (Conditioning on $W$ and $Z$):**
    $$
    \mathbb{E}[Y_{x Z_{x^*}}] = \sum_w \sum_z \mathbb{E}[Y_{xz} \mid Z_{x^*} = z, W=w] P(Z_{x^*} = z \mid W=w) P(W=w)
    $$
    * 여기서 내부의 $Y_{x Z_{x^*}}$는 $Z_{x^*} = z$ 조건 하에서 $Y_{xz}$가 됩니다.

* 2.  **조건부 독립성 적용 ($Y_{xz} \perp Z_{x^*} \mid W$):**
    * 가정에 의해 $\mathbb{E}[Y_{xz} \mid Z_{x^*} = z, w]$는 $Z_{x^*}$와 무관하므로 $\mathbb{E}[Y_{xz} \mid w]$로 단순화됩니다.
    $$
    = \sum_w \sum_z \mathbb{E}[Y_{xz} \mid w] P(Z_{x^*} = z \mid w) P(w)
    $$

* 3.  **NDE Formula:**
    * $\mathbb{E}[Y_{x^*}]$ 부분 역시 Composition 법칙에 의해 유사하게 분해하면, 최종적으로 NDE 식별 공식은 다음과 같습니다.

    $$
    NDE(x, x^*; Y) = \sum_{w,z} [\mathbb{E}(Y_{xz}|w) - \mathbb{E}(Y_{x^*z}|w)] P(Z_{x^*}=z|w) P(w)
    $$

* 이 식의 의미는, **"각 상황 $w$에서, 중개 변수 $Z$가 기준 상태($x^*$)일 때 가질 확률($P(Z_{x^*}=z|w)$)을 가중치로 하여 CDE를 평균 낸 것"**입니다.

## 4.4. Graphical Interpretation

* 이러한 식별 조건은 인과 그래프(Causal Diagram)를 통해 시각적으로 확인할 수 있습니다.

![Figure 1: (a) NDE가 식별 가능한 인과 그래프, (b) 식별 조건을 확인하기 위한 부분 그래프](./images/causal_graph_nde.png)

* **Figure 1(a):** 전체 인과 모형을 나타냅니다. $W$는 교란 요인(confounder) 역할을 합니다.
* **Figure 1(b):** 조건 $Y_{xz} \perp Z_{x^*} | W$를 확인하기 위한 부분 그래프입니다. $X$와 $Z$에서 나가는 화살표를 제거했을 때(mutilated graph), $W$가 $Y$와 $Z$를 d-separation 시킨다면 식별 조건이 충족됩니다.

# 5. Identification in Markovian Models (Observational Data)

실험적 개입($do$-operator)이 없는 순수 관찰 데이터(Markovian Model)에서도 NDE를 식별할 수 있습니다. Markovian 모델에서는 모든 변수들이 자신의 부모 변수들에 의존하며, 오차항들이 서로 독립입니다[cite: 81].

## 5.1. Assupmtions
Markovian 모델에서는 다음 세 가지 관계가 성립합니다[cite: 81, 82, 83, 84, 85].
1.  $P(Y_{xz}=y) = P(y \mid x, z)$ (여기서 $X \cup Z$는 $Y$의 부모 집합)
2.  $P(Z_{x^*}=z) = \sum_s P(z \mid x^*, s)P(s)$
3.  $P(Y_{x, Z_{x^*}}=y) = \sum_s \sum_z P(y \mid x, z)P(z \mid x^*, s)P(s)$

여기서 $S$는 $Z$의 부모 변수 집합(단, $X$ 제외) 혹은 Backdoor Criterion을 만족하는 집합을 의미합니다.

## 5.2. Mediation Formula
위 관계들을 종합하면, 비실험 데이터(Non-experimental data)로부터 NDE를 추정하는 **Mediation Formula**를 얻습니다[cite: 87].

$$
NDE(x, x^*; Y) = \sum_s \sum_z [\mathbb{E}(Y \mid x, z) - \mathbb{E}(Y \mid x^*, z)] P(z \mid x^*, s) P(s)
$$

이 공식은 관찰된 조건부 확률 $P(y|x,z)$와 $P(z|x,s)$, 그리고 공변량의 분포 $P(s)$만을 사용하여 인과적 직접 효과를 계산할 수 있게 해줍니다.

# 6. Summary

* **CDE**는 중개 변수 $Z$를 특정 값으로 **강제 고정**했을 때의 효과입니다.
* **NDE**는 중개 변수 $Z$가 **자연스럽게 변하도록 두었을 때**(단, 기준 처치 $x^*$ 하에서의 분포를 따름)의 직접적인 효과입니다.
* NDE는 $Y_{x Z_{x^*}}$라는 중첩된 반사실을 포함하므로 식별이 까다롭지만, $Y_{xz} \perp Z_{x^*} | W$라는 조건 하에서 식별 가능합니다.
* Markovian 모델에서는 **Mediation Formula**를 통해 관찰 데이터만으로 NDE를 계산할 수 있습니다.

---
**References**
Pearl, J. (2001). *Direct and Indirect Effects*. (Based on the provided appendix PDF)