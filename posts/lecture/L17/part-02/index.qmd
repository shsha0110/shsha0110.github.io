---
title: "[Causal Inference] 17. Causal Data Science (Part 2)"
description: "Experimental Conditions - General Identifiability"
author: "유성현"
date: "2026-01-25"
categories: [Causal Inference]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# Overview: The Challenge of Experimental Conditions

* 이전 포스트에서는 Causal Data Science가 다루는 4가지 차원(Dimensions)에 대해 개괄적으로 살펴보았습니다.
* 이번 포스트에서는 그 첫 번째이자 가장 기초가 되는 문제인 **Experimental Conditions**와 **General Identifiability (g-ID)**에 대해 깊이 있게 다룹니다.

* 우리가 $do(x)$에 대한 인과 효과 $P(y|do(x))$를 알고 싶을 때, 이상적인 상황은 $X$에 대한 무작위 대조군 실험(RCT) 데이터가 있는 것입니다. 
* 하지만 현실에서는 다음과 같은 제약이 따릅니다:
    * 1.  **윤리적/비용적 문제:** $X$(예: 흡연, 유해 물질 노출)를 직접 실험할 수 없음.
    * 2.  **대리 실험(Surrogate Experiments):** $X$ 대신 $Z$(예: 식이요법, 보조 약물)에 대한 실험 데이터만 존재함.
    * 3.  **이질적 데이터의 결합:** 여러 개의 서로 다른 실험 결과($do(x_1), do(x_2)$)를 결합하여 새로운 개입($do(x_1, x_2)$)의 효과를 추정해야 함.

* 이 문제는 **"우리가 가진 다양한 실험 및 관찰 데이터($\mathbb{P}$)를 활용하여, 타겟 질의($Q$)를 식별할 수 있는가?"**라는 **General Identifiability** 문제로 귀결됩니다.

---

# 2. z-ID: Experimental Identifiability

## 2.1. Motivation: Diet, Cholesterol, and Heart Attack
* 가장 단순한 형태의 대리 실험 문제를 살펴보겠습니다. 
* 우리의 목표는 콜레스테롤 수치($X$)가 심장마비($Y$)에 미치는 인과 효과 $P(y|do(x))$를 알아내는 것입니다.

![Figure 1: z-ID의 기본 모티베이션 그래프. Z(식이요법)는 X(콜레스테롤)에 영향을 주고, X는 Y(심장마비)에 영향을 준다. 점선 화살표는 측정되지 않은 교란 변수(Confounder)를 의미한다. Z와 Y 사이의 직접적인 화살표가 없다는 점(Exclusion Restriction)이 중요하다.](./images/zid_motivation_graph.png)

* **Query:** $Q = P(y|do(x))$
* **Problem:** $X$와 $Y$ 사이에 관측되지 않은 교란 요인(Confounder)이 존재하여(위 그림의 $X \leftrightarrow Y$ 점선), 관찰 데이터 $P(x,y,z)$만으로는 $Q$를 식별할 수 없습니다.
* **Available Data:**
    * Observational: $P(x,y,z)$
    * Experimental (Surrogate): $P(x,y|do(z))$ — 식이요법($Z$)은 실험 가능함.

* 이 경우, $Z$에 대한 실험 데이터를 사용하여 $X$의 효과를 식별할 수 있을까요? 이를 **z-ID** 문제라고 합니다.

## 2.2. Instrumental Variable Formula derived from Experiments
만약 $Z$가 $X$를 통해서만 $Y$에 영향을 미친다면(즉, $Z \to Y$ 직접 경로가 없고, $Z$와 $Y$ 사이의 교란이 없다면), 우리는 다음 식을 유도할 수 있습니다[cite: 309].

$$
P(y|do(x)) = \frac{P(x,y|do(z))}{P(x|do(z))} = P(y|x, do(z))
$$

이는 도구 변수(Instrumental Variable) 논리와 유사하지만, 여기서는 $do(z)$라는 명시적인 실험 분포를 활용한다는 점이 다릅니다. 이 식은 $Z$를 개입했을 때 나타나는 $X$와 $Y$의 관계를 통해, $X$가 변했을 때 $Y$가 어떻게 변하는지($X \to Y$ 메커니즘)를 추출해 내는 것입니다.

## 2.3. Subtleties of z-ID
모든 경우에 대리 실험이 유효한 것은 아닙니다. 그래프 구조에 따라 식별 가능 여부가 달라집니다 [cite: 311-393].

![Figure 2: z-ID 가능 그래프와 불가능 그래프의 비교. 상단 그래프들은 Z에 대한 실험으로 X의 효과를 식별할 수 있는 경우(z-ID)이고, 하단 그래프들은 식별 불가능한 경우(non-z-ID)이다. 핵심은 Z의 개입이 X와 Y 사이의 교란 요인을 통제하거나 우회할 수 있는지 여부이다.](./images/zid_vs_nonzid.png)

위 그림에서 **z-ID**가 가능한 경우와 그렇지 않은 경우(non-z-ID)를 구분하는 것은, $Z$에 대한 개입이 $X \to Y$ 관계를 교란하는 뒷문 경로(Back-door path)를 차단하거나, $X$의 변동을 충분히 설명할 수 있는지와 관련이 있습니다.

---

# 3. Advanced Derivation: Combining Causal Mechanisms

조금 더 복잡한 그래프를 통해, 식별 불가능해 보이는 효과를 도출해 내는 과정을 수식으로 살펴보겠습니다 [cite: 394-405].

![Figure 3: 4개의 노드(Z, X, W, Y)를 가진 복잡한 인과 그래프. Z에서 X, X에서 W, W에서 Y로 이어지는 경로 외에 다양한 교란 경로(점선)가 존재한다. 이 그래프에서 P(y|do(x))를 구하는 것이 목표다.](./images/complex_zid_graph.png)

### Goal
Target: $P(y|do(x))$

이 그래프에서 $X$와 $Y$ 사이에는 직접적인 교란이 존재하므로, 표준적인 Back-door criterion을 사용할 수 없습니다. 하지만, $Z$에 대한 실험 데이터 $P(v|do(z))$가 있다면 가능합니다.

### Derivation Step-by-Step
Do-calculus와 확률의 법칙(Law of Total Probability)을 사용하여 식을 분해해 봅시다. 매개변수 $W$를 도입하여 conditioning을 수행합니다[cite: 395].

1.  **Conditioning on W:**
    $$P(y|do(x)) = \sum_{w} P(y|do(x), w) P(w|do(x))$$

2.  **Simplification using Causal Graph (Rule 2/3):**
    그래프 구조상, $X$에 개입하고 $W$가 주어졌을 때 $Y$의 분포는 $W$에만 개입했을 때의 분포와 같습니다(X의 영향은 W를 통해서만 전달됨).
    $$P(y|do(x), w) = P(y|do(w))$$

3.  **Substitution:**
    $$P(y|do(x)) = \sum_{w} P(y|do(w)) P(w|do(x))$$

이제 우변의 두 항($P(y|do(w))$, $P(w|do(x))$)을 각각 구해야 합니다. 놀랍게도 이 두 항은 모두 $P(v|do(z))$로부터 식별 가능합니다 [cite: 405-408].

* **Identifying $Q[Y] = P(y|do(w))$:**
    $$P(y|do(w)) = P(y|do(w,z)) = \sum_x P(y|do(z), w, x) P(x|do(z))$$
* **Identifying $Q[W] = P(w|do(x))$:**
    $$P(w|do(x)) = P(w|do(x,z)) = P(w|do(z), x)$$

따라서, $Z$에 대한 실험 데이터만으로 $X$에 대한 개입 효과를 완전히 계산할 수 있게 됩니다.

---

# 4. Example: Drug-Drug Interactions (Combining Experiments)

이 이론의 가장 강력한 응용 사례는 **약물 상호작용(Drug-Drug Interaction)** 분석입니다. 개별 약물 실험 데이터만 있을 때, 두 약물을 동시에 처방했을 때의 효과를 예측할 수 있을까요? [cite: 415-460]

### 4.1. Problem Setup
* **Variables:**
    * $X_1$: 고혈압 치료제 (Anti-hypertensive drug)
    * $X_2$: 당뇨 치료제 (Anti-diabetic drug)
    * $B$: 혈압 (Blood pressure)
    * $Y$: 심혈관 질환 (CVD)
* **Data Sources:**
    * Study 1: $X_1$에 대한 RCT $\rightarrow P(v|do(x_1))$
    * Study 2: $X_2$에 대한 RCT $\rightarrow P(v|do(x_2))$
* **Target Query:**
    * Joint Intervention: $P(y|do(x_1, x_2))$

![Figure 4: 약물 상호작용 인과 그래프. X1은 B에 영향을 주고, B는 Y에 영향을 준다. X2는 Y에 직접 영향을 준다. X1과 B, X2와 Y, B와 Y 사이에는 교란 요인(점선)이 존재한다. 목표는 X1과 X2를 동시에 개입했을 때 Y의 분포를 구하는 것이다.](./images/drug_interaction_graph.png)

### 4.2. Derivation
우리는 $P(y|do(x_1, x_2))$를 구해야 합니다. 혈압 $B$가 $X_1$과 $Y$ 사이의 매개체 역할을 한다는 점에 착안하여 식을 전개합니다 [cite: 570-577].

1.  **Total Probability Theorem over B:**
    $$P(y|do(x_1, x_2)) = \sum_{b} P(y|do(x_1, x_2), b) P(b|do(x_1, x_2))$$

2.  **Factor 1: $P(y|do(x_1, x_2), b)$**
    그래프에서 $X_1$은 $B$로 가는 화살표를 제외하면 $Y$에 직접 영향을 주지 않습니다(Block). 따라서 $X_1$을 조건부에서 제거할 수 있습니다.
    $$P(y|do(x_1, x_2), b) = P(y|do(x_2), b)$$
    이 항은 **Study 2 ($do(x_2)$)** 데이터에서 $B$를 관측함으로써 얻을 수 있습니다 ($P_{x_2}(y|b)$).

3.  **Factor 2: $P(b|do(x_1, x_2))$**
    그래프에서 $X_2$는 $B$에 영향을 주지 않습니다 ($Y$에만 영향). 따라서 $X_2$를 제거할 수 있습니다.
    $$P(b|do(x_1, x_2)) = P(b|do(x_1))$$
    이 항은 **Study 1 ($do(x_1)$)** 데이터에서 바로 얻을 수 있습니다 ($P_{x_1}(b)$).

### 4.3. Final Formula
$$
P(y|do(x_1, x_2)) = \sum_{b} P_{x_1}(b) P_{x_2}(y|b)
$$

이 결과는 매우 강력합니다. **두 약물을 동시에 사용하는 실험을 한 번도 수행하지 않았음에도**, 개별 약물 실험 데이터를 수학적으로 결합하여 그 효과를 정확히 예측할 수 있기 때문입니다.

---

# 5. Algorithm for General Identifiability (g-ID)

위의 사례들을 일반화하면 **General Identifiability (g-ID)** 알고리즘을 만들 수 있습니다 [cite: 488-511].

### The g-ID Algorithm Flow
1.  **Decomposition (분해):**
    주어진 쿼리 $Q = P_x(y)$를 Causal Graph의 구조(C-components)를 이용하여 더 작은 **Factors (요인들)**의 곱과 합($\sum \prod$)으로 분해합니다.
    $$Q = \sum \prod P_{\bullet}(\bullet)$$

2.  **Identification (식별):**
    분해된 각 Factor가 가용한 데이터 소스 집합 $\mathbb{P} = \{ P(obs), P(do(z_1)), P(do(z_2)), \dots \}$ 중 하나로부터 식별 가능한지 확인합니다.
    
    ![Figure 5: g-ID 알고리즘의 도식화. 쿼리(좌측)가 여러 Factor로 분해되고, 각 Factor가 우측의 가용 데이터 소스(P_z1, P_zm...) 중 하나와 매칭되어 식별되는 과정을 보여준다.](./images/gid_algorithm_flow.png)

3.  **Conclusion:**
    * 만약 모든 Factor가 데이터 소스로부터 식별 가능하다면 $\rightarrow$ **Identifiable**.
    * 하나라도 식별 불가능한 Factor가 남는다면 $\rightarrow$ **Fail**.

### Significance
이 알고리즘과 Do-calculus는 Experimental Identifiability 문제에 대해 **Completeness(완전성)**를 가집니다. 즉, 이 알고리즘으로 식별할 수 없다면, 그 인과 효과는 주어진 데이터와 그래프 가정하에서는 이론적으로 식별이 불가능한 것입니다[cite: 586].

---

# 6. Conclusion

이번 포스트에서는 Causal Data Science의 첫 번째 차원인 **Experimental Conditions**를 다루었습니다.

* **z-ID:** 직접 실험할 수 없는 변수의 효과를 대리 실험($Z$)을 통해 식별하는 방법.
* **Data Fusion:** 서로 다른 실험 데이터($do(x_1), do(x_2)$)를 결합하여 새로운 인과 효과를 추론하는 메커니즘.
* **g-ID Algorithm:** 이를 일반화하여 복잡한 쿼리를 분해하고 가용 데이터와 매핑하는 체계적인 방법론.

다음 포스트에서는 두 번째 차원인 **Environmental Conditions (Transportability)**, 즉 한 집단(예: 쥐, LA)에서 얻은 결과를 다른 집단(예: 인간, NY)으로 일반화하는 방법에 대해 다루겠습니다.

---
### **Appendix: Verification Checklist**

* **포함된 내용:**
    * [x] Experimental Conditions (General Identifiability)의 정의 및 필요성
    * [x] Diet-Cholesterol-Heart Attack 예시를 통한 z-ID 모티베이션
    * [x] z-ID 식별 공식 및 유도 ($P(y|x, do(z))$)
    * [x] 복잡한 그래프에서의 수식 유도 (Subtleties, c-component factorization 논리)
    * [x] Drug-Drug Interaction 예시와 단계별 수식 유도 (Joint intervention)
    * [x] g-ID 알고리즘의 2단계 구조 (Decomposition -> Identification)
    * [x] Do-calculus의 Completeness 언급
    * [x] 모든 주요 수식의 LaTeX 구현 및 Figure Placeholder

* **생략된 내용:**
    * "Missing Data" 및 "Selection Bias"에 대한 상세 내용은 PDF의 Overview(Slide 1)와 결론부(Slide 21 이후)에만 짧게 언급되어 있고, 본문 슬라이드(Slide 2-20)는 Experimental Identifiability에 집중되어 있어, 이번 포스트도 g-ID에 집중하여 작성함.