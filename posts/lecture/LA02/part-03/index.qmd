---
title: "[Causal Inference] Appendix 02. Direct and Indirect Effects (Part 3)"
description: "Natural Indirect Effects"
author: "유성현"
date: "2026-02-04"
categories: [Causal Inference]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# 1. Introduction

* 인과추론(Causal Inference)의 핵심 목표 중 하나는 단순히 원인($X$)이 결과($Y$)에 미치는 **총 효과(Total Effect)**를 추정하는 것을 넘어, 그 효과가 발생하는 **메커니즘(Mechanism)**을 규명하는 것입니다. 
* 이를 위해 우리는 효과를 **직접 효과(Direct Effect)**와 매개변수 $Z$를 경유하는 **간접 효과(Indirect Effect)**로 분해하게 됩니다.

* 이번 포스트에서는 **Natural Indirect Effect(NIE)**의 정의와 **Total Effect(TE)**와의 관계, 그리고 관측 데이터로부터 이를 식별(Identification)하는 과정을 정리합니다.

# 2. Natural Indirect Effects (NIE): Formulation

## 2.1. Definition using Nested Counterfactuals

* Pearl의 구조적 인과 모형(Structural Causal Model) 프레임워크에서 **자연 간접 효과(Natural Indirect Effect, NIE)**는 다음과 같이 정의됩니다.

$$
NIE(x,x^{*};Y,u) = Y_{x^{*},Z_{x}(u)}(u) - Y_{x^{*}}(u)
$$

* **기준점($x^*$):** 처치변수 $X$가 기준값 $x^*$일 때의 결과 $Y_{x^*}$를 생각합니다. (직접 경로와 간접 경로 모두 $X=x^*$ 상태)
* **가상의 개입:** 이제 **직접 경로**인 $X \to Y$는 $x^*$로 고정하되, **간접 경로**를 결정하는 매개변수 $Z$만 처치군 값 $x$를 받았을 때의 값($Z_x$)으로 바꿉니다.
* **Nested Counterfactual:** $Y_{x^{*},Z_{x}(u)}$는 "내가 약을 먹지 않았지만($X=x^*$), 내 몸의 매개 변수들(혈압 등 $Z$)은 약을 먹었을 때와 똑같이 변했다면($Z_x$) 결과($Y$)는 어땠을까?"라는 질문에 답합니다.

* 따라서 이 둘의 차이는 $X$가 $Z$를 변화시킴으로써 발생하는 순수한 간접 효과를 나타냅니다.

## 2.2. Average Natural Indirect Effect

* 개별 단위(unit $u$)에 대한 효과를 모집단 전체로 확장하면 **평균 자연 간접 효과**는 다음과 같이 기댓값의 차이로 정의됩니다.

$$
NIE(x,x^{*};Y) = \mathbb{E}(Y_{x^{*},Z_{x}}) - \mathbb{E}(Y_{x^{*}})
$$

* 여기서 $\mathbb{E}(Y_{x^{*}})$는 $X=x^*$일 때의 평균 잠재적 결과(Potential Outcome)이며, $\mathbb{E}(Y_{x^{*},Z_{x}})$는 $X$가 $x^*$로 고정된 상태에서 $Z$만 $X=x$일 때의 분포를 따를 때의 평균 결과입니다.

# 3. Decomposition of Total Effect

* 인과 효과 분해(Decomposition)의 가장 큰 매력은 총 효과(TE)를 자연 직접 효과(NDE)와 자연 간접 효과(NIE)의 합으로 표현할 수 있다는 점입니다.

## 3.1. Definitions of Effects

* 세 가지 주요 효과를 수식으로 정의하면 다음과 같습니다.

* 1.  **Total Effect (TE):** $X$가 $x^*$에서 $x$로 변할 때의 전체 효과
    $$TE(x,x^{*};Y) = \mathbb{E}(Y_{x}) - \mathbb{E}(Y_{x^{*}})$$
* 2.  **Natural Direct Effect (NDE):** 매개변수 $Z$가 $x^*$ 수준($Z_{x^*}$)으로 고정된 상태에서, $X$만 $x$로 변할 때의 효과
    $$NDE(x,x^{*};Y) = \mathbb{E}(Y_{x,Z_{x^{*}}}) - \mathbb{E}(Y_{x^{*}})$$
* 3.  **Natural Indirect Effect (NIE):** $X$는 $x^*$로 고정하고, $Z$만 $x$ 수준($Z_x$)으로 변할 때의 효과
    $$NIE(x,x^{*};Y) = \mathbb{E}(Y_{x^{*},Z_{x}}) - \mathbb{E}(Y_{x^{*}})$$

## 3.2. Algebraic Derivation

* TE, NDE, NIE는 흥미로운 대수적 관계를 통해 연결됩니다. 먼저, "역방향" NIE를 고려해 봅시다.

$$
-NIE(x^{*},x;Y) = -[\mathbb{E}(Y_{x,Z_{x^{*}}}) - \mathbb{E}(Y_{x})] = \mathbb{E}(Y_{x}) - \mathbb{E}(Y_{x,Z_{x^{*}}})
$$

* 이제 TE를 NDE와 위 식을 사용하여 다시 써보면 다음과 같습니다.

$$
\begin{aligned}
TE(x, x^*; Y) &= \mathbb{E}(Y_x) - \mathbb{E}(Y_{x^*}) \\
&= \underbrace{[\mathbb{E}(Y_{x, Z_{x^*}}) - \mathbb{E}(Y_{x^*})]}_{NDE(x, x^*)} + \underbrace{[\mathbb{E}(Y_x) - \mathbb{E}(Y_{x, Z_{x^*}})]}_{-NIE(x^*, x)}
\end{aligned}
$$

* 따라서, 다음과 같은 관계가 성립합니다.

$$
TE(x,x^{*};Y) = NDE(x,x^{*};Y) - NIE(x^{*},x;Y)
$$

* 이 관계는 다소 생소해 보일 수 있지만($-NIE(x^*, x)$ 항 때문), 결과적으로 우리가 흔히 사용하는 **Standard Additive Relation**을 도출해냅니다.

$$
TE(x,x^{*};Y) = NDE(x,x^{*};Y) + NIE(x,x^{*};Y)
$$

* **Note:** $NIE(x, x^*) = -NIE(x^*, x)$라는 가정(즉, 효과의 대칭성)은 선형 모델 등 특정 조건에서 성립하거나, 혹은 효과의 정의를 "Total Effect = Direct + Indirect"가 되도록 맞추는 과정에서 자연스럽게 해석될 수 있습니다. 핵심은 **총 효과가 두 경로의 합으로 쪼개진다**는 직관입니다.

# 4. Identification Strategy

* 이제 이론적으로 정의된 $NIE$를 실제 데이터로 어떻게 추정(Identification)할 것인지가 문제입니다. $Y_{x^{*},Z_{x}}$와 같은 반사실적(Counterfactual) 항은 현실에서 관측할 수 없기 때문입니다.

## 4.1. Identification Conditions

* 식별을 위해 다음과 같은 조건부 독립성을 가정합니다.
* $W$가 $X$나 $Z$의 자손(descendant)이 아닌 공변량 집합일 때, 다음이 성립해야 합니다.

$$
Y_{x^{*}z} \perp \!\!\! \perp Z_{x} \mid W
$$

* 이 가정은 **"교란 요인 $W$를 통제했을 때, 매개변수 $Z$를 결정하는 메커니즘과, $Z$가 주어졌을 때 $Y$를 결정하는 메커니즘이 서로 독립적이어야 한다"**는 것을 의미합니다. 즉, $Z \to Y$ 관계에 우리가 모르는 교란 요인(Unobserved Confounder)이 없어야 한다는 강력한 가정입니다.

## 4.2. The Mediation Formula

* 위 가정이 성립하면, NIE는 관측 가능한 확률분포들의 조합으로 식별 가능합니다.

$$
NIE(x,x^{*};Y) = \sum_{w}\sum_{z} \mathbb{E}(Y \mid x^{*},z, w) [P(z \mid x, w) - P(z \mid x^{*}, w)] P(w)
$$

* 이 식은 다음과 같은 요소들로 구성됩니다:
  * 1.  $\mathbb{E}(Y \mid x^{*},z, w)$: $X$는 기준값 $x^*$로, $Z$는 특정 값 $z$로 주어졌을 때의 $Y$의 기댓값 (Outcome Model)
  * 2.  $P(z \mid x, w) - P(z \mid x^{*}, w)$: 처치($x$)와 대조($x^*$) 조건 하에서 매개변수 $Z$가 값 $z$를 가질 확률의 차이 (Mediator Model)
  * 3.  $P(w)$: 공변량 $W$에 대한 가중 합

## 4.3. Simplification in Markovian Models

* 만약 모델이 **Markovian**이라면 (즉, 숨겨진 교란 요인이 없고 변수 간 관계가 DAG로 완벽히 표현된다면), 식은 훨씬 간단해집니다.

$$
NIE(x,x^{*};Y) = \sum_{z} \mathbb{E}(Y \mid x^{*}, z) [P(z \mid x) - P(z \mid x^{*})]
$$

* 이 **Mediation Formula**는 매개 분석에서 가장 널리 쓰이는 공식 중 하나로, 복잡한 반사실적 개념 없이도 회귀분석 등을 통해 $E(Y|X,Z)$와 $P(Z|X)$만 추정하면 간접 효과를 계산할 수 있게 해줍니다.