<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>shsha0110.github.io</title>
<link>https://shsha0110.github.io/</link>
<atom:link href="https://shsha0110.github.io/index.xml" rel="self" type="application/rss+xml"/>
<description>A blog built with Quarto</description>
<generator>quarto-1.8.26</generator>
<lastBuildDate>Mon, 12 Jan 2026 15:00:00 GMT</lastBuildDate>
<item>
  <title>[Causal Inference] 8. Partial Identification (Part 4)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-08-part-04/</link>
  <description><![CDATA[ 





<section id="overview" class="level1">
<h1>Overview</h1>
<ul>
<li><p>이번 포스트에서는 실험 설계에서 흔히 발생하는 <strong>비순응(Non-compliance)</strong> 문제를 다룹니다.</p></li>
<li><p>할당된 처치(<img src="https://latex.codecogs.com/png.latex?Z">)와 실제 받은 처치(<img src="https://latex.codecogs.com/png.latex?X">)가 일치하지 않는 상황에서, 인과 효과(ATE)를 식별하고 추정하는 다양한 방법들을 코드로 구현하고 비교해 봅니다.</p></li>
<li><p>주요 내용은 다음과 같습니다.</p></li>
</ul>
<ol type="1">
<li><strong>데이터 생성 (Data Generation):</strong> Compliance Type과 Response Type을 기반으로 가상 데이터 생성</li>
<li><strong>점 추정 (Point Estimate):</strong> 도구변수(IV)를 활용한 LATE 추정 (DoWhy 라이브러리 활용)</li>
<li><strong>구간 추정 (Interval Estimate):</strong>
<ul>
<li><strong>Natural Bounds (Manski):</strong> 가정 없이 관측 데이터만으로 도출한 구간</li>
<li><strong>IV Natural Bounds:</strong> 도구변수 가정을 추가했을 때의 구간</li>
<li><strong>Balke-Pearl Bounds (LP):</strong> 선형 계획법(Linear Programming)을 이용한 최적 구간</li>
</ul></li>
<li><strong>결과 비교 및 시각화</strong></li>
</ol>
<hr>
</section>
<section id="라이브러리-임포트" class="level1">
<h1>1. 라이브러리 임포트</h1>
<ul>
<li>실습에 필요한 라이브러리를 불러옵니다. <code>scipy.optimize.linprog</code>는 Balke-Pearl Bounds를 계산하는 데 사용되며, <code>dowhy</code>는 인과 추론을 위한 라이브러리입니다.</li>
</ul>
<div id="0dd6e322" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> linprog</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dowhy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CausalModel</span></code></pre></div></div>
</details>
</div>
</section>
<section id="데이터-생성-data-generation" class="level1">
<h1>2. 데이터 생성 (Data Generation)</h1>
<ul>
<li>가상의 시나리오를 생성합니다.</li>
<li>인구 집단은 <strong>Compliance Type</strong>(순응 유형: Never-taker, Complier, Defier, Always-taker)과 <strong>Response Type</strong>(반응 유형: Never-recover, Helped, Hurt, Always-recover)의 조합인 총 16가지 유형으로 구성됩니다.</li>
<li>각 유형별 비율(<code>probs</code>)을 설정하고, 이에 따라 데이터를 생성한 뒤 실제 참값인 <strong>True ATE</strong>를 계산합니다.</li>
</ul>
<div id="155259d2" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 데이터 생성 (Data Generation)</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb2-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_class_scenario_data(probs, n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, seed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>):</span>
<span id="cb2-5">    np.random.seed(seed)</span>
<span id="cb2-6">    </span>
<span id="cb2-7">    probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> probs.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb2-8">    </span>
<span id="cb2-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 샘플 생성</span></span>
<span id="cb2-10">    flat_probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> probs.flatten()</span>
<span id="cb2-11">    types_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.choice(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n, p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>flat_probs)</span>
<span id="cb2-12">    r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> types_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compliance Type</span></span>
<span id="cb2-13">    r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> types_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Response Type</span></span>
<span id="cb2-14">    </span>
<span id="cb2-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 구조 방정식 (Structural Equations)</span></span>
<span id="cb2-16">    z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.binomial(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Z는 무작위</span></span>
<span id="cb2-17">    </span>
<span id="cb2-18">    x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Never-taker</span></span>
<span id="cb2-19">    x[r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> z[r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Complier</span></span>
<span id="cb2-20">    x[r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> z[r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Defier</span></span>
<span id="cb2-21">    x[r_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Always-taker</span></span>
<span id="cb2-22">    </span>
<span id="cb2-23">    y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Never-recover</span></span>
<span id="cb2-24">    y[r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Helped</span></span>
<span id="cb2-25">    y[r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x[r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Hurt</span></span>
<span id="cb2-26">    y[r_y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                 <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Always-recover</span></span>
<span id="cb2-27">    </span>
<span id="cb2-28">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>: z, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>: x, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>: y})</span>
<span id="cb2-29">    </span>
<span id="cb2-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True ATE 계산</span></span>
<span id="cb2-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True ATE = P(Y = 1 | do(X = 1)) - P(Y = 1 | do(X = 0))</span></span>
<span id="cb2-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#          = {P(Helped) + P(Always-recover)} - {P(Hurt) + P(Always-recover)}</span></span>
<span id="cb2-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#          = P(Helped) - P(Hurt)</span></span>
<span id="cb2-34">    true_ate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> probs[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> probs[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb2-35">    </span>
<span id="cb2-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df, true_ate, probs</span></code></pre></div></div>
</details>
</div>
</section>
<section id="point-estimate-late-by-dowhy" class="level1">
<h1>3. Point Estimate: LATE (by DoWhy)</h1>
<ul>
<li><code>DoWhy</code> 라이브러리를 사용하여 점 추정치를 계산합니다. 여기서 <img src="https://latex.codecogs.com/png.latex?Z">를 도구변수(Instrument)로 사용하여 <strong>LATE (Local Average Treatment Effect)</strong>, 즉 Complier 집단에 대한 효과를 추정합니다.</li>
</ul>
<div id="6eed746e" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Point Estimate: DoWhy를 이용한 LATE 추정</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb3-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> point_estimate(df):</span>
<span id="cb3-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    DoWhy 라이브러리를 사용하여 IV(도구변수) 추정량을 계산합니다.</span></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb3-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Causal Model 정의 (Graph)</span></span>
<span id="cb3-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Z -&gt; X -&gt; Y, U -&gt; X, U -&gt; Y (U는 Unobserved Confounder)</span></span>
<span id="cb3-10">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CausalModel(</span>
<span id="cb3-11">        data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df,            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터</span></span>
<span id="cb3-12">        treatment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>,      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 원인 변수 (약 복용 여부)</span></span>
<span id="cb3-13">        outcome<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>,        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 변수 (완치 여부)</span></span>
<span id="cb3-14">        instruments<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 변수 (의사 처방)</span></span>
<span id="cb3-15">        common_causes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[]    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 공통 원인 (교란 변수 U)</span></span>
<span id="cb3-16">    )</span>
<span id="cb3-17">    </span>
<span id="cb3-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 식별 (Identification)</span></span>
<span id="cb3-19">    identified_estimand <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.identify_effect(proceed_when_unidentifiable<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-20">    </span>
<span id="cb3-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 추정 (Estimation) - Wald Estimator (IV 방식)</span></span>
<span id="cb3-22">    estimate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.estimate_effect(</span>
<span id="cb3-23">        identified_estimand,</span>
<span id="cb3-24">        method_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"iv.instrumental_variable"</span></span>
<span id="cb3-25">    )</span>
<span id="cb3-26">    </span>
<span id="cb3-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> estimate.value</span></code></pre></div></div>
</details>
</div>
</section>
<section id="interval-estimate-balke-pearl-bounds-lp" class="level1">
<h1>4. Interval Estimate: Balke-Pearl Bounds (LP)</h1>
<ul>
<li>Partial Identification의 핵심인 <strong>Balke-Pearl Bounds</strong>를 계산합니다.</li>
<li>이는 관측된 확률 분포 <img src="https://latex.codecogs.com/png.latex?P(X,%20Y%20%7C%20Z)">와 IV 가정(Exclusion Restriction, Random Assignment 등)을 만족하는 모든 가능한 잠재 변수 분포를 고려하여, ATE의 최소값과 최대값을 <strong>선형 계획법(Linear Programming)</strong>으로 찾아냅니다.</li>
</ul>
<div id="a820a62b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Interval Estimate: Linear Programming (Balke-Pearl Bounds)</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb4-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> lp_bounds(df):</span>
<span id="cb4-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 관측 확률 계산</span></span>
<span id="cb4-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># p_yx.z = P(X = x, Y = y | Z = z) 가 계산됨.</span></span>
<span id="cb4-7">    p_obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>]).size() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>).size()</span>
<span id="cb4-8">    p_obs_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {idx: val <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> idx, val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> p_obs.items()}</span>
<span id="cb4-9">    </span>
<span id="cb4-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 최적화 함수 정의 (앞서 작성한 로직)</span></span>
<span id="cb4-11">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> solve_lp(objective_coef):</span>
<span id="cb4-12">        num_vars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span></span>
<span id="cb4-13">        </span>
<span id="cb4-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 제약조건 A_eq(좌변), b_eq(우변) 생성</span></span>
<span id="cb4-15">        A_eq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-16">        b_eq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-17">        </span>
<span id="cb4-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (1) 확률 총합 = 1</span></span>
<span id="cb4-19">        A_eq.append([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> num_vars)</span>
<span id="cb4-20">        b_eq.append(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-21">        </span>
<span id="cb4-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (2) 관측 데이터 정합성 (8개 방정식)</span></span>
<span id="cb4-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> z <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]:</span>
<span id="cb4-24">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]:</span>
<span id="cb4-25">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> y <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]:</span>
<span id="cb4-26">                    row <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> num_vars</span>
<span id="cb4-27">                    target_prob <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p_obs_dict.get((y, x, z), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-28">                    </span>
<span id="cb4-29">                    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 16개 유형에 대해 Canonical Model 매핑</span></span>
<span id="cb4-30">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> j <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>): <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compliance</span></span>
<span id="cb4-31">                        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>): <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Response</span></span>
<span id="cb4-32">                            rx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [j<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, j<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [X|Z=0, X|Z=1]</span></span>
<span id="cb4-33">                            ry <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [Y|X=0, Y|X=1]</span></span>
<span id="cb4-34">                            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (rx[z] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> x) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> (ry[x] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> y) :</span>
<span id="cb4-35">                                row[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> j <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> k] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-36">                                </span>
<span id="cb4-37">                    A_eq.append(row)</span>
<span id="cb4-38">                    b_eq.append(target_prob)</span>
<span id="cb4-39">                    </span>
<span id="cb4-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LP 실행</span></span>
<span id="cb4-41">        bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_vars)]</span>
<span id="cb4-42">        res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> linprog(objective_coef, A_eq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>A_eq, b_eq<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>b_eq, bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bounds)</span>
<span id="cb4-43">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> res.fun</span>
<span id="cb4-44"></span>
<span id="cb4-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. 목적 함수 설정 (ATE = Helped - Hurt)</span></span>
<span id="cb4-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ATE = P(Y = 1 | do(X = 1)) - P(Y = 1 | do(X = 0))</span></span>
<span id="cb4-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     = {P(Helped) + P(Always-recover)} - {P(Hurt) + P(Always-recover)}</span></span>
<span id="cb4-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     = P(Helped) - P(Hurt)</span></span>
<span id="cb4-49">    coef_ate_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-50">    coef_ate_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> j <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>):</span>
<span id="cb4-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> k <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>):</span>
<span id="cb4-53">            val <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-54">            coef_ate_min.append(val)</span>
<span id="cb4-55">            coef_ate_max.append(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>val)</span>
<span id="cb4-56">            </span>
<span id="cb4-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. 결과 도출</span></span>
<span id="cb4-58">    min_ate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> solve_lp(coef_ate_min)</span>
<span id="cb4-59">    max_ate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>solve_lp(coef_ate_max) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 부호 원복</span></span>
<span id="cb4-60">    </span>
<span id="cb4-61">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> min_ate, max_ate</span></code></pre></div></div>
</details>
</div>
<section id="natural-bounds" class="level2">
<h2 class="anchored" data-anchor-id="natural-bounds">5. Natural Bounds</h2>
<p>비교를 위해 더 넓은 구간을 가지는 Natural Bounds를 계산합니다.</p>
<ol type="1">
<li><strong>IV Natural Bounds</strong>: 도구변수가 있을 때의 최악의 경우(Worst-case) 구간</li>
<li><strong>Pure Manski Bounds</strong>: 도구변수 없이 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(Y,%20X)">만으로 계산한 구간 (가장 넓음)</li>
</ol>
<div id="86aad66f" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4.1 Natural Bounds</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calculate_natural_bounds_iv(df):</span>
<span id="cb5-5">    p_xy_z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>]).size() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>).size()</span>
<span id="cb5-6">    </span>
<span id="cb5-7">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_p_xy_z(y, x, z):</span>
<span id="cb5-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> p_xy_z.get((y, x, z), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-9">    </span>
<span id="cb5-10">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_p_x_z(x, z):</span>
<span id="cb5-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, x, z) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, x, z)</span>
<span id="cb5-12"></span>
<span id="cb5-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. P(Y=1 | do(X=1)) Bounds </span></span>
<span id="cb5-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a = max_z P(y, x | z)</span></span>
<span id="cb5-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># b = min_z P(y, x | z) + 1 - P(x | z)</span></span>
<span id="cb5-16">    lower_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-17">    upper_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb5-18">                    get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-19">    </span>
<span id="cb5-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. P(Y=1 | do(X=0)) Bounds</span></span>
<span id="cb5-21">    lower_do0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-22">    upper_do0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb5-23">                    get_p_xy_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x_z(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb5-24">    </span>
<span id="cb5-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. ATE Bounds (Worst Case)</span></span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ATE = do(1) - do(0)</span></span>
<span id="cb5-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Min ATE = Min(do1) - Max(do0)</span></span>
<span id="cb5-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Max ATE = Max(do1) - Min(do0)</span></span>
<span id="cb5-29">    nat_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lower_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> upper_do0</span>
<span id="cb5-30">    nat_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> upper_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lower_do0</span>
<span id="cb5-31">    </span>
<span id="cb5-32">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> nat_min, nat_max</span>
<span id="cb5-33"></span>
<span id="cb5-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb5-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4.2 Natural Bounds</span></span>
<span id="cb5-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================================================================</span></span>
<span id="cb5-37"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calculate_natural_bounds(df):</span>
<span id="cb5-38">    p_xy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>]).size() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df)</span>
<span id="cb5-39">    </span>
<span id="cb5-40">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_p_xy(y, x):</span>
<span id="cb5-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> p_xy.get((y, x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-42"></span>
<span id="cb5-43">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_p_x(x):</span>
<span id="cb5-44">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, x)</span>
<span id="cb5-45">        </span>
<span id="cb5-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. P(Y=1 | do(X=1)) Bounds </span></span>
<span id="cb5-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a = P(y, x)</span></span>
<span id="cb5-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># b = P(y, x) + 1 - P(x)</span></span>
<span id="cb5-49">    lower_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-50">    upper_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-51">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. P(Y=1 | do(X=0)) Bounds </span></span>
<span id="cb5-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a = P(y, x)</span></span>
<span id="cb5-53">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># b = P(y, x) + 1 - P(x)</span></span>
<span id="cb5-54">    lower_do0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-55">    upper_do0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_p_xy(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> get_p_x(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb5-56">    </span>
<span id="cb5-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. ATE Bounds (Worst Case)</span></span>
<span id="cb5-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ATE = do(1) - do(0)</span></span>
<span id="cb5-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Min ATE = Min(do1) - Max(do0)</span></span>
<span id="cb5-60">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Max ATE = Max(do1) - Min(do0)</span></span>
<span id="cb5-61">    nat_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lower_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> upper_do0</span>
<span id="cb5-62">    nat_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> upper_do1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lower_do0</span>
<span id="cb5-63">    </span>
<span id="cb5-64">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> nat_min, nat_max</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="시각화-및-비교-comparision" class="level1">
<h1>6. 시각화 및 비교 (Comparision)</h1>
<ul>
<li>마지막으로 계산된 모든 추정치와 구간을 시각화하여 비교합니다.</li>
<li><code>Naive Estimate</code>는 단순히 <img src="https://latex.codecogs.com/png.latex?E%5BY%7CX=1%5D%20-%20E%5BY%7CX=0%5D">으로 계산되어 편향(Bias)이 존재함을 확인할 수 있습니다.</li>
</ul>
<div id="9a8d6ed2" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compare_and_visualize(df, true_ate, point_est, lp_bounds, nat_bounds, manski_bounds, probs_matrix):</span>
<span id="cb6-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. 데이터 전처리</span></span>
<span id="cb6-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 관측 확률 P(Y, X | Z) 계산 (Bar Chart용)</span></span>
<span id="cb6-6">    p_obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>]).size() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z'</span>).size()</span>
<span id="cb6-7">    p_obs_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {idx: val <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> idx, val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> p_obs.items()}</span>
<span id="cb6-8">    </span>
<span id="cb6-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Naive Estimate (단순 평균 차이) - 편향 확인용</span></span>
<span id="cb6-10">    naive_ate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>].mean() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'X'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y'</span>].mean()</span>
<span id="cb6-11"></span>
<span id="cb6-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. 캔버스 설정</span></span>
<span id="cb6-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-15">    fig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb6-16">    plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Causal Effect Analysis: Partial Identification (IV)"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>)</span>
<span id="cb6-17">    gs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.add_gridspec(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, height_ratios<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb6-18">    </span>
<span id="cb6-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [Plot 1] 관측 데이터 분포 P(Y, X | Z)</span></span>
<span id="cb6-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-22">    ax1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.add_subplot(gs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb6-23">    scenarios <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z=0</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(No Prescription)'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Z=1</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">(Prescription)'</span>]</span>
<span id="cb6-24">    x_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(scenarios))</span>
<span id="cb6-25">    width <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb6-26"></span>
<span id="cb6-27">    p_00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb6-28">    p_10 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb6-29">    p_01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb6-30">    p_11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), p_obs_dict.get((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)]</span>
<span id="cb6-31"></span>
<span id="cb6-32">    ax1.bar(x_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>width, p_00, width, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y=0, X=0'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb6-33">    ax1.bar(x_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>width, p_10, width, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y=1, X=0'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb6-34">    ax1.bar(x_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>width, p_01, width, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y=0, X=1'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb6-35">    ax1.bar(x_loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>width, p_11, width, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Y=1, X=1'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb6-36"></span>
<span id="cb6-37">    ax1.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Probability'</span>)</span>
<span id="cb6-38">    ax1.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'1. Observational Distribution $P(Y, X | Z)$'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>)</span>
<span id="cb6-39">    ax1.set_xticks(x_loc)</span>
<span id="cb6-40">    ax1.set_xticklabels(scenarios)</span>
<span id="cb6-41">    ax1.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>, bbox_to_anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'small'</span>)</span>
<span id="cb6-42">    ax1.set_ylim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb6-43">    ax1.grid(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span>)</span>
<span id="cb6-44"></span>
<span id="cb6-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [Plot 2] 숨겨진 유형 분포 (Latent Compliance Types)</span></span>
<span id="cb6-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-48">    ax2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.add_subplot(gs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb6-49">    comp_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Never-taker'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Complier'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Defier'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Always-taker'</span>]</span>
<span id="cb6-50">    comp_probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> probs_matrix.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-51">    colors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#d3d3d3'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#66b3ff'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#ff9999'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#ffcc99'</span>]</span>
<span id="cb6-52">    </span>
<span id="cb6-53">    ax2.pie(comp_probs, labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>comp_labels, autopct<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%1.1f%%</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, startangle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, colors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>colors, </span>
<span id="cb6-54">            wedgeprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'w'</span>))</span>
<span id="cb6-55">    ax2.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'2. Latent Compliance Types (Unobserved U)'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>)</span>
<span id="cb6-56">    </span>
<span id="cb6-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [Plot 3] Bounds Comparison</span></span>
<span id="cb6-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------</span></span>
<span id="cb6-60">    ax3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fig.add_subplot(gs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, :])</span>
<span id="cb6-61">    y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb6-62">    </span>
<span id="cb6-63">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3-1. Pure Manski Bounds (가장 넓은 구간) - 매우 연한 회색</span></span>
<span id="cb6-64">    ax3.plot([manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], [y_pos, y_pos], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#e0e0e0'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Pure Manski (No Z)'</span>)</span>
<span id="cb6-65">    ax3.plot([manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]], [y_pos<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, y_pos<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#e0e0e0'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-66">    ax3.plot([manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], [y_pos<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>, y_pos<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'#e0e0e0'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-67"></span>
<span id="cb6-68">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3-2. IV Natural Bounds (중간 구간) - 회색 (강의자료 Bounds)</span></span>
<span id="cb6-69">    ax3.plot(nat_bounds, [y_pos, y_pos], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'IV Natural Bounds'</span>)</span>
<span id="cb6-70">    </span>
<span id="cb6-71">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3-3. LP Bounds (좁은 구간) - 파란색</span></span>
<span id="cb6-72">    ax3.plot(lp_bounds, [y_pos, y_pos], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Balke-Pearl LP Bounds'</span>)</span>
<span id="cb6-73">    </span>
<span id="cb6-74">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3-4. Estimates (점)</span></span>
<span id="cb6-75">    ax3.scatter(true_ate, y_pos, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, edgecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'True ATE (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>true_ate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb6-76">    ax3.scatter(point_est, y_pos, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, edgecolors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'DoWhy Estimate (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>point_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb6-77">    ax3.scatter(naive_ate, y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'Naive Estimate (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>naive_ate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>)</span>
<span id="cb6-78"></span>
<span id="cb6-79">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3-5. 텍스트 주석</span></span>
<span id="cb6-80">    ax3.text(lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>)</span>
<span id="cb6-81">    ax3.text(lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>)</span>
<span id="cb6-82">    </span>
<span id="cb6-83">    ax3.text(manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb6-84">    ax3.text(manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gray'</span>)</span>
<span id="cb6-85">    </span>
<span id="cb6-86">    ax3.text(naive_ate, y_pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Biased Naive'</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb6-87"></span>
<span id="cb6-88">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 설정</span></span>
<span id="cb6-89">    ax3.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'3. Comparison: Point Estimate vs. Bounds (Manski &gt; IV Natural &gt; LP)'</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, fontweight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bold'</span>)</span>
<span id="cb6-90">    ax3.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Average Treatment Effect (ATE)"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>)</span>
<span id="cb6-91">    ax3.set_yticks([])</span>
<span id="cb6-92">    ax3.set_ylim(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3</span>)</span>
<span id="cb6-93">    </span>
<span id="cb6-94">    margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb6-95">    ax3.set_xlim(manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> margin, manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> margin)</span>
<span id="cb6-96">    </span>
<span id="cb6-97">    ax3.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper right'</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'small'</span>)</span>
<span id="cb6-98">    ax3.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb6-99"></span>
<span id="cb6-100">    plt.tight_layout()</span>
<span id="cb6-101">    plt.subplots_adjust(top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90</span>)</span>
<span id="cb6-102">    plt.show()</span>
<span id="cb6-103"></span>
<span id="cb6-104">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 텍스트 출력</span></span>
<span id="cb6-105">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"True ATE      : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>true_ate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-106">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"DoWhy Estimate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>point_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-107">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb6-108">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"1. Pure Manski (No Z) : [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] (Width: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>manski_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span>
<span id="cb6-109">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"2. IV Natural (With Z) : [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>nat_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>nat_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] (Width: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>nat_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>nat_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span>
<span id="cb6-110">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"3. Balke-Pearl (LP)   : [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] (Width: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lp_bounds[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="실행-execution" class="level1">
<h1>7. 실행 (Execution)</h1>
<ul>
<li>서로 다른 도구변수 강도(Strength of IV)를 가진 두 가지 시나리오를 실행하여 결과를 비교합니다.</li>
</ul>
<section id="strong-iv-scenario" class="level2">
<h2 class="anchored" data-anchor-id="strong-iv-scenario">7.1 Strong IV Scenario</h2>
<ul>
<li>첫 번째는 Strong IV 상황입니다.</li>
<li>Complier의 비율이 약 80%로 매우 높고, Never-taker나 Defier의 비율이 낮습니다.</li>
<li>즉, 의사의 처방(Z)이 실제 복용 여부(X)를 매우 강력하게 결정합니다.</li>
</ul>
<div id="b511fb01" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Data Generation</span></span>
<span id="cb7-2">probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([</span>
<span id="cb7-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ry=0(Never) Ry=1(Helped) Ry=2(Hurt) Ry=3(Always)</span></span>
<span id="cb7-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------</span></span>
<span id="cb7-5">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Never-taker (Rx=0)</span></span>
<span id="cb7-6">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.60</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Complier (Rx=1)</span></span>
<span id="cb7-7">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Defier (Rx=2)</span></span>
<span id="cb7-8">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00</span>]    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Always-taker (Rx=3)</span></span>
<span id="cb7-9">])</span>
<span id="cb7-10"></span>
<span id="cb7-11">df, true_ate, probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_class_scenario_data(probs) </span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Point Estimate</span></span>
<span id="cb7-14">point_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> point_estimate(df)</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Interval Estimate (LP)</span></span>
<span id="cb7-17">lp_min, lp_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lp_bounds(df)</span>
<span id="cb7-18"></span>
<span id="cb7-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Natural Bounds</span></span>
<span id="cb7-20">nat_min, nat_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calculate_natural_bounds_iv(df)</span>
<span id="cb7-21">manski_min, manski_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calculate_natural_bounds(df)</span>
<span id="cb7-22"></span>
<span id="cb7-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. Visualization</span></span>
<span id="cb7-24">compare_and_visualize(</span>
<span id="cb7-25">    df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, </span>
<span id="cb7-26">    true_ate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true_ate, </span>
<span id="cb7-27">    point_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>point_est, </span>
<span id="cb7-28">    lp_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(lp_min, lp_max), </span>
<span id="cb7-29">    nat_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(nat_min, nat_max), </span>
<span id="cb7-30">    manski_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(manski_min, manski_max),</span>
<span id="cb7-31">    probs_matrix<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>probs</span>
<span id="cb7-32">)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-04/index_files/figure-html/cell-8-output-1.png" width="1526" height="916" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>True ATE      : 0.6500
DoWhy Estimate: 0.6853
------------------------------
1. Pure Manski (No Z) : [-0.1769, 0.8231] (Width: 1.0000)
2. IV Natural (With Z) : [0.4991, 0.6972] (Width: 0.1981)
3. Balke-Pearl (LP)   : [0.4991, 0.6972] (Width: 0.1981)</code></pre>
</div>
</div>
<ul>
<li><p>해석</p>
<ul>
<li><p><strong>Complier 비중:</strong> 약 80%로, 도구변수 <img src="https://latex.codecogs.com/png.latex?Z">가 <img src="https://latex.codecogs.com/png.latex?X">를 강력하게 설명합니다.</p></li>
<li><p><strong>LP Bounds:</strong> 너비가 약 0.20으로 매우 좁게 형성되었습니다. 이는 관측 데이터만으로도 True ATE의 범위를 상당히 좁힐 수 있음을 의미합니다.</p></li>
<li><p><strong>Estimates:</strong> Point Estimate (LATE)가 True ATE에 매우 근접해 있습니다.</p></li>
</ul></li>
</ul>
</section>
<section id="weak-iv-scenario" class="level2">
<h2 class="anchored" data-anchor-id="weak-iv-scenario">7.2 Weak IV Scenario</h2>
<ul>
<li>두 번째는 Weak IV 상황입니다.</li>
<li>Complier의 비율이 5%로 극히 낮고, Never-taker(약 35%)와 Always-taker(약 40%)의 비율이 매우 높습니다.</li>
<li>즉, 의사가 처방을 하든 말든(Z), 사람들은 대부분 자기 맘대로 행동하므로 도구변수가 무력합니다.</li>
</ul>
<div id="b9472877" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Data Generation</span></span>
<span id="cb9-2">probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([</span>
<span id="cb9-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ry=0(Never) Ry=1(Helped) Ry=2(Hurt) Ry=3(Always)</span></span>
<span id="cb9-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------</span></span>
<span id="cb9-5">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Never-taker (Rx=0)</span></span>
<span id="cb9-6">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Complier (Rx=1)</span></span>
<span id="cb9-7">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>],   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Defier (Rx=2)</span></span>
<span id="cb9-8">    [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,        <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>,      <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>]    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Always-taker (Rx=3)</span></span>
<span id="cb9-9">])</span>
<span id="cb9-10"></span>
<span id="cb9-11">df, true_ate, probs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_class_scenario_data(probs) </span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Point Estimate</span></span>
<span id="cb9-14">point_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> point_estimate(df)</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Interval Estimate (LP)</span></span>
<span id="cb9-17">lp_min, lp_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lp_bounds(df)</span>
<span id="cb9-18"></span>
<span id="cb9-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Natural Bounds</span></span>
<span id="cb9-20">nat_min, nat_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calculate_natural_bounds_iv(df)</span>
<span id="cb9-21">manski_min, manski_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calculate_natural_bounds(df)</span>
<span id="cb9-22"></span>
<span id="cb9-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. Visualization</span></span>
<span id="cb9-24">compare_and_visualize(</span>
<span id="cb9-25">    df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, </span>
<span id="cb9-26">    true_ate<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>true_ate, </span>
<span id="cb9-27">    point_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>point_est, </span>
<span id="cb9-28">    lp_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(lp_min, lp_max), </span>
<span id="cb9-29">    nat_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(nat_min, nat_max), </span>
<span id="cb9-30">    manski_bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(manski_min, manski_max),</span>
<span id="cb9-31">    probs_matrix<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>probs</span>
<span id="cb9-32">)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-04/index_files/figure-html/cell-9-output-1.png" width="1526" height="916" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>True ATE      : 0.0600
DoWhy Estimate: -0.1393
------------------------------
1. Pure Manski (No Z) : [-0.4769, 0.5231] (Width: 1.0000)
2. IV Natural (With Z) : [-0.4082, 0.4322] (Width: 0.8404)
3. Balke-Pearl (LP)   : [-0.4082, 0.4322] (Width: 0.8404)</code></pre>
</div>
</div>
<ul>
<li><p>해석</p>
<ul>
<li><p><strong>Complier 비중:</strong> 5%에 불과하여 <img src="https://latex.codecogs.com/png.latex?Z">와 <img src="https://latex.codecogs.com/png.latex?X">의 상관관계가 매우 약합니다.</p></li>
<li><p><strong>LP Bounds:</strong> 너비가 0.84로 매우 넓습니다. 이는 1.0(전체 가능한 범위)에 가까운 수치로, 도구변수 가정을 도입했음에도 불구하고 ATE에 대해 “거의 아무것도 모르는 상태”와 다를 바 없습니다.</p></li>
<li><p><strong>Estimates:</strong> Point Estimate (LATE)가 True ATE와 큰 차이를 보이고, 부호가 다르다. 이는 분모(<img src="https://latex.codecogs.com/png.latex?E%5BX%E2%88%A3Z=1%5D%E2%88%92E%5BX%E2%88%A3Z=0%5D">)가 0에 가까워지면서 추정량이 불안정해지기 때문입니다.</p></li>
</ul></li>
</ul>


</section>
</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-08-part-04/</guid>
  <pubDate>Mon, 12 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 8. Partial Identification (Part 3)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-08-part-03/</link>
  <description><![CDATA[ 





<section id="개요-overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 개요 (Overview)</h1>
<ul>
<li>지난 포스트들에서 우리는 <strong>Natural Bounds</strong>와 <strong>도구 변수(IV)</strong>를 활용한 식별 범위 추정에 대해 알아보았습니다.</li>
<li>이번 포스트에서는 Partial Identification 시리즈의 마지막으로, <strong>Backdoor 기준을 만족하는 변수들이 부분적으로만 관측될 때(Partially-observed)</strong> 어떻게 인과 효과의 범위를 구할 수 있는지 살펴봅니다.</li>
<li>이는 데이터가 서로 다른 소스에서 수집되어 결합 분포(Joint Distribution)를 완전히 알 수 없는 현실적인 상황(예: <img src="https://latex.codecogs.com/png.latex?X,%20Y"> 데이터와 <img src="https://latex.codecogs.com/png.latex?U"> 데이터가 따로 있을 때)에서 매우 유용한 접근법입니다.</li>
</ul>
<hr>
</section>
<section id="그래프-구조" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 그래프 구조</h1>
<ul>
<li>다음과 같은 인과 그래프를 가정해 봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-03/images/partially_observed_graph.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Backdoor Graph with W and U. W와 U는 X와 Y의 공통 원인(Backdoor path)입니다.</figcaption>
</figure>
</div>
<ul>
<li><strong><img src="https://latex.codecogs.com/png.latex?X"></strong>: 처치 (Treatment)</li>
<li><strong><img src="https://latex.codecogs.com/png.latex?Y"></strong>: 결과 (Outcome)</li>
<li><strong><img src="https://latex.codecogs.com/png.latex?%5C%7BW,%20U%5C%7D"></strong>: Backdoor Admissible Set. 즉, 이 두 변수를 통제하면 <img src="https://latex.codecogs.com/png.latex?X%20%5Cto%20Y"> 인과 효과를 식별할 수 있습니다.</li>
</ul>
</section>
<section id="데이터의-제약-data-constraints" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 데이터의 제약 (Data Constraints)</h1>
<ul>
<li>이상적인 상황이라면 우리는 전체 결합 분포 <img src="https://latex.codecogs.com/png.latex?P(X,%20Y,%20W,%20U)">를 관측하여 다음과 같이 Backdoor adjustment를 수행하면 됩니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(y%7Cdo(x))%20=%20%5Csum_%7Bw,%20u%7D%20P(y%7Cx,%20w,%20u)P(w,%20u)%0A"></p>
<ul>
<li>하지만 현실에서는 <strong>데이터의 제약</strong>이 있을 수 있습니다.</li>
<li>예를 들어:
<ul>
<li><strong>관측 가능:</strong> <img src="https://latex.codecogs.com/png.latex?P(X,%20Y,%20W)"> (실험 데이터), <img src="https://latex.codecogs.com/png.latex?P(U)"> (외부 센서스 데이터 등)</li>
<li><strong>관측 불가능:</strong> <img src="https://latex.codecogs.com/png.latex?P(X,%20Y,%20W,%20U)"> (전체 결합 분포)</li>
</ul></li>
<li>이때 우리는 <img src="https://latex.codecogs.com/png.latex?U">가 <img src="https://latex.codecogs.com/png.latex?X,%20Y,%20W">와 어떻게 얽혀있는지(Joint distribution)를 모르기 때문에, 점 추정(Point Identification)이 불가능합니다.</li>
<li>우리의 목표는 주어진 주변 분포(Marginal distributions) 정보를 최대한 활용하여 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">의 <strong>Bound</strong>를 구하는 것입니다.</li>
</ul>
</section>
<section id="최적화-문제로의-변환-optimization-perspective" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 최적화 문제로의 변환 (Optimization Perspective)</h1>
<ul>
<li>Li and Pearl (2022)의 연구에서는 이 문제를 <strong>제약 조건이 있는 최적화 문제</strong>로 변환하여 해결합니다.</li>
</ul>
<section id="목표-식-재구성" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="목표-식-재구성"><span class="header-section-number">4.1</span> 목표 식 재구성</h2>
<ul>
<li>Backdoor 공식을 조건부 확률 정의에 따라 풀어쓰면 다음과 같습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_%7Bw,%20u%7D%20P(y%7Cx,%20w,%20u)P(w,%20u)%20%5C%5C%0A&amp;=%20%5Csum_%7Bw,%20u%7D%20%5Cfrac%7BP(x,%20y,%20w,%20u)P(w,%20u)%7D%7BP(x,%20w,%20u)%7D%0A%5Cend%7Baligned%7D%0A"></p>
<ul>
<li>이 식의 구성 요소들을 각각 미지수로 정의하여 최적화 문제를 설계합니다.</li>
</ul>
</section>
<section id="파라미터-정의" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="파라미터-정의"><span class="header-section-number">4.2</span> 파라미터 정의</h2>
<ul>
<li><p>각 <img src="https://latex.codecogs.com/png.latex?(w,%20u)"> 조합에 대해 다음 세 가지 변수를 정의합니다.</p>
<ul>
<li><ol type="1">
<li><strong><img src="https://latex.codecogs.com/png.latex?a_%7Bw,u%7D%20=%20P(x,%20y,%20w,%20u)"></strong>: 전체 결합 확률의 일부</li>
</ol></li>
<li><ol start="2" type="1">
<li><strong><img src="https://latex.codecogs.com/png.latex?b_%7Bw,u%7D%20=%20P(w,%20u)"></strong>: 교란 변수들의 결합 확률</li>
</ol></li>
<li><ol start="3" type="1">
<li><strong><img src="https://latex.codecogs.com/png.latex?c_%7Bw,u%7D%20=%20P(x,%20w,%20u)"></strong>: 처치와 교란 변수들의 결합 확률</li>
</ol></li>
</ul></li>
<li><p>이제 우리의 목표 함수(Objective Function)는 다음과 같습니다.</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7Bmin%20/%20max%20%7D%20%5Csum_%7Bw,%20u%7D%20%5Cfrac%7Ba_%7Bw,u%7D%20%5Ccdot%20b_%7Bw,u%7D%7D%7Bc_%7Bw,u%7D%7D%0A"></p>
</section>
<section id="제약-조건-constraints" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="제약-조건-constraints"><span class="header-section-number">4.3</span> 제약 조건 (Constraints)</h2>
<ul>
<li><p>우리가 관측한 데이터(<img src="https://latex.codecogs.com/png.latex?P(X,Y,W)">와 <img src="https://latex.codecogs.com/png.latex?P(U)">)는 이 미지수들의 합으로 표현되어야 합니다. 이것이 최적화 문제의 제약 조건이 됩니다.</p></li>
<li><ol type="1">
<li><strong>관측 데이터와의 일치:</strong></li>
</ol>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Csum_u%20a_%7Bw,u%7D%20=%20P(x,%20y,%20w)"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csum_u%20b_%7Bw,u%7D%20=%20P(w)"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csum_u%20c_%7Bw,u%7D%20=%20P(x,%20w)"></li>
</ul></li>
<li><ol start="2" type="1">
<li><strong>확률의 기본 성질 (Fréchet Inequalities):</strong></li>
</ol>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?P(w,%20u)%20=%20%5Csum_x%20P(x,%20w,%20u)%20=%20%5Csum_x%20%5Csum_y%20P(x,%20y,%20w,%20u)">이므로 <img src="https://latex.codecogs.com/png.latex?b_%7Bw,%20u%7D%20%5Cge%20c_%7Bw,u%7D%20%5Cge%20a_%7Bw,%20u%7D"></li>
<li>결합 확률은 개별 확률보다 클 수 없고, 합집합 확률보다 작을 수 없다는 성질을 이용해 각 파라미터의 범위를 제한합니다.</li>
<li><img src="https://latex.codecogs.com/png.latex?a_%7Bw,u%7D%20=%20P(x,%20y,%20w,%20u)">의 경우, <img src="https://latex.codecogs.com/png.latex?%5Cmax%5C%7B0,%20P(x,%20y,%20w)%20+%20P(u)%20-%201%5C%7D%20%5Cle%20a_%7Bw,u%7D%20%5Cle%20%5Cmin%5C%7BP(x,%20y,%20w),%20P(u)%5C%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?b_%7Bw,u%7D%20=%20P(w,%20u)">의 경우, <img src="https://latex.codecogs.com/png.latex?%5Cmax%5C%7B0,%20P(w)%20+%20P(u)%20-%201%5C%7D%20%5Cle%20b_%7Bw,u%7D%20%5Cle%20%5Cmin%5C%7BP(w),%20P(u)%5C%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?c_%7Bw,%20u%7D%20=%20P(x,%20w,%20u)">의 경우, <img src="https://latex.codecogs.com/png.latex?%5Cmax%5C%7B0,%20P(x,%20w)%20+%20P(u)%20-%201%5C%7D%20%5Cle%20c_%7Bw,u%7D%20%5Cle%20%5Cmin%5C%7BP(x,%20w),%20P(u)%5C%7D"></li>
</ul></li>
<li><p>이러한 제약 조건 하에서 목표 함수를 최적화하면, Natural Bounds보다 좁은 범위(Valid Bounds)를 얻을 수 있습니다.</p></li>
</ul>
<hr>
</section>
</section>
<section id="결론" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 결론</h1>
<ul>
<li>관측 데이터만으로는 인과 효과를 정확히 알 수 없을 때(Non-identifiable), <strong>범위(Bounds)</strong>를 추정하는 다양한 방법들을 살펴보았습니다.</li>
</ul>
<section id="요약" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="요약"><span class="header-section-number">5.1</span> 요약</h2>
<ul>
<li><ol type="1">
<li><strong>Natural Bounds:</strong> 그래프 구조에 대한 최소한의 가정만으로 구하는 가장 넓은 범위.</li>
</ol></li>
<li><ol start="2" type="1">
<li><strong>Canonical Type Model (IV):</strong> 도구 변수가 있을 때, 비관측 변수 <img src="https://latex.codecogs.com/png.latex?U">를 유한한 반응 유형(Response Types)으로 나누어 선형 계획법(LP)으로 해결.</li>
</ol></li>
<li><ol start="3" type="1">
<li><strong>Partially-observed Covariates:</strong> 데이터가 파편화되어 있을 때, 확률 분포의 제약 조건을 이용한 최적화 문제로 해결.</li>
</ol></li>
</ul>
</section>
<section id="추가적인-연구-주제들" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="추가적인-연구-주제들"><span class="header-section-number">5.2</span> 추가적인 연구 주제들</h2>
<ul>
<li>Partial Identification은 여전히 활발히 연구되고 있는 분야입니다. 더 깊이 있는 학습을 위해 다음 논문들을 참고할 수 있습니다.
<ul>
<li><ol type="1">
<li><strong>연속 변수(Continuous variables)에서의 Bound:</strong> Zhang and Bareinboim (2022)</li>
</ol></li>
<li><ol start="2" type="1">
<li><strong>High Dimensional Data:</strong> Li and Pearl (2022)</li>
</ol></li>
<li><ol start="3" type="1">
<li><strong>비순응(Non-Compliance) 분석:</strong> Balke and Pearl (1997), Chickering and Pearl (1996)</li>
</ol>
<ul>
<li>Note: 더 복잡한 구조(예: 또 다른 Canonical Type Model)에서도 유사한 방식의 접근이 가능합니다.</li>
</ul></li>
</ul></li>
<li>식별 불가능하다고 해서 분석을 멈추는 것이 아니라, <strong>“데이터가 허용하는 한계 내에서 최선의 정보”</strong>를 뽑아내는 것이 바로 Partial Identification의 핵심입니다.</li>
</ul>


</section>
</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-08-part-03/</guid>
  <pubDate>Mon, 12 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 8. Partial Identification (Part 1)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-08-part-01/</link>
  <description><![CDATA[ 





<section id="개요-overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 개요 (Overview)</h1>
<ul>
<li><p>이전까지 우리는 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">를 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(v)">로부터 정확한 하나의 값(Point estimate)으로 계산할 수 있는지, 즉 <strong>식별 가능성(Identifiability)</strong>을 따졌습니다.</p></li>
<li><p>하지만 현실의 많은 문제에서는 그래프 구조상 식별이 불가능한 경우(Non-identifiable)가 많습니다.</p></li>
<li><p>이때 우리는 포기하는 대신 <strong>“그렇다면 인과 효과가 존재할 수 있는 범위(Bound)라도 알 수 없을까?”</strong>라는 질문을 던지게 됩니다.</p></li>
<li><p>이것이 바로 <strong>부분 식별(Partial Identification)</strong> 문제입니다.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-01/images/partial_id_flowchart.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Identification Process Flowchart. 식별 엔진이 ’No’를 반환했을 때, 구간 [a, b]를 찾는 과정으로 넘어가는 흐름도.</figcaption>
</figure>
</div>
<ul>
<li>Note: 식별 불가능(No) 판정이 났을 때, 우리는 0과 1 사이의 어딘가에 존재하는 구간 <img src="https://latex.codecogs.com/png.latex?%5Ba(y;x),%20b(y;x)%5D">를 찾게 됩니다. *</li>
</ul>
<hr>
</section>
<section id="부분-식별-문제-the-partial-identification-problem" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 부분 식별 문제 (The Partial Identification Problem)</h1>
<ul>
<li><p>인과 효과가 부분 식별 가능하다(Partially-identifiable)는 것은 관측 분포 <img src="https://latex.codecogs.com/png.latex?P(V)">를 통해 타겟 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">가 특정 구간 <img src="https://latex.codecogs.com/png.latex?%5Ba,%20b%5D"> 안에 있음을 알 수 있고, 이 구간이 <img src="https://latex.codecogs.com/png.latex?%5B0,%201%5D">보다 더 좁은 정보(<img src="https://latex.codecogs.com/png.latex?%5Ba,%20b%5D%20%5Csubset%20%5B0,%201%5D">)를 제공할 때를 말합니다.</p>
<ul>
<li><p><strong>Point Identification:</strong> 구간의 너비가 0인 특수한 경우 (<img src="https://latex.codecogs.com/png.latex?a=b">).</p></li>
<li><p><strong>Partial Identification:</strong> 구간의 너비가 0보다는 크지만, 아무 정보가 없는 <img src="https://latex.codecogs.com/png.latex?%5B0,%201%5D">보다는 좁은 경우.</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="natural-bounds" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Natural Bounds</h1>
<ul>
<li><p>가장 기본적이면서도 중요한 <strong>Natural Bounds</strong>를 살펴보겠습니다.</p></li>
<li><p>이는 아무런 추가 가정 없이, 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(x,%20y)">만 주어졌을 때 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">가 가질 수 있는 최악과 최선의 범위를 의미합니다.</p></li>
</ul>
<section id="문제-설정" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="문제-설정"><span class="header-section-number">3.1</span> 문제 설정</h2>
<p>다음과 같이 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y"> 사이에 비관측 교란 변수 <img src="https://latex.codecogs.com/png.latex?U">가 존재하는 가장 일반적인 그래프를 가정해 봅시다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-01/images/natural_bound_graph.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: Basic Confounded Graph. X와 Y가 U에 의해 교란된 구조.</figcaption>
</figure>
</div>
<ul>
<li>우리의 목표는 <img src="https://latex.codecogs.com/png.latex?P(x,%20y)">가 주어졌을 때, <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">의 범위를 구하는 것입니다.</li>
</ul>
</section>
<section id="theorem" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="theorem"><span class="header-section-number">3.2</span> Theorem</h2>
<ul>
<li>관측 분포 <img src="https://latex.codecogs.com/png.latex?P(x,%20y)">가 주어졌을 때, 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">는 다음 구간 안에 존재합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(y,%20x)%20%5Cle%20P(y%7Cdo(x))%20%5Cle%20P(y,%20x)%20+%201%20-%20P(x)%0A"></p>
<ul>
<li><p><strong>하한 (Lower Bound):</strong> <img src="https://latex.codecogs.com/png.latex?a(y;x)%20=%20P(y,%20x)"></p></li>
<li><p><strong>상한 (Upper Bound):</strong> <img src="https://latex.codecogs.com/png.latex?b(y;x)%20=%20P(y,%20x)%20+%201%20-%20P(x)"></p>
<ul>
<li><strong>직관적 해석</strong>
<ul>
<li>이 수식은 데이터를 통해 <strong>“확실히 아는 것”</strong>과 <strong>“모르는 것”</strong>을 구분하는 것으로 이해할 수 있습니다.</li>
<li>우리가 <img src="https://latex.codecogs.com/png.latex?do(x)">를 했을 때, 원래 자연스럽게 <img src="https://latex.codecogs.com/png.latex?X=x">를 선택했던 사람들은 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(y,%20x)">와 똑같이 행동할 것입니다. 이는 최소한 보장되는 비율입니다 (<strong>하한</strong>).</li>
<li>반면, 원래 <img src="https://latex.codecogs.com/png.latex?X%20%5Cne%20x">였던 사람들(처치를 받지 않은 비율 <img src="https://latex.codecogs.com/png.latex?P(x')">)이 강제로 처치를 받았을 때 어떻게 행동할지는 데이터로 알 수 없습니다.</li>
<li><strong>상한의 논리:</strong> “처치 받지 않은 비율(<img src="https://latex.codecogs.com/png.latex?P(x')">)에 속하는 사람들이 강제로 처치를 받았을 때, <strong>모두가 <img src="https://latex.codecogs.com/png.latex?Y=y">로 변화한다(성공한다)</strong>”고 가장 긍정적으로 가정하면 최댓값이 됩니다.</li>
</ul></li>
</ul></li>
</ul>
<hr>
</section>
<section id="유도-과정-derivation" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="유도-과정-derivation"><span class="header-section-number">3.3</span> 유도 과정 (Derivation)</h2>
<ul>
<li>왜 저런 범위가 나오는지 수식으로 살펴봅시다. 구조적 인과 모델(SCM)에서 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">는 다음과 같이 정의됩니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(y%7Cdo(x))%20=%20%5Csum_u%20P(y%7Cx,%20u)P(u)%0A"></p>
<ul>
<li>확률의 성질을 이용하여 <img src="https://latex.codecogs.com/png.latex?P(u)">를 두 부분으로 나눌 수 있습니다: <img src="https://latex.codecogs.com/png.latex?P(u)%20=%20P(u,%20x)%20+%20%5C%7BP(u)%20-%20P(u,%20x)%5C%7D">. 이를 식에 대입하면:</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_u%20P(y%7Cx,%20u)%20%5BP(u,%20x)%20+%20%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%5D%20%5C%5C%0A&amp;=%20%5Cunderbrace%7B%5Csum_u%20P(y%7Cx,%20u)P(u,%20x)%7D_%7B%5Ctext%7BPart%20A%7D%7D%20+%20%5Cunderbrace%7B%5Csum_u%20P(y%7Cx,%20u)%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%7D_%7B%5Ctext%7BPart%20B%7D%7D%0A%5Cend%7Baligned%7D%0A"></p>
<ul>
<li>여기서 <strong>Part A</strong>를 정리하면:</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPart%20A%7D%20=%20%5Csum_u%20P(y%7Cx,%20u)P(x%7Cu)P(u)%20=%20%5Csum_u%20P(y,%20x,%20u)%20=%20P(y,%20x)%0A"></p>
<ul>
<li>즉, Part A는 우리가 관측 가능한 데이터 <img src="https://latex.codecogs.com/png.latex?P(y,%20x)">와 같습니다. 이제 <strong>Part B</strong> 때문에 범위가 생깁니다.</li>
</ul>
<section id="하한-lower-bound-유도" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="하한-lower-bound-유도"><span class="header-section-number">3.3.1</span> 하한 (Lower Bound) 유도</h3>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?P(y%7Cx,%20u)">는 확률이므로 <img src="https://latex.codecogs.com/png.latex?0%20%5Cle%20P(y%7Cx,%20u)%20%5Cle%201">.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?P(u)%20=%20%5Csum_x%20P(u,%20x)">이므로 <img src="https://latex.codecogs.com/png.latex?P(u)%20%5Cge%20P(u,%20x)">.</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_u%20P(y%7Cx,%20u)P(u,%20x)%20+%20%5Csum_u%20P(y%7Cx,%20u)%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%20%5C%5C%0A&amp;=%20P(y,x)%20+%20%5Csum_u%20P(y%7Cx,%20u)%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%20%5C%5C%0A&amp;%5Cge%20P(y,%20x)%20+%200%20=%20P(y,%20x)%20%5C%5C%0A%5Cend%7Baligned%7D%0A"></p>
</section>
<section id="상한-upper-bound-유도" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="상한-upper-bound-유도"><span class="header-section-number">3.3.2</span> 상한 (Upper Bound) 유도</h3>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?P(y%7Cx,%20u)">는 확률이므로 <img src="https://latex.codecogs.com/png.latex?0%20%5Cle%20P(y%7Cx,%20u)%20%5Cle%201">.</li>
</ul>
<p><strong>Part B</strong>의 조건부 확률이 모두 1일 때 전체 값은 최대가 됩니다. <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_u%20P(y%7Cx,%20u)P(u,%20x)%20+%20%5Csum_u%20P(y%7Cx,%20u)%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%20%5C%5C%0A&amp;=%20P(y,x)%20+%20%5Csum_u%20P(y%7Cx,%20u)%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%20%5C%5C%0A&amp;%5Cle%20P(y,%20x)%20+%20%5Csum_u%20%5C%7BP(u)%20-%20P(u,%20x)%5C%7D%20%5C%5C%0A&amp;=%20P(y,%20x)%20+%201%20-%20P(x)%0A%5Cend%7Baligned%7D%0A"></p>
<hr>
</section>
</section>
<section id="범위의-타당성-증명-tightness" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="범위의-타당성-증명-tightness"><span class="header-section-number">3.4</span> 범위의 타당성 증명 (Tightness)</h2>
<ul>
<li><p>구한 범위 <img src="https://latex.codecogs.com/png.latex?%5BP(y,%20x),%20P(y,%20x)%20+%201%20-%20P(x)%5D">가 <strong>Tight하다</strong>는 것은, 추가적인 가정 없이는 이 범위를 더 좁힐 수 없음을 의미합니다.</p></li>
<li><p>이를 증명하기 위해, 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(x,%20y)">와 완벽히 일치하면서(Compatible), 인과 효과가 각각 하한값과 상한값을 갖는 두 개의 가상 모델(<img src="https://latex.codecogs.com/png.latex?M%5E%7B(1)%7D,%20M%5E%7B(2)%7D">)을 만들어낼 수 있음을 보이면 됩니다.</p></li>
</ul>
<section id="모델-설계-전략" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="모델-설계-전략"><span class="header-section-number">3.4.1</span> 모델 설계 전략</h3>
<ul>
<li>두 모델 모두 <img src="https://latex.codecogs.com/png.latex?U%20%5Csim%20P(u)">와 <img src="https://latex.codecogs.com/png.latex?X%20%5Cleftarrow%20f_X(u)">는 동일하게 두고, <img src="https://latex.codecogs.com/png.latex?Y">를 결정하는 함수 <img src="https://latex.codecogs.com/png.latex?f_Y(x,%20u)">만 다르게 설정합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0Af_Y(x,%20u)%20=%0A%5Cbegin%7Bcases%7D%0Af_Y%5E%7B%5Ctext%7Bobservation%7D%7D(x,%20u)%20&amp;%20%5Ctext%7Bif%20%7D%20x%20=%20f_X(u)%20%5Cquad%20%5Ctext%7B(%EA%B4%80%EC%B8%A1%EB%90%9C%20%EA%B2%BD%EC%9A%B0)%7D%20%5C%5C%0Af_Y%5E%7B%5Ctext%7Bcounterfactual%7D%7D(x,%20u)%20&amp;%20%5Ctext%7Bif%20%7D%20x%20%5Cne%20f_X(u)%20%5Cquad%20%5Ctext%7B(%EB%B0%98%EC%82%AC%EC%8B%A4%EC%A0%81%20%EA%B2%BD%EC%9A%B0)%7D%0A%5Cend%7Bcases%7D%0A"></p>
</section>
<section id="case-분류" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="case-분류"><span class="header-section-number">3.4.2</span> Case 분류</h3>
<ul>
<li><p>우리는 상황을 두 가지 케이스로 나눌 수 있습니다.</p>
<ul>
<li><strong>Case 1 (Observation):</strong> <img src="https://latex.codecogs.com/png.latex?x%20=%20f_X(u)">.
<ul>
<li>즉, 개인이 <strong>원래 <img src="https://latex.codecogs.com/png.latex?x">를 선택하려던 경우</strong>입니다.</li>
<li>이 경우 모델은 관측 데이터와 일치해야 하므로 선택의 여지가 없습니다.</li>
</ul></li>
<li><strong>Case 2 (Counterfactual):</strong> <img src="https://latex.codecogs.com/png.latex?x%20%5Cne%20f_X(u)">.
<ul>
<li>즉, <strong>원래 다른 것을 하려던 사람에게 억지로 <img src="https://latex.codecogs.com/png.latex?x">를 시킬 때</strong>입니다.</li>
<li>이 부분은 데이터로 관측되지 않으므로, 우리가 임의로 0(실패) 또는 1(성공)을 부여하여 범위를 만듭니다.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="두-모델의-구성" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="두-모델의-구성"><span class="header-section-number">3.4.3</span> 두 모델의 구성</h3>
<ol type="1">
<li><strong>모델 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BM%7D_x%5E%7B(1)%7D"> (하한 모델):</strong>
<ul>
<li>Case 2일 때 무조건 <strong><img src="https://latex.codecogs.com/png.latex?Y=0"></strong>을 출력하게 설정합니다.</li>
<li>인과 효과: <img src="https://latex.codecogs.com/png.latex?P%5E%7B(1)%7D(y=1%7Cdo(x))%20=%20P(y=1,%20x)%20+%200%20=%20%5Ctext%7BLower%20Bound%7D"></li>
</ul></li>
<li><strong>모델 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BM%7D_x%5E%7B(2)%7D"> (상한 모델):</strong>
<ul>
<li>Case 2일 때 무조건 <strong><img src="https://latex.codecogs.com/png.latex?Y=1"></strong>을 출력하게 설정합니다.</li>
<li>인과 효과: <img src="https://latex.codecogs.com/png.latex?P%5E%7B(2)%7D(y=1%7Cdo(x))%20=%20P(y=1,%20x)%20+%201-%20P(x)%20=%20%5Ctext%7BUpper%20Bound%7D"></li>
</ul></li>
</ol>
<ul>
<li>두 모델 모두 관측 상황(Case 1)에서는 동일하게 작동하므로 <img src="https://latex.codecogs.com/png.latex?P(x,%20y)"> 분포는 같습니다.</li>
<li>하지만 <img src="https://latex.codecogs.com/png.latex?do(x)"> 개입 시(Case 2), <img src="https://latex.codecogs.com/png.latex?U">와 <img src="https://latex.codecogs.com/png.latex?X">가 일치할 필요가 없으므로 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BM%7D_x%5E%7B(1)%7D">와 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BM%7D_x%5E%7B(2)%7D">가 <img src="https://latex.codecogs.com/png.latex?Y%20=%201"> 일 때, 다른 확률을 가질 수 있습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP%5E%7B(i)%7D(Y%20=%201%7Cdo(x))%20&amp;=%20%5Csum_%7Bu%7D%20P%5E%7B(i)%7D(Y%20=%201%7Cdo(x),%20u)P(u%7Cdo(x))%20%5C%5C%0A&amp;=%20%5Csum_%7Bu%7D%20P%5E%7B(i)%7D(Y%20=%201%7Cx,%20u)P(u)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BRule%202,%20Rule%203%7D%5C%5C%0A&amp;=%20P%5E%7B(i)%7D(Y%20=%201%7Cx,%20f_X(U)%20=%20x)P(f_X(U)%20=%20x)%20%5C%5C%0A&amp;%5Cquad%20+%20P%5E%7B(i)%7D(Y%20=%201%7Cx,%20f_X(U)%20%5Cneq%20x)P(f_X(U)%20%5Cneq%20x)%20%5C%5C%0A&amp;=%20P%5E%7B(i)%7D(Y%20=%201%7Cx)P(x)%20+%20%5Cmathbf%7B1%7D%5Bi%20=%202%5D%5C%7B1%20-%20P(x)%5C%7D%20%5C%5C%0A&amp;=%20P%5E%7B(i)%7D(x,%20Y%20=%201)%20+%20%5Cmathbf%7B1%7D%5Bi%20=%202%5D(1%20-%20P(x))%0A%5Cend%7Baligned%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP%5E%7B(1)%7D(Y%20=%201%7Cdo(x))%20&amp;=%20a(y;x)%20=%20P(y%20=%201,%20x)%20%5Cquad%20%5Ctext%7Bwhile%7D%20%5C%5C%0AP%5E%7B(2)%7D(Y%20=%201%7Cdo(x))%20&amp;=%20b(y;x)%20=%20P(y%20=%201,%20x)%20+%201%20-%20P(x)%0A%5Cend%7Baligned%7D%0A"></p>
</section>
</section>
</section>
<section id="결론" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 결론</h1>
<ul>
<li>Partial Identification은 식별 불가능한 상황에서 우리가 데이터로부터 얻을 수 있는 정보의 한계를 명확히 해줍니다.</li>
<li>Natural Bounds는 어떠한 가정 없이도 얻을 수 있는 “진실의 범위”이며, 이 범위가 너무 넓다면 추가적인 가정을 통해 범위를 좁혀나가는 과정이 필요합니다.</li>
</ul>


</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-08-part-01/</guid>
  <pubDate>Sun, 11 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 8. Partial Identification (Part 2)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-08-part-02/</link>
  <description><![CDATA[ 





<section id="개요-overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 개요 (Overview)</h1>
<ul>
<li><p>지난 포스트에서는 가장 일반적인 형태의 비관측 교란 상황에서 <strong>Natural Bounds</strong>를 구하는 법을 배웠습니다.</p></li>
<li><p>이번에는 인과추론에서 매우 중요한 환경인 <strong>도구 변수(Instrumental Variable, IV)</strong>가 주어졌을 때, 인과 효과의 범위를 어떻게 더 좁힐 수 있는지 알아봅니다.</p></li>
<li><p>특히, 이 문제를 해결하기 위해 <strong>Canonical Type Models (CTM)</strong>을 도입하고, 이를 <strong>선형 계획법(Linear Programming)</strong> 문제로 변환하여 최적의 범위(Tight Bounds)를 찾아내는 과정을 다룹니다.</p></li>
</ul>
<hr>
</section>
<section id="불순응non-compliance과-실험" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 불순응(Non-Compliance)과 실험</h1>
<ul>
<li><p><strong>Task:</strong> 관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(x,%20y%7Cz)">가 주어졌을 때, 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">의 범위를 구하는 것입니다.</p></li>
<li><p><strong>배정된 처치 (<img src="https://latex.codecogs.com/png.latex?Z">):</strong> 도구 변수 (Instrumental Variable; IV)</p></li>
<li><p><strong>실제 처치 (<img src="https://latex.codecogs.com/png.latex?X">):</strong> 실제 피험자가 받은 처치 (Treatment Realized)</p></li>
<li><p><strong>주요 결과 (<img src="https://latex.codecogs.com/png.latex?Y">):</strong> 결과 변수 (Primary Outcome)</p></li>
<li><p><strong>외생 변수 (<img src="https://latex.codecogs.com/png.latex?U">):</strong> 비관측 교란 변수 (Exogenous Variables)</p></li>
</ul>
<section id="natural-bounds-iv-모델" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="natural-bounds-iv-모델"><span class="header-section-number">2.1</span> Natural Bounds (IV 모델)</h2>
<ul>
<li>관측 분포 <img src="https://latex.codecogs.com/png.latex?P(X,%20Y%7CZ)">가 주어졌을 때, 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">는 구간 <img src="https://latex.codecogs.com/png.latex?%5Ba(y,%20x),%20b(y,%20x)%5D"> 안에 존재합니다. 여기서 각 경계값은 다음과 같습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0Aa(y,%20x)%20=%20%5Cmax_z%20P(y,%20x%7Cz)%0A"> <img src="https://latex.codecogs.com/png.latex?%0Ab(y,%20x)%20=%20%5Cmin_z%20%5BP(y,%20x%7Cz)%20+%201%20-%20P(x%7Cz)%5D%0A"></p>
<ul>
<li>모델 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BM%7D_z">에 Natural Bounds를 적용하면 아래와 같습니다.
<ul>
<li>우선 Natural Bounds 식에서 시작합니다. <img src="https://latex.codecogs.com/png.latex?%0AP(y%7Cdo(x))%20%5Cle%20P(y,%20x)%20+%201%20-%20P(x)%0A"></li>
<li><img src="https://latex.codecogs.com/png.latex?do(z)">를 한 그래프에서도 Natural Bounds는 성립하므로, <img src="https://latex.codecogs.com/png.latex?%0AP(y%7Cdo(x,z))%20%5Cle%20P(y,%20x%7Cdo(z))%20+%201%20-%20P(x%7Cdo(z))%0A"></li>
</ul></li>
<li>하지만 Natural Bounds는 이론적 한계까지 <strong>좁혀지지 않은 상태(Not Tight)</strong>입니다.</li>
</ul>
</section>
</section>
<section id="최적화-관점-optimization-perspective" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 최적화 관점 (Optimization Perspective)</h1>
<ul>
<li>Natural Bounds를 최적화 관점에서 발전시키면 아래와 같이 정리할 수 있습니다.</li>
</ul>
<section id="모델-집합-정의-model-definition" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="모델-집합-정의-model-definition"><span class="header-section-number">3.1</span> 모델 집합 정의 (Model Definition)</h2>
<ul>
<li><p>주어진 그래프 구조와 호환되는 모든 구조적 인과 모델(SCM)의 집합을 <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BM%7D">이라고 합시다.</p></li>
<li><p>모델 <img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7BM%7D">은 다음과 같이 정의됩니다.</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathscr%7BM%7D%20=%20%5Cbegin%7Bcases%7D%0AU%20%5Csim%20P(U)%20%5C%5C%0AZ%20%5Cleftarrow%20f_Z(U_Z)%20%5C%5C%0AX%20%5Cleftarrow%20f_X(Z,%20U)%20%5C%5C%0AY%20%5Cleftarrow%20f_Y(X,%20U)%0A%5Cend%7Bcases%7D%0A"></p>
</section>
<section id="최적화-문제-optimization-problem" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="최적화-문제-optimization-problem"><span class="header-section-number">3.2</span> 최적화 문제 (Optimization Problem)</h2>
<ul>
<li>관측 데이터 <img src="https://latex.codecogs.com/png.latex?P(x,%20y%7Cz)">가 주어졌을 때, 참(True) 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">는 다음 최적화 문제로 정의된 구간 <img src="https://latex.codecogs.com/png.latex?%5Ba(y;%20x),%20b(y;%20x)%5D"> 내에 존재해야 합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0Aa(y;%20x)%20=%20%5Cmin_%7B%5Cmathscr%7BM%7D%20%5Cin%20%5Cmathbf%7BM%7D%20%5Cmid%20P_%7B%5Cmathscr%7BM%7D%7D(y,x%7Cz)%20=%20P(x,y%7Cz)%7D%20P_%7B%5Cmathscr%7BM%7D%7D(y%7Cdo(x))%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ab(y;%20x)%20=%20%5Cmax_%7B%5Cmathscr%7BM%7D%20%5Cin%20%5Cmathbf%7BM%7D%20%5Cmid%20P_%7B%5Cmathscr%7BM%7D%7D(y,x%7Cz)%20=%20P(x,y%7Cz)%7D%20P_%7B%5Cmathscr%7BM%7D%7D(y%7Cdo(x))%0A"></p>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7BM%7D%20%5Cin%20%5Cmathbf%7BM%7D%20%5Cmid%20P_%7B%5Cmathscr%7BM%7D%7D(y,x%7Cz)%20=%20P(x,y%7Cz)">는 가상 모델(<img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7BM%7D">) 중, 그 모델이 만들어내는 통계(<img src="https://latex.codecogs.com/png.latex?P_%7B%5Cmathscr%7BM%7D%7D">)가 실제 관측된 데이터(<img src="https://latex.codecogs.com/png.latex?P">)와 정확히 일치하는 모델만을 고려함을 의미합니다.</p></li>
<li><p><strong>Difficulty:</strong> 이 최적화 문제를 해결하는 것은 다음과 같은 이유로 어렵습니다.</p>
<ul>
<li><ol type="1">
<li>함수 집합 <img src="https://latex.codecogs.com/png.latex?%5Cmathbf%7BF%7D"> (<img src="https://latex.codecogs.com/png.latex?f_X,%20f_Y"> 등)의 모수적 형태(parametric form)가 주어지지 않았습니다.</li>
</ol></li>
<li><ol start="2" type="1">
<li>잠재 변수의 분포 <img src="https://latex.codecogs.com/png.latex?P(U)">를 알 수 없습니다.</li>
</ol></li>
</ul></li>
</ul>
</section>
</section>
<section id="canonical-type-models-ctm" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Canonical Type Models (CTM)</h1>
<ul>
<li>인과 효과의 범위를 최적화 문제로 풀기 위해, 우리는 <strong>Canonical Type Model</strong>이라는 개념을 도입합니다.</li>
<li>핵심 아이디어는 비관측 변수 <img src="https://latex.codecogs.com/png.latex?U">의 공간을 변수들의 <strong>반응 패턴(Response Pattern)</strong>에 따라 유한한 개수의 파티션으로 나누는 것입니다.</li>
</ul>
<section id="반응-변수-response-variables" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="반응-변수-response-variables"><span class="header-section-number">4.1</span> 반응 변수 (Response Variables)</h2>
<ul>
<li>변수 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y">가 부모 변수의 값에 따라 어떻게 반응하는지를 결정하는 잠재적 특성을 <img src="https://latex.codecogs.com/png.latex?R_X,%20R_Y">라고 정의합시다.</li>
</ul>
<section id="r_x-배정z에-대한-순응-유형" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="r_x-배정z에-대한-순응-유형"><span class="header-section-number">4.1.1</span> <img src="https://latex.codecogs.com/png.latex?R_X">: 배정(<img src="https://latex.codecogs.com/png.latex?Z">)에 대한 순응 유형</h3>
<ul>
<li><p><img src="https://latex.codecogs.com/png.latex?Z">가 <img src="https://latex.codecogs.com/png.latex?0"> 또는 <img src="https://latex.codecogs.com/png.latex?1">일 때, <img src="https://latex.codecogs.com/png.latex?X">가 어떻게 반응하는지에 따라 총 4가지 유형(<img src="https://latex.codecogs.com/png.latex?2%5E2">)이 존재합니다.</p>
<ul>
<li><strong>Never-taker (<img src="https://latex.codecogs.com/png.latex?R_X=0">):</strong> 배정과 상관없이 처치를 받지 않음 (<img src="https://latex.codecogs.com/png.latex?Z=0%20%5Cto%20X=0,%20Z=1%20%5Cto%20X=0">)</li>
<li><strong>Complier (<img src="https://latex.codecogs.com/png.latex?R_X=1">):</strong> 배정된 대로 따름 (<img src="https://latex.codecogs.com/png.latex?Z=0%20%5Cto%20X=0,%20Z=1%20%5Cto%20X=1">)</li>
<li><strong>Defier (<img src="https://latex.codecogs.com/png.latex?R_X=2">):</strong> 배정과 반대로 행동함 (<img src="https://latex.codecogs.com/png.latex?Z=0%20%5Cto%20X=1,%20Z=1%20%5Cto%20X=0">)</li>
<li><strong>Always-taker (<img src="https://latex.codecogs.com/png.latex?R_X=3">):</strong> 배정과 상관없이 무조건 처치를 받음 (<img src="https://latex.codecogs.com/png.latex?Z=0%20%5Cto%20X=1,%20Z=1%20%5Cto%20X=1">)</li>
</ul></li>
</ul>
</section>
<section id="r_y-처치x에-대한-반응-유형" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="r_y-처치x에-대한-반응-유형"><span class="header-section-number">4.1.2</span> <img src="https://latex.codecogs.com/png.latex?R_Y">: 처치(<img src="https://latex.codecogs.com/png.latex?X">)에 대한 반응 유형</h3>
<ul>
<li><p>마찬가지로 <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?0"> 또는 <img src="https://latex.codecogs.com/png.latex?1">일 때, 결과 <img src="https://latex.codecogs.com/png.latex?Y">가 어떻게 나오는지에 따라 4가지 유형이 있습니다.</p>
<ul>
<li><strong>Never-recover (<img src="https://latex.codecogs.com/png.latex?R_Y=0">):</strong> 약을 먹든 안 먹든 낫지 않음.</li>
<li><strong>Helped (<img src="https://latex.codecogs.com/png.latex?R_Y=1">):</strong> 약을 먹으면 낫고, 안 먹으면 안 나음 (인과 효과 있음).</li>
<li><strong>Hurt (<img src="https://latex.codecogs.com/png.latex?R_Y=2">):</strong> 약을 먹으면 오히려 아프고, 안 먹어야 나음.</li>
<li><strong>Always-recover (<img src="https://latex.codecogs.com/png.latex?R_Y=3">):</strong> 약을 먹든 안 먹든 항상 나음.</li>
</ul></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-02/images/partition_u.jpeg" class="img-fluid figure-img"></p>
<figcaption>Figure 1: Partition of U. U의 공간이 Rx와 Ry의 조합(총 16가지)에 의해 분할되는 모습을 나타낸 그림.</figcaption>
</figure>
</div>
<ul>
<li>Note: <img src="https://latex.codecogs.com/png.latex?U">는 <img src="https://latex.codecogs.com/png.latex?R_X">(4가지)와 <img src="https://latex.codecogs.com/png.latex?R_Y">(4가지)의 조합인 총 16개의 영역으로 나뉩니다.*</li>
</ul>
</section>
<section id="동치-정리-equivalence-theorem" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="동치-정리-equivalence-theorem"><span class="header-section-number">4.1.3</span> 동치 정리 (Equivalence Theorem)</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-08-part-02/images/equivalence_theorem.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: IV Model and Canonical Model. IV 모델에 대응되는 Canonical 모델의 모습.</figcaption>
</figure>
</div>
<blockquote class="blockquote">
<p><strong>Theorem:</strong> 모든 IV 모델은 그에 상응하는 Canonical Type Model로 변환될 수 있으며, 동일한 관측 분포와 인과 효과를 가집니다.</p>
</blockquote>
<blockquote class="blockquote">
<p>For any IV model <img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7BM%7D_%7B1%7D">, there exists a canonical type model <img src="https://latex.codecogs.com/png.latex?%5Cmathscr%7BM%7D_%7B2%7D"> such that <img src="https://latex.codecogs.com/png.latex?P_%7B%5Cmathscr%7BM%7D_%7B1%7D%7D(x,y%7Cz)%20=%20P_%7B%5Cmathscr%7BM%7D_%7B2%7D%7D(x,y%7Cz)">, <img src="https://latex.codecogs.com/png.latex?P_%7B%5Cmathscr%7BM%7D_%7B1%7D%7D(y%7Cdo(x))%20=%20P_%7B%5Cmathscr%7BM%7D_%7B2%7D%7D(y%7Cdo(x))"></p>
</blockquote>
<ul>
<li>이 정리는 우리가 복잡하고 무한한 형태의 <img src="https://latex.codecogs.com/png.latex?U">를 고려할 필요 없이, <strong>유한한 16개의 파라미터(<img src="https://latex.codecogs.com/png.latex?R_X,%20R_Y">의 결합 분포)만 최적화하면 된다</strong>는 것을 보장합니다.</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="선형-계획법-linear-programming-수립" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 선형 계획법 (Linear Programming) 수립</h1>
<ul>
<li>이제 문제를 수학적인 최적화 문제, 특히 <strong>선형 계획법(Linear Programming, LP)</strong>으로 바꿔봅시다.</li>
</ul>
<section id="파라미터-정의-r_x-r_y-rightarrow-q_j-k" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="파라미터-정의-r_x-r_y-rightarrow-q_j-k"><span class="header-section-number">5.1</span> 파라미터 정의 (<img src="https://latex.codecogs.com/png.latex?(R_%7Bx%7D,%20R_%7By%7D)%20%5Crightarrow%20q_%7Bj,%20k%7D">)</h2>
<ul>
<li>우리가 찾아야 할 미지수는 <img src="https://latex.codecogs.com/png.latex?R_X">와 <img src="https://latex.codecogs.com/png.latex?R_Y">의 결합 확률분포입니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0Aq_%7Bj,k%7D%20=%20P(R_X=j,%20R_Y=k),%20%5Cquad%20j,k%20%5Cin%20%5C%7B0,1,2,3%5C%7D%0A"></p>
<ul>
<li>총 16개의 <img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D">가 있으며, 이들의 합은 1이어야 합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum_%7Bj%7D%20%5Csum_%7Bk%7D%20q_%7Bj,k%7D%20=%201%0A"></p>
</section>
<section id="관측-데이터와의-연결-q_jk-rightarrow-px-x-y-y-z-z" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="관측-데이터와의-연결-q_jk-rightarrow-px-x-y-y-z-z"><span class="header-section-number">5.2</span> 관측 데이터와의 연결 (<img src="https://latex.codecogs.com/png.latex?q_%7Bjk%7D%20%5Crightarrow%20P(X%20=%20x,%20Y%20=%20y%20%7C%20Z%20=%20z)">)</h2>
<ul>
<li><p>관측된 데이터 <img src="https://latex.codecogs.com/png.latex?P_%7Byx.z%7D%20=%20P(X=x,%20Y=y%20%7C%20Z=z)">는 <img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D">들의 선형 결합으로 표현됩니다.</p></li>
<li><p>예를 들어, <img src="https://latex.codecogs.com/png.latex?P(Y=0,%20X=0%20%7C%20Z=0)">인 경우를 봅시다.</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?Z=0">일 때 <img src="https://latex.codecogs.com/png.latex?X=0">이 되려면: <strong>Never-taker(<img src="https://latex.codecogs.com/png.latex?R_%7Bx%7D=0">)</strong> 또는 <strong>Complier(<img src="https://latex.codecogs.com/png.latex?R_%7Bx%7D=1">)</strong>여야 합니다.</li>
<li><img src="https://latex.codecogs.com/png.latex?X=0">일 때 <img src="https://latex.codecogs.com/png.latex?Y=0">이 되려면: 처치를 안 받았을 때 안 나아야 하므로 <strong>Never-recover(<img src="https://latex.codecogs.com/png.latex?R_%7By%7D=0">)</strong> 또는 <strong>Helped(<img src="https://latex.codecogs.com/png.latex?R_%7By%7D=1">)</strong>여야 합니다.</li>
</ul></li>
<li><p>따라서 해당 <img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D">들을 모두 더하면: <img src="https://latex.codecogs.com/png.latex?%0AP_%7B00.0%7D%20=%20q_%7B00%7D%20+%20q_%7B01%7D%20+%20q_%7B10%7D%20+%20q_%7B11%7D%0A"></p></li>
<li><p>이와 같은 방식으로 8개의 관측 확률(<img src="https://latex.codecogs.com/png.latex?P_%7Byx.z%7D">)을 모두 <img src="https://latex.codecogs.com/png.latex?q">에 대한 선형 방정식으로 만들 수 있습니다.</p></li>
</ul>
</section>
<section id="인과-효과-q_j-k-rightarrow-py-dox" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="인과-효과-q_j-k-rightarrow-py-dox"><span class="header-section-number">5.3</span> 인과 효과 (<img src="https://latex.codecogs.com/png.latex?q_%7Bj,%20k%7D%20%5Crightarrow%20P(Y%20%7C%20do(x))">)</h2>
<ul>
<li>우리가 알고 싶은 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(Y=1%20%7C%20do(X=1))"> 또한 <img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D">의 합으로 표현됩니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(Y=1%20%7C%20do(X=1))%20&amp;=%20P(R_Y%20%5Cin%20%5C%7B%5Ctext%7BHelped,%20Always-recover%7D%5C%7D)%20%5C%5C%0A&amp;=%20P(R_Y=1)%20+%20P(R_Y=3)%20%5C%5C%0A&amp;=%20%5Csum_%7Bj=0%7D%5E3%20(q_%7Bj1%7D%20+%20q_%7Bj3%7D)%0A%5Cend%7Baligned%7D%0A"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?do(x)">의 의미
<ul>
<li><img src="https://latex.codecogs.com/png.latex?do(X=x)">는 <img src="https://latex.codecogs.com/png.latex?R_X">의 성향을 무시하고(무력화하고) 강제로 처치를 가하는 것입니다.</li>
<li>따라서 인과 효과를 계산할 때는 <img src="https://latex.codecogs.com/png.latex?R_X">에 대한 조건 없이, 오직 <img src="https://latex.codecogs.com/png.latex?Y">가 처치 <img src="https://latex.codecogs.com/png.latex?x">에 어떻게 반응하는지(<img src="https://latex.codecogs.com/png.latex?R_Y">)만 고려하면 됩니다.</li>
</ul></li>
</ul>
</section>
<section id="해결-및-결과" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="해결-및-결과"><span class="header-section-number">5.4</span> 해결 및 결과</h2>
<ul>
<li>Canonical Type Model을 도입함으로써, 우리는 무한한 차원의 문제를 16개의 변수(<img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D">)를 가진 <strong>선형 계획법(Linear Programming)</strong> 문제로 변환했습니다.</li>
<li>이를 구체적인 수식으로 살펴보겠습니다.</li>
</ul>
<section id="최적화-문제-정의-optimization-setup" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="최적화-문제-정의-optimization-setup"><span class="header-section-number">5.4.1</span> 최적화 문제 정의 (Optimization Setup)</h3>
<ul>
<li><strong>목표:</strong> 관측 데이터(<img src="https://latex.codecogs.com/png.latex?P">)와 확률의 공리(<img src="https://latex.codecogs.com/png.latex?%5Csum%20q%20=%201,%20q%20%5Cge%200">)를 만족하면서, 인과 효과를 최소화/최대화하는 <img src="https://latex.codecogs.com/png.latex?q">의 조합을 찾는 것입니다.</li>
</ul>
<section id="목적-함수-objective-function" class="level4" data-number="5.4.1.1">
<h4 data-number="5.4.1.1" class="anchored" data-anchor-id="목적-함수-objective-function"><span class="header-section-number">5.4.1.1</span> 목적 함수 (Objective Function):</h4>
<ul>
<li>예를 들어, <strong><img src="https://latex.codecogs.com/png.latex?P(Y=1%20%7C%20do(X=0))"></strong>의 범위를 구한다고 가정해 봅시다.</li>
<li><img src="https://latex.codecogs.com/png.latex?X=0">으로 처치를 고정했을 때 <img src="https://latex.codecogs.com/png.latex?Y=1">이 나오는 반응 유형은 <strong>Hurt(<img src="https://latex.codecogs.com/png.latex?R_%7By%7D=2">)</strong>와 <strong>Always-recover(<img src="https://latex.codecogs.com/png.latex?R_%7By%7D=3">)</strong>입니다.</li>
<li>따라서 목적 함수는 다음과 같습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmin_%5Cmathbf%7Bq%7D%20%5Csum_%7Bj=0%7D%5E3%20(q_%7Bj2%7D%20+%20q_%7Bj3%7D)%20%5Cquad%20%5Ctext%7B%EB%98%90%EB%8A%94%7D%20%5Cquad%20%5Cmax_%5Cmathbf%7Bq%7D%20%5Csum_%7Bj=0%7D%5E3%20(q_%7Bj2%7D%20+%20q_%7Bj3%7D)%0A"></p>
</section>
<section id="제약-조건-constraints" class="level4" data-number="5.4.1.2">
<h4 data-number="5.4.1.2" class="anchored" data-anchor-id="제약-조건-constraints"><span class="header-section-number">5.4.1.2</span> 제약 조건 (Constraints):</h4>
<ul>
<li>관측확률에 대한 선형 등식: <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Ap_%7B00.0%7D%20&amp;=%20q_%7B00%7D%20+%20q_%7B01%7D%20+%20q_%7B10%7D%20+%20q_%7B11%7D%20%5C%5C%0Ap_%7B00.1%7D%20&amp;=%20q_%7B00%7D%20+%20q_%7B01%7D%20+%20q_%7B20%7D%20+%20q_%7B21%7D%20%5C%5C%0A&amp;%5Cvdots%20%5C%5C%0Ap_%7B11.1%7D%20&amp;=%20q_%7B12%7D%20+%20q_%7B13%7D%20+%20q_%7B32%7D%20+%20q_%7B33%7D%0A%5Cend%7Baligned%7D%0A"></li>
<li>확률의 공리: <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bj,k%7D%20q_%7Bj,k%7D%20=%201">, <img src="https://latex.codecogs.com/png.latex?q_%7Bj,k%7D%20%5Cge%200"></li>
</ul>
</section>
<section id="closed-form-solution" class="level4" data-number="5.4.1.3">
<h4 data-number="5.4.1.3" class="anchored" data-anchor-id="closed-form-solution"><span class="header-section-number">5.4.1.3</span> Closed-form Solution</h4>
<ul>
<li>이 선형 계획법 문제를 심플렉스 알고리즘 등으로 풀면, <strong>Closed-form Solution</strong>를 얻을 수 있습니다.</li>
<li>인과 효과 <img src="https://latex.codecogs.com/png.latex?P(Y=1%20%7C%20do(X=0))">의 하한(Lower Bound)은 다음 값들 중 최댓값(<img src="https://latex.codecogs.com/png.latex?%5Cmax">)으로 결정됩니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(Y=1%20%7C%20do(X=0))%20%5Cge%20%5Cmax%20%5Cbegin%7Bcases%7D%0Ap_%7B10.0%7D%20%5C%5C%0Ap_%7B10.1%7D%20%5C%5C%0Ap_%7B10.0%7D%20+%20p_%7B11.0%7D%20-%20p_%7B00.1%7D%20-%20p_%7B11.1%7D%20%5C%5C%0Ap_%7B01.0%7D%20+%20p_%7B10.0%7D%20-%20p_%7B00.1%7D%20-%20p_%7B01.1%7D%20%5C%5C%0A%5Cend%7Bcases%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(Y=1%20%7C%20do(X=0))%20%5Cle%20%5Cmin%20%5Cbegin%7Bcases%7D%0A1%20-%20p_%7B00.0%7D%20%5C%5C%0A1%20-%20p_%7B00.1%7D%20%5C%5C%0Ap_%7B10.0%7D%20+%20p_%7B11.0%7D%20+%20p_%7B01.1%7D%20+%20p_%7B10.1%7D%20%5C%5C%0Ap_%7B01.0%7D%20+%20p_%7B10.0%7D%20+%20p_%7B10.1%7D%20+%20p_%7B11.1%7D%20%5C%5C%0A%5Cend%7Bcases%7D%0A"></p>
</section>
</section>
<section id="결과의-의미" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="결과의-의미"><span class="header-section-number">5.4.2</span> 결과의 의미</h3>
<ul>
<li><p>위 수식은 복잡해 보이지만 중요한 함의를 갖습니다.</p>
<ul>
<li><ol type="1">
<li><strong>데이터만으로 계산 가능:</strong> 우변의 모든 항(<img src="https://latex.codecogs.com/png.latex?p_%7Byx.z%7D">)은 관측 데이터로부터 바로 구할 수 있는 값들입니다.</li>
</ol></li>
<li><ol start="2" type="1">
<li><strong>Tightness:</strong> 이 범위는 IV 모델의 가정(<img src="https://latex.codecogs.com/png.latex?Z%20%5Cperp%20U"> 등)을 수학적으로 완벽하게 반영한 결과입니다. 따라서 추가적인 가정이 없다면 이보다 더 좁은 범위를 찾는 것은 불가능합니다.</li>
</ol></li>
</ul></li>
<li><p>Note: Natural Bounds는 단순히 관측된 확률의 교집합만 고려하지만, Balke-Pearl Bounds(LP)는 도구 변수의 구조적 정보를 최적화 과정에 반영하여 훨씬 더 정보가 풍부한(Informative) 결과를 제공합니다.*</p></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="결론" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 결론</h1>
<ul>
<li><p>부분 식별(Partial Identification) 문제는 데이터만으로 인과 효과를 하나로 특정할 수 없을 때 매우 유용합니다.</p>
<ul>
<li><ol type="1">
<li><strong>Natural Bounds</strong>는 가장 보수적인 구간을 제공하지만 넓을 수 있습니다.</li>
</ol></li>
<li><ol start="2" type="1">
<li><strong>도구 변수(IV)</strong>가 있다면, <strong>Canonical Type Model</strong>을 통해 비관측 변수를 유한한 유형으로 나눌 수 있습니다.</li>
</ol></li>
<li><ol start="3" type="1">
<li><strong>이를 선형 계획법(LP)</strong>으로 구성하여 풀면, 주어진 데이터와 가정하에서 얻을 수 있는 가장 정밀한 인과 효과의 범위(<strong>Tight Bounds</strong>)를 계산할 수 있습니다.</li>
</ol></li>
</ul></li>
<li><p>이 접근법은 실제 임상 실험이나 정책 분석에서 불순응자가 발생했을 때, 처치 효과의 최악/최선 시나리오를 분석하는 데 강력한 도구로 사용됩니다.</p></li>
</ul>


</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-08-part-02/</guid>
  <pubDate>Sun, 11 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 4. Confounding and Backdoor (Part 5)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-04-part-05/</link>
  <description><![CDATA[ 





<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<ul>
<li>이전 포스트들에서 배운 교란(Confounding)과 Back-door Criterion을 실제 코드로 구현해 보는 시간입니다.</li>
<li>특히 <strong>심슨의 역설(Simpson’s Paradox)</strong> 상황을 시뮬레이션하고, <code>DoWhy</code> 라이브러리의 <strong>성향 점수 층화(Propensity Score Stratification)</strong> 방법을 통해 올바른 인과 효과를 추정해 봅니다.</li>
</ul>
</section>
<section id="python-practice-dowhy-simulation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Python Practice: DoWhy Simulation</h1>
<p>이제 위 이론을 바탕으로 <code>DoWhy</code> 라이브러리를 사용해 인과 추론 프로세스를 단계별로 구현해 봅니다.</p>
</section>
<section id="데이터-생성-data-generation" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 데이터 생성 (Data Generation)</h1>
<p>나이(Age)가 운동(Exercise)과 콜레스테롤(Cholesterol) 모두에 영향을 주어, 단순 관찰 시 역설적인 결과가 나오도록 데이터를 생성합니다.</p>
<div id="cell-data-generation" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> dowhy</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dowhy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> CausalModel</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-7"></span>
<span id="cb1-8">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb1-9">N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (1) 교란 변수: 나이 (Age)</span></span>
<span id="cb1-12">age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.randint(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (2) 처치 변수: 운동 여부 (Exercise, 0 or 1)</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 나이가 많을수록 운동할 확률이 높아짐 (교란 발생)</span></span>
<span id="cb1-16">prob_exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>))</span>
<span id="cb1-17">exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.binomial(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, prob_exercise)</span>
<span id="cb1-18"></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (3) 결과 변수: 콜레스테롤 (Cholesterol)</span></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 나이가 많으면 콜레스테롤 증가 (+2.0 * Age)</span></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 운동을 하면 콜레스테롤 감소 (True Effect = -10)</span></span>
<span id="cb1-22">cholesterol <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> age <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb1-23"></span>
<span id="cb1-24">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb1-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>: age, </span>
<span id="cb1-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>: exercise, </span>
<span id="cb1-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise_Prob'</span>: prob_exercise, </span>
<span id="cb1-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>: cholesterol</span>
<span id="cb1-29">})</span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데이터 분포 확인 (나이에 따른 색상 구분)</span></span>
<span id="cb1-32">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb1-33">sns.scatterplot(</span>
<span id="cb1-34">    x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise_Prob'</span>, </span>
<span id="cb1-35">    y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>, </span>
<span id="cb1-36">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, </span>
<span id="cb1-37">    hue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>, </span>
<span id="cb1-38">    palette<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'viridis'</span>, </span>
<span id="cb1-39">    alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb1-40">)</span>
<span id="cb1-41">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exercise Probability vs Cholesterol (Colored by Age)"</span>)</span>
<span id="cb1-42">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability of Exercise"</span>)</span>
<span id="cb1-43">plt.legend(title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>)</span>
<span id="cb1-44">plt.show()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-05/index_files/figure-html/data-generation-output-1.png" id="data-generation" width="668" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="단순-비교-naive-comparison" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 단순 비교 (Naive Comparison)</h1>
<ul>
<li>교란 변수를 고려하지 않고 단순히 운동한 사람과 안 한 사람의 평균 콜레스테롤을 비교해 봅니다.</li>
</ul>
<div id="naive-estimation" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1">mean_exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>].mean()</span>
<span id="cb2-2">mean_no_exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>].mean()</span>
<span id="cb2-3">naive_effect <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_exercise <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_no_exercise</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb2-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"1. 단순 평균 비교 (Naive Estimate): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>naive_effect<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"   -&gt; 운동한 사람의 콜레스테롤이 더 높게 나옴 (심슨의 역설)"</span>)</span>
<span id="cb2-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
1. 단순 평균 비교 (Naive Estimate): 11.5646
   -&gt; 운동한 사람의 콜레스테롤이 더 높게 나옴 (심슨의 역설)
==================================================</code></pre>
</div>
</div>
</section>
<section id="dowhy를-이용한-인과-추론" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> DoWhy를 이용한 인과 추론</h1>
<section id="모델-정의-및-식별-modeling-identification" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="모델-정의-및-식별-modeling-identification"><span class="header-section-number">5.1</span> 모델 정의 및 식별 (Modeling &amp; Identification)</h2>
<ul>
<li>인과 그래프(Graph)를 정의하고 Back-door 기준을 통해 식별 가능성을 확인합니다.</li>
</ul>
<div id="dowhy-modeling" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단계 1: 모델 정의 (Causal Graph 생성)</span></span>
<span id="cb4-2">model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> CausalModel(</span>
<span id="cb4-3">    data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df,</span>
<span id="cb4-4">    treatment<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>,</span>
<span id="cb4-5">    outcome<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>,</span>
<span id="cb4-6">    common_causes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 교란 변수 지정</span></span>
<span id="cb4-7">)</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단계 2: 식별 (Identification)</span></span>
<span id="cb4-10">identified_estimand <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.identify_effect()</span>
<span id="cb4-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(identified_estimand)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Estimand type: EstimandType.NONPARAMETRIC_ATE

### Estimand : 1
Estimand name: backdoor
Estimand expression:
     d                         
───────────(E[Cholesterol|Age])
d[Exercise]                    
Estimand assumption 1, Unconfoundedness: If U→{Exercise} and U→Cholesterol then P(Cholesterol|Exercise,Age,U) = P(Cholesterol|Exercise,Age)

### Estimand : 2
Estimand name: iv
No such variable(s) found!

### Estimand : 3
Estimand name: frontdoor
No such variable(s) found!
</code></pre>
</div>
</div>
</section>
<section id="인과-효과-추정-estimation-stratification" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="인과-효과-추정-estimation-stratification"><span class="header-section-number">5.2</span> 인과 효과 추정 (Estimation: Stratification)</h2>
<ul>
<li>여기서는 성향 점수 층화(Propensity Score Stratification) 방법을 사용합니다. 나이가 비슷하여 운동할 확률(성향 점수)이 유사한 사람들끼리 묶어서 비교하는 방식입니다.</li>
</ul>
<div id="dowhy-estimation" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 단계 3: 추정 (Estimation)</span></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># num_strata=5: 데이터를 성향 점수에 따라 5개 구간으로 나눔</span></span>
<span id="cb6-3">estimate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.estimate_effect(</span>
<span id="cb6-4">    identified_estimand,</span>
<span id="cb6-5">    method_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"backdoor.propensity_score_stratification"</span>,</span>
<span id="cb6-6">    method_params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'num_strata'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'clipping_threshold'</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>}</span>
<span id="cb6-7">)</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb6-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"2. 인과 효과 추정 (Causal Estimate): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>estimate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb6-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"   -&gt; 실제 효과 (-10.0)에 매우 근접함"</span>)</span>
<span id="cb6-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
2. 인과 효과 추정 (Causal Estimate): -9.1264
   -&gt; 실제 효과 (-10.0)에 매우 근접함
==================================================</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/anaconda3/envs/causal-inference-study/lib/python3.9/site-packages/sklearn/linear_model/_linear_loss.py:330: RuntimeWarning: divide by zero encountered in matmul
  grad[:n_features] = X.T @ grad_pointwise + l2_reg_strength * weights
/opt/anaconda3/envs/causal-inference-study/lib/python3.9/site-packages/sklearn/linear_model/_linear_loss.py:330: RuntimeWarning: overflow encountered in matmul
  grad[:n_features] = X.T @ grad_pointwise + l2_reg_strength * weights
/opt/anaconda3/envs/causal-inference-study/lib/python3.9/site-packages/sklearn/linear_model/_linear_loss.py:330: RuntimeWarning: invalid value encountered in matmul
  grad[:n_features] = X.T @ grad_pointwise + l2_reg_strength * weights</code></pre>
</div>
</div>
</section>
</section>
<section id="결과-검증-refutation" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> 결과 검증 (Refutation)</h1>
<ul>
<li>구해진 인과 효과가 통계적으로 유의미하고 견고한지 검증하기 위해 <strong>가짜 처치(Placebo)</strong>와 랜덤 변수 추가(Random Common Cause) 테스트를 수행합니다.</li>
</ul>
<div id="refutation" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">[검증 시작] 모델이 얼마나 튼튼한지 테스트합니다..."</span>)</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (1) 가짜 처치 검증 (Placebo Treatment)</span></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 운동 여부를 랜덤으로 섞으면 효과가 0이 나와야 함</span></span>
<span id="cb9-5">refute_placebo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.refute_estimate(</span>
<span id="cb9-6">    identified_estimand,</span>
<span id="cb9-7">    estimate,</span>
<span id="cb9-8">    method_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placebo_treatment_refuter"</span>,</span>
<span id="cb9-9">    method_params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placebo_type"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"permute_treatment"</span>}</span>
<span id="cb9-10">)</span>
<span id="cb9-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- Placebo Test (Expected 0): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>refute_placebo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>new_effect<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (2) 랜덤 공통 원인 검증 (Random Common Cause)</span></span>
<span id="cb9-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 아무 상관 없는 랜덤 변수를 추가해도 원래 효과(-10)가 유지되어야 함</span></span>
<span id="cb9-15">refute_random <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.refute_estimate(</span>
<span id="cb9-16">    identified_estimand,</span>
<span id="cb9-17">    estimate,</span>
<span id="cb9-18">    method_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"random_common_cause"</span></span>
<span id="cb9-19">)</span>
<span id="cb9-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- Random Cause Test (Expected ~ -10): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>refute_random<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>new_effect<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
[검증 시작] 모델이 얼마나 튼튼한지 테스트합니다...

- Placebo Test (Expected 0): 0.0059
- Random Cause Test (Expected ~ -10): -9.1264</code></pre>
</div>
</div>
</section>
<section id="최종-시각화-visualization" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> 최종 시각화 (Visualization)</h1>
<ul>
<li>단순 비교했을 때와 교란 변수를 통제했을 때의 차이를 시각적으로 확인합니다.</li>
</ul>
<div id="cell-final-visualization" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (왼쪽) 단순 비교 시각화</span></span>
<span id="cb11-4">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb11-5">sns.boxplot(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df)</span>
<span id="cb11-6">plt.title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Naive Comparison</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">(Effect: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>naive_effect<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">)"</span>)</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (오른쪽) 나이 통제 후 시각화 (회귀선)</span></span>
<span id="cb11-9">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb11-10">sns.scatterplot(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>, hue<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb11-11"></span>
<span id="cb11-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 운동 O/X 별 추세선</span></span>
<span id="cb11-13">sns.regplot(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], </span>
<span id="cb11-14">            scatter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'No Exercise'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb11-15">sns.regplot(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Age'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Cholesterol'</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb11-16">            scatter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Exercise'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb11-17"></span>
<span id="cb11-18">plt.title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Controlled Comparison by Age</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">(True Effect: -10.0)"</span>)</span>
<span id="cb11-19">plt.legend()</span>
<span id="cb11-20"></span>
<span id="cb11-21">plt.tight_layout()</span>
<span id="cb11-22">plt.show()</span></code></pre></div></div>
</details>
<div class="cell-output cell-output-display">
<div id="final-visualization" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-05/index_files/figure-html/final-visualization-output-1.png" width="1142" height="471" class="figure-img"></p>
<figcaption>Left: Naive View (Simpson’s Paradox), Right: Controlled View (True Effect)</figcaption>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-04-part-05/</guid>
  <pubDate>Wed, 07 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 4. Confounding and Backdoor (Part 4)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-04-part-04/</link>
  <description><![CDATA[ 





<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<ul>
<li>지난 포스트에서는 <strong>Back-door Criterion</strong>을 통해 어떤 공변량 집합 <img src="https://latex.codecogs.com/png.latex?Z">를 보정(Adjustment)해야 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">를 식별할 수 있는지 알아보았습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))%20=%20%5Csum_%7Bz%7D%20P(y%7Cx,z)P(z)"></p>
<ul>
<li>이번 포스트에서는 이 식을 <strong>실제 데이터(Practice)</strong>에서 어떻게 평가하고 계산하는지, 특히 <strong>계산 복잡도 문제</strong>를 해결하기 위한 <strong>Inverse Probability Weighting (IPW)</strong> 기법에 대해 다룹니다.</li>
</ul>
<hr>
</section>
<section id="the-challenge-of-evaluation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The Challenge of Evaluation</h1>
<ul>
<li>Back-door criterion을 만족하는 집합 <img src="https://latex.codecogs.com/png.latex?Z">를 찾았다면, 이론적으로는 위의 식을 통해 인과 효과를 계산할 수 있습니다.</li>
<li>하지만 실제 적용 시에는 두 가지 큰 난관에 부딪힙니다.</li>
</ul>
<ol type="1">
<li><strong>Estimation:</strong> <img src="https://latex.codecogs.com/png.latex?P(y%7Cx,z)">와 <img src="https://latex.codecogs.com/png.latex?P(z)">와 같은 분포들을 데이터로부터 각각 추정해야 합니다.</li>
<li><strong>Computational Complexity:</strong> 만약 보정해야 할 변수 집합 <img src="https://latex.codecogs.com/png.latex?Z">가 고차원(High-dimensional)이라면, <img src="https://latex.codecogs.com/png.latex?Z">의 모든 조합에 대해 합(Summation)을 구하는 것은 매우 어렵습니다. <img src="https://latex.codecogs.com/png.latex?Z">의 차원이 늘어날수록 계산 복잡도는 지수적으로 증가(<img src="https://latex.codecogs.com/png.latex?O(exp(%7CZ%7C))">)하기 때문입니다.</li>
</ol>
<ul>
<li>이 문제를 해결하기 위해 우리는 식을 변형하여 <strong>IPW (Inverse Probability Weighting)</strong> 방식을 도입합니다.</li>
</ul>
<hr>
</section>
<section id="inverse-probability-weighting-ipw" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Inverse Probability Weighting (IPW)</h1>
<section id="derivation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="derivation"><span class="header-section-number">3.1</span> Derivation</h2>
<ul>
<li>기존의 Back-door Adjustment 식을 베이즈 정리와 결합 확률 법칙을 이용해 재구성해 봅시다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_%7Bz%7D%20P(y%7Cx,z)P(z)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%7D%20%5Cfrac%7BP(y,x,z)%7D%7BP(x,z)%7D%20P(z)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%7D%20%5Cfrac%7BP(y,x,z)%7D%7BP(x%7Cz)P(z)%7D%20P(z)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%7D%20%5Cfrac%7BP(y,x,z)%7D%7BP(x%7Cz)%7D%20%5Cquad%0A%5Cend%7Balign%7D%0A"></p>
<ul>
<li>이제 우리는 <img src="https://latex.codecogs.com/png.latex?P(z)">를 따로 추정하거나 모든 <img src="https://latex.codecogs.com/png.latex?z">에 대해 합을 구할 필요 없이, 결합 확률 <img src="https://latex.codecogs.com/png.latex?P(y,x,z)">를 <strong><img src="https://latex.codecogs.com/png.latex?P(x%7Cz)"></strong>로 나눈 형태로 식을 단순화했습니다.</li>
</ul>
</section>
<section id="propensity-score-gz" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="propensity-score-gz"><span class="header-section-number">3.2</span> Propensity Score <img src="https://latex.codecogs.com/png.latex?g(z)"></h2>
<ul>
<li>위 식의 분모에 있는 <strong><img src="https://latex.codecogs.com/png.latex?P(x%7Cz)"></strong>는 공변량 <img src="https://latex.codecogs.com/png.latex?Z">가 주어졌을 때 원인 변수 <img src="https://latex.codecogs.com/png.latex?X">가 할당될 확률을 의미하며, 이를 <strong>Propensity Score</strong>라고 부릅니다.</li>
<li>보통 <img src="https://latex.codecogs.com/png.latex?g(z)">로 표기하며 로지스틱 회귀(Logistic Regression) 등의 모델을 사용하여 추정합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?g(z)%20=%20P(X=x%7CZ=z)"></p>
<hr>
</section>
</section>
<section id="estimating-from-samples" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Estimating from Samples</h1>
<ul>
<li>이제 <img src="https://latex.codecogs.com/png.latex?N">개의 관측 데이터 샘플이 주어졌을 때, 위 식을 표본 평균(Sample Mean) 형태로 근사해 보겠습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;%5Capprox%20%5Csum_%7Bz%7D%20%5Cfrac%7B%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Cmathbb%7B1%7D(y_i=y,%20x_i=x,%20z_i=z)%7D%7Bg(z)%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Csum_%7Bz%7D%20%5Cfrac%7B%5Cmathbb%7B1%7D(y_i=y,%20x_i=x,%20z_i=z)%7D%7Bg(z)%7D%20&amp;&amp;%20%5Ctext%7BSwap%20Summation%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Cfrac%7B%5Cmathbb%7B1%7D(y_i=y,%20x_i=x)%7D%7Bg(z_i)%7D%20&amp;&amp;%20%5Ctext%7BCollapse%20Sum%20over%20%7D%20Z%0A%5Cend%7Baligned%7D%0A"></p>
<ul>
<li><p>여기서 <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7B1%7D(%5Ccdot)">은 지시 함수(Indicator function)로, 괄호 안의 조건이 참이면 1, 거짓이면 0을 반환합니다.</p></li>
<li><p>기대값(Expectation) 관점에서 <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BE%7D%5BY%7Cdo(x)%5D">를 구한다면 식은 다음과 같이 정리됩니다.</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BE%7D%5BY%7Cdo(x)%5D%20&amp;=%20%5Csum_%7Bz,%20y%7D%20%5Cfrac%7By%20%5Ccdot%20P(y,%20x,%20z)%7D%7BP(x%7Cz)%7D%20%5C%5C%0A&amp;%5Capprox%20%5Csum_%7Bz,%20y%7D%20%5Cfrac%7By%20%5Ccdot%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Cmathbb%7B1%7D(y_i=y,%20x_i=x,%20z_i=z)%7D%7Bg(z)%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Csum_%7Bz,%20y%7D%20%5Cfrac%7By%20%5Ccdot%20%5Cmathbb%7B1%7D(y_i=y,%20x_i=x,%20z_i=z)%7D%7Bg(z)%7D%20&amp;&amp;%20%5Ctext%7BSwap%20Summation%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20y_i%20%5Cfrac%7B%5Cmathbb%7B1%7D(x_i=x)%7D%7Bg(z_i)%7D%20&amp;&amp;%20%5Ctext%7BCollapse%20Sum%20over%20%7D%20Z,%20Y%0A%5Cend%7Baligned%7D%0A"></p>
<section id="핵심-포인트" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="핵심-포인트"><span class="header-section-number">4.1</span> 핵심 포인트</h2>
<ul>
<li><strong><img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7B1%7D(%5Ccdot)"> (Indicator Function):</strong> 조건이 참이면 1, 거짓이면 0을 반환하는 함수입니다.</li>
<li><strong>시간 복잡도 <img src="https://latex.codecogs.com/png.latex?O(N)">:</strong> 가장 마지막 식을 보면, 더 이상 <img src="https://latex.codecogs.com/png.latex?Z">의 모든 조합에 대해 합을 구할 필요가 없습니다. 단순히 <strong>관측된 <img src="https://latex.codecogs.com/png.latex?N">개의 데이터 샘플</strong>을 한 번씩만 순회하며 가중치(<img src="https://latex.codecogs.com/png.latex?1/g(z_i)">)를 더하면 계산이 끝납니다. 이것이 IPW가 강력한 이유입니다.</li>
</ul>
</section>
<section id="시간-복잡도의-개선" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="시간-복잡도의-개선"><span class="header-section-number">4.2</span> 시간 복잡도의 개선</h2>
<ul>
<li>이 방식의 가장 큰 장점은 계산 효율성입니다.</li>
<li>고차원 <img src="https://latex.codecogs.com/png.latex?Z">에 대해 적분하거나 합을 구하는 대신, <strong>샘플 수 <img src="https://latex.codecogs.com/png.latex?N">에 비례하는 선형 시간(<img src="https://latex.codecogs.com/png.latex?O(N)">)</strong> 만에 계산이 가능합니다.</li>
</ul>
<hr>
</section>
</section>
<section id="average-treatment-effect-ate-with-ipw" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Average Treatment Effect (ATE) with IPW</h1>
<ul>
<li>일반적으로 우리가 가장 관심을 가지는 것은 처치(Treatment, <img src="https://latex.codecogs.com/png.latex?X=1">)와 통제(Control, <img src="https://latex.codecogs.com/png.latex?X=0">) 간의 평균적인 차이인 <strong>ATE</strong>입니다.</li>
<li>IPW를 이용한 ATE 추정량은 다음과 같습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0A%5Chat%7BATE%7D%20&amp;=%20%5Chat%7B%5Cmathbb%7BE%7D%7D%5BY%7Cdo(X=1)%5D%20-%20%5Chat%7B%5Cmathbb%7BE%7D%7D%5BY%7Cdo(X=0)%5D%20%5C%5C%0A&amp;=%20%5Cfrac%7B1%7D%7BN%7D%20%5Csum_%7Bi=1%7D%5E%7BN%7D%20%5Cleft(%20%5Cfrac%7By_i%20x_i%7D%7Bg(z_i)%7D%20-%20%5Cfrac%7By_i%20(1-x_i)%7D%7B1%20-%20g(z_i)%7D%20%5Cright)%0A%5Cend%7Balign%7D%0A"></p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?X_i=1">인 샘플(Treatment group)은 <img src="https://latex.codecogs.com/png.latex?1/g(z_i)">의 가중치를 갖습니다.</li>
<li><img src="https://latex.codecogs.com/png.latex?X_i=0">인 샘플(Control group)은 <img src="https://latex.codecogs.com/png.latex?1/(1-g(z_i))">의 가중치를 갖습니다.</li>
</ul>
<hr>
</section>
<section id="intuition-pseudo-causal-samples" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Intuition: Pseudo Causal Samples</h1>
<ul>
<li>IPW가 작동하는 원리를 직관적으로 이해하기 위해 “가상의 인과 샘플(Pseudo Causal Samples)” 개념을 살펴봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-04/images/ipw_concept.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Concept of Inverse Probability Weighting</figcaption>
</figure>
</div>
<ol type="1">
<li><strong>Observational Data:</strong> 현실 데이터에서는 <img src="https://latex.codecogs.com/png.latex?Z">의 특성에 따라 <img src="https://latex.codecogs.com/png.latex?X">를 선택할 확률(<img src="https://latex.codecogs.com/png.latex?P(x%7Cz)">)이 다릅니다 (Selection Bias).</li>
<li><strong>Weighting:</strong> <img src="https://latex.codecogs.com/png.latex?X">가 일어날 확률이 낮았던(<img src="https://latex.codecogs.com/png.latex?P(x%7Cz)">가 작은) 샘플일수록, 역수(<img src="https://latex.codecogs.com/png.latex?1/P(x%7Cz)">)를 취하면 가중치가 커집니다.
<ul>
<li>예를 들어, <img src="https://latex.codecogs.com/png.latex?P(x_1%7Cz_1)%20=%201/3">이었다면, 이 샘플은 가중치를 통해 <strong>3배</strong>로 부풀려집니다.</li>
</ul></li>
<li><strong>Pseudo Population:</strong> 이렇게 가중치를 적용하면, 마치 모든 샘플이 편향 없이 고르게 처리(<img src="https://latex.codecogs.com/png.latex?X">)를 받은 것과 같은 <strong>가상의 모집단</strong>이 형성됩니다.</li>
</ol>
<ul>
<li>결과적으로 IPW는 교란 변수 <img src="https://latex.codecogs.com/png.latex?Z">가 <img src="https://latex.codecogs.com/png.latex?X">에 미치는 영향을 역확률 가중치로 상쇄시켜, <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Z">의 연결 고리를 끊어내는(Do-operator와 유사한) 효과를 냅니다.</li>
</ul>
<hr>
<p><strong>Summary:</strong> 복잡한 인과 그래프에서 Back-door criterion을 만족하는 변수들을 찾아냈다면, <strong>IPW</strong>는 이를 실제로 계산 가능하게 만들어주는 강력한 도구입니다. Propensity Score <img src="https://latex.codecogs.com/png.latex?g(z)">만 정확히 모델링할 수 있다면, 우리는 선형 시간 내에 인과 효과를 추정할 수 있습니다.</p>


</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-04-part-04/</guid>
  <pubDate>Tue, 06 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 4. Confounding and Backdoor (Part 3)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-04-part-03/</link>
  <description><![CDATA[ 





<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<ul>
<li>지난 포스트에서는 교란 편향(Confounding Bias)이 인과 효과 추정을 방해하는 주된 요인임을 살펴보았습니다.</li>
<li>그렇다면 우리는 복잡한 인과 그래프(DAG)에서 <strong>어떤 변수들의 집합(<img src="https://latex.codecogs.com/png.latex?Z">)을 조절(Control/Adjustment)</strong>해야 이 편향을 제거할 수 있을까요?</li>
<li>이번 포스트에서는 그 해답이 되는 <strong>Back-door Criterion(백도어 기준)</strong>의 정의와 이를 이용한 보정 공식을 다룹니다.</li>
</ul>
<hr>
</section>
<section id="back-door-criterion" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Back-door Criterion</h1>
<section id="definition" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="definition"><span class="header-section-number">2.1</span> Definition</h2>
<ul>
<li>주어진 인과 그래프 <img src="https://latex.codecogs.com/png.latex?G">에서 변수 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y">에 대해, 변수들의 집합 <img src="https://latex.codecogs.com/png.latex?Z">가 다음 두 가지 조건을 만족할 때, <img src="https://latex.codecogs.com/png.latex?Z">는 <strong>Back-door Criterion</strong>을 만족한다고 정의합니다.</li>
</ul>
<blockquote class="blockquote">
<p><strong>(i) No node in <img src="https://latex.codecogs.com/png.latex?Z"> is a descendant of <img src="https://latex.codecogs.com/png.latex?X">.</strong> (<img src="https://latex.codecogs.com/png.latex?Z">에 속한 어떤 변수도 <img src="https://latex.codecogs.com/png.latex?X">의 자손이 아니어야 합니다.)</p>
<p><strong>(ii) <img src="https://latex.codecogs.com/png.latex?Z"> blocks every path between <img src="https://latex.codecogs.com/png.latex?X"> and <img src="https://latex.codecogs.com/png.latex?Y"> that contains an arrow into <img src="https://latex.codecogs.com/png.latex?X">.</strong> (<img src="https://latex.codecogs.com/png.latex?Z">는 <img src="https://latex.codecogs.com/png.latex?X">로 들어오는 화살표를 포함하는 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y"> 사이의 모든 경로를 차단해야 합니다.)</p>
</blockquote>
</section>
<section id="의미-해석" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="의미-해석"><span class="header-section-number">2.2</span> 의미 해석</h2>
<ol type="1">
<li><strong>조건 (i)</strong>은 <img src="https://latex.codecogs.com/png.latex?X">의 결과(Effect)로 나타나는 변수를 통제하지 말라는 뜻입니다. <img src="https://latex.codecogs.com/png.latex?X">의 자손을 통제하면 <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 실제 인과 경로를 막아버리거나 새로운 편향을 만들 수 있기 때문입니다.</li>
<li><strong>조건 (ii)</strong>의 “arrow into <img src="https://latex.codecogs.com/png.latex?X">”는 소위 <strong>백도어 경로(Back-door Path)</strong>를 의미합니다. 이는 <img src="https://latex.codecogs.com/png.latex?X">의 원인이 되는 변수들에 의해 생성되는 비인과적 상관관계(Spurious Correlation)의 경로입니다. 이 경로를 차단함으로써 우리는 <img src="https://latex.codecogs.com/png.latex?X">에서 <img src="https://latex.codecogs.com/png.latex?Y">로 나가는 순수한 인과적 경로만 남길 수 있습니다.</li>
</ol>
<hr>
</section>
</section>
<section id="back-door-adjustment-theorem" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Back-door Adjustment Theorem</h1>
<ul>
<li>만약 변수 집합 <img src="https://latex.codecogs.com/png.latex?Z">가 <img src="https://latex.codecogs.com/png.latex?X,%20Y">에 대해 Back-door Criterion을 만족한다면, <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 인과 효과는 식별 가능(Identifiable)하며 다음과 같이 계산할 수 있습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))%20=%20%5Csum_%7Bz%7D%20P(y%7Cx,z)P(z)"></p>
<ul>
<li>이를 <strong>Back-door Adjustment Formula</strong>라고 합니다. 이 식은 우리가 <img src="https://latex.codecogs.com/png.latex?do(x)">라는 가상의 중재를 하지 않고도, 관측된 데이터(<img src="https://latex.codecogs.com/png.latex?P(y%7Cx,z),%20P(z)">)만으로 인과 효과를 계산할 수 있게 해줍니다.</li>
</ul>
<hr>
</section>
<section id="example-1-sprinkler-rain-and-wet" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Example 1: Sprinkler, Rain, and Wet</h1>
<ul>
<li>이 개념을 이해하기 위해 고전적인 예제인 “스프링클러와 비” 모델을 살펴봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-03/images/sprinkler_dag.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Causal Graph for Sprinkler Example</figcaption>
</figure>
</div>
<ul>
<li><strong>목표:</strong> 스프링클러(<img src="https://latex.codecogs.com/png.latex?X="> Sprinkler)가 땅이 젖는 것(<img src="https://latex.codecogs.com/png.latex?Y="> Wet)에 미치는 인과 효과 구하기.</li>
<li><strong>Back-door Path:</strong> <img src="https://latex.codecogs.com/png.latex?Sprinkler%20%5Cleftarrow%20Season%20%5Crightarrow%20Rain%20%5Crightarrow%20Wet">
<ul>
<li>이 경로는 스프링클러로 들어오는 화살표(<img src="https://latex.codecogs.com/png.latex?Season%20%5Cto%20Sprinkler">)로 시작하므로 백도어 경로입니다.</li>
</ul></li>
<li>여기서 변수 집합 <strong><img src="https://latex.codecogs.com/png.latex?Z%20=%20%5C%7BRain%5C%7D"></strong>을 고려해 봅시다.</li>
</ul>
<ol type="1">
<li><strong>조건 (i):</strong> Rain은 Sprinkler의 자손이 아닙니다. (만족)</li>
<li><strong>조건 (ii):</strong> Rain은 위 백도어 경로상에 존재하며, Chain 구조(<img src="https://latex.codecogs.com/png.latex?%5Cdots%20%5Cto%20Rain%20%5Cto%20%5Cdots">)에 있으므로 Rain을 조건부로 잡으면(Adjusting) 이 경로는 차단됩니다. (만족)</li>
</ol>
<ul>
<li>따라서 우리는 Rain을 통해 보정할 수 있습니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(Wet%20%7C%20do(Sprinkler))%20=%20%5Csum_%7BRain%7D%20P(Wet%20%7C%20Sprinkler,%20Rain)%20P(Rain)"></p>
<ul>
<li>이 과정은 <img src="https://latex.codecogs.com/png.latex?Season">이라는 공통 원인(Back-door Parent)을 직접 관측하지 못하더라도, 경로를 막을 수 있는 다른 변수(<img src="https://latex.codecogs.com/png.latex?Rain">)를 이용해 보정이 가능함을 보여줍니다.</li>
</ul>
<hr>
</section>
<section id="example-2-complex-graph-strategies" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Example 2: Complex Graph &amp; Strategies</h1>
<ul>
<li>조금 더 복잡한 그래프에서 적절한 백도어 집합(<img src="https://latex.codecogs.com/png.latex?Z">)을 찾는 연습을 해봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-03/images/complex_dag_exercise.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2. Finding Admissible Sets in a Complex Graph</figcaption>
</figure>
</div>
<section id="분석-포인트" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="분석-포인트"><span class="header-section-number">5.1</span> 분석 포인트</h2>
<ul>
<li>이 그래프에서 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y"> 사이의 백도어 경로를 차단해야 합니다. <img src="https://latex.codecogs.com/png.latex?X">에서 나가는 화살표를 지운 그래프(<img src="https://latex.codecogs.com/png.latex?G_%7B%5Cunderline%7BX%7D%7D">)를 상상했을 때 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y">가 d-separation 되는지 확인하는 것과 같습니다.</li>
</ul>
</section>
<section id="가능한-z-집합의-예시" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="가능한-z-집합의-예시"><span class="header-section-number">5.2</span> 가능한 <img src="https://latex.codecogs.com/png.latex?Z"> 집합의 예시</h2>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?Z%20=%20%5C%7BZ_4,%20Z_2%5C%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?Z%20=%20%5C%7BZ_4,%20Z_5%5C%7D"></li>
<li><img src="https://latex.codecogs.com/png.latex?Z%20=%20%5C%7BZ_4,%20Z_2,%20Z_5%5C%7D"></li>
</ul>
</section>
<section id="주의할-점-collider-z_4" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="주의할-점-collider-z_4"><span class="header-section-number">5.3</span> 주의할 점: Collider (<img src="https://latex.codecogs.com/png.latex?Z_4">)</h2>
<ul>
<li><p>위 그래프에서 <img src="https://latex.codecogs.com/png.latex?Z_4">는 <img src="https://latex.codecogs.com/png.latex?Z_1%20%5Cto%20Z_4%20%5Cleftarrow%20Z_2"> 구조를 갖는 <strong>Collider</strong>입니다.</p></li>
<li><p>만약 <img src="https://latex.codecogs.com/png.latex?Z_4">를 집합에 포함하지 않으면, <img src="https://latex.codecogs.com/png.latex?Z_1%20-%20Z_4%20-%20Z_2"> 경로는 자연스럽게 막혀(Blocked) 있습니다.</p></li>
<li><p>하지만 <img src="https://latex.codecogs.com/png.latex?Z_4">를 집합에 포함시켜 조건부로 잡으면(Conditioning), 오히려 <img src="https://latex.codecogs.com/png.latex?Z_1">과 <img src="https://latex.codecogs.com/png.latex?Z_2"> 사이의 경로가 열리게 됩니다</p></li>
<li><p>따라서 <img src="https://latex.codecogs.com/png.latex?Z_4">를 조정 변수로 사용할 때는, 이로 인해 열리는 다른 경로(<img src="https://latex.codecogs.com/png.latex?Z_1%20%5Cdots%20Z_2">)를 막아줄 추가적인 변수(<img src="https://latex.codecogs.com/png.latex?Z_2"> 등)를 함께 포함해야 합니다.</p></li>
</ul>
</section>
<section id="case-z-emptyset-no-confounding" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="case-z-emptyset-no-confounding"><span class="header-section-number">5.4</span> Case: <img src="https://latex.codecogs.com/png.latex?Z%20=%20%5Cemptyset"> (No Confounding)</h2>
<ul>
<li>만약 <img src="https://latex.codecogs.com/png.latex?X">로 들어오는 백도어 경로가 아예 없는 그래프라면 어떨까요?</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-03/images/no_confounding_dag.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3. Case where no adjustment is needed</figcaption>
</figure>
</div>
<ul>
<li>이 경우 공집합 <img src="https://latex.codecogs.com/png.latex?Z%20=%20%5Cemptyset">도 Back-door Criterion을 만족합니다.</li>
<li>즉, 별도의 조정 없이 관측된 조건부 확률이 곧 인과 효과가 됩니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cx)%20=%20P(y%7Cdo(x))"></p>
<ul>
<li>이것이 바로 “교란이 없으면 상관관계는 인과관계이다(Correlation is Causation)”가 성립하는 유일한 순간입니다.</li>
</ul>
<hr>
</section>
</section>
<section id="derivation-adjustment-by-direct-parents-to-back-door-adjustment" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Derivation: Adjustment by Direct Parents <img src="https://latex.codecogs.com/png.latex?%5Cto"> Back-door Adjustment</h1>
<section id="recap-adjustment-by-direct-parents" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="recap-adjustment-by-direct-parents"><span class="header-section-number">6.1</span> Recap: Adjustment by Direct Parents</h2>
<ul>
<li>일반적으로 <img src="https://latex.codecogs.com/png.latex?X">의 모든 <strong>직접적인 부모(Direct Parents, <img src="https://latex.codecogs.com/png.latex?Pa_X">)</strong>를 통제하면 Back-door Criterion을 항상 만족합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))%20=%20%5Csum_%7Bpa_X%7D%20P(y%20%7C%20x,%20pa_X)%20P(pa_X)"></p>
<ul>
<li>하지만 모든 부모 변수를 관측하는 것은 현실적으로 어려울 수 있습니다.</li>
<li>그렇다면, 부모가 아닌 <strong>Back-door Criterion을 만족하는 임의의 집합 <img src="https://latex.codecogs.com/png.latex?Z"></strong>를 통제해도 왜 동일한 결과가 나올까요?</li>
<li>아래 증명은 <strong>Direct Parents Adjustment</strong> 공식에서 시작하여 <strong>Back-door Adjustment</strong> 공식으로 유도되는 과정을 보여줍니다.</li>
</ul>
<hr>
</section>
<section id="가정-assumptions" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="가정-assumptions"><span class="header-section-number">6.2</span> 가정 (Assumptions)</h2>
<ul>
<li>집합 <img src="https://latex.codecogs.com/png.latex?Z">가 Back-door criterion을 만족한다고 가정합시다.</li>
<li>Let <img src="https://latex.codecogs.com/png.latex?Z%5E-%20=%20Z%20%5Csetminus%20Pa_X"> (부모 변수를 제외한 나머지 <img src="https://latex.codecogs.com/png.latex?Z">의 요소들).</li>
</ul>
<ol type="1">
<li><strong>Condition (i):</strong> <img src="https://latex.codecogs.com/png.latex?Z">의 어떤 노드도 <img src="https://latex.codecogs.com/png.latex?X">의 자손이 아님. <img src="https://latex.codecogs.com/png.latex?%5CRightarrow%20X%20%5Cperp%20(Z%20%5Csetminus%20Pa_X)%20%5Cmid%20Pa_X"> <img src="https://latex.codecogs.com/png.latex?%5CRightarrow%20P(z%5E%7B-%7D%20%7C%20x,%20pa_%7BX%7D)%20=%20P(z%5E%7B-%7D%20%7C%20pa_%7BX%7D)">
<ul>
<li><strong>“미래는 과거를 바꿀 수 없다”</strong>는 원리입니다.</li>
<li>인과 그래프에서 부모(<img src="https://latex.codecogs.com/png.latex?Pa_%7BX%7D">)와 <img src="https://latex.codecogs.com/png.latex?Z">는 <img src="https://latex.codecogs.com/png.latex?X">보다 먼저 일어난 일(또는 원인)이고, <img src="https://latex.codecogs.com/png.latex?X">는 그 결과입니다.</li>
<li>이미 부모(<img src="https://latex.codecogs.com/png.latex?Pa_%7BX%7D">)의 상태를 다 알고 있다면, 결과인 <img src="https://latex.codecogs.com/png.latex?X">가 무엇이든 간에 그 원인이나 별개의 사건인 <img src="https://latex.codecogs.com/png.latex?Z">의 확률은 변하지 않습니다.</li>
</ul></li>
<li><strong>Condition (ii):</strong> <img src="https://latex.codecogs.com/png.latex?Z">는 <img src="https://latex.codecogs.com/png.latex?X">로 들어오는 모든 뒷문 경로를 차단함. <img src="https://latex.codecogs.com/png.latex?%5CRightarrow%20Y%20%5Cperp%20(Pa_X%20%5Csetminus%20Z)%20%5Cmid%20Z,%20X"> <img src="https://latex.codecogs.com/png.latex?%5CRightarrow%20P(y%20%7C%20x,%20pa_%7BX%7D,%20z%5E%7B-%7D)%20=%20P(y%20%7C%20x,%20z)"> <em>(<img src="https://latex.codecogs.com/png.latex?Z">와 <img src="https://latex.codecogs.com/png.latex?X">가 주어졌을 때, <img src="https://latex.codecogs.com/png.latex?Y">는 <img src="https://latex.codecogs.com/png.latex?Z">에 포함되지 않은 나머지 부모들과 독립이다)</em>
<ul>
<li><strong>“Z가 이미 충분한 정보를 담고 있다”</strong>는 원리입니다.</li>
<li>원래 <img src="https://latex.codecogs.com/png.latex?Y">를 예측하려면 교란 요인인 모든 부모들(<img src="https://latex.codecogs.com/png.latex?Pa_%7BX%7D">)을 다 봐야 합니다. 하지만 <img src="https://latex.codecogs.com/png.latex?Z">가 ’백도어 기준’을 만족한다는 것은, <img src="https://latex.codecogs.com/png.latex?Z">가 부모들이 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 교란을 대신해서 다 막아주고 있다는 뜻입니다.</li>
<li>따라서 일단 <img src="https://latex.codecogs.com/png.latex?Z">를 알고 나면, 굳이 <img src="https://latex.codecogs.com/png.latex?Z">에 포함되지 않은 나머지 부모들(<img src="https://latex.codecogs.com/png.latex?Pa_%7BX%7D">)을 추가로 더 안다고 해서 <img src="https://latex.codecogs.com/png.latex?Y">에 대한 예측이 달라지지 않습니다. <img src="https://latex.codecogs.com/png.latex?Z">가 그 역할을 완벽히 대체했기 때문입니다.</li>
</ul></li>
</ol>
</section>
<section id="증명-derivation" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="증명-derivation"><span class="header-section-number">6.3</span> 증명 (Derivation)</h2>
<ul>
<li>부모 변수를 통한 조정(Adjustment by Direct Parents) 공식에서 시작합니다.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AP(y%7Cdo(x))%20&amp;=%20%5Csum_%7Bpa_X%7D%20P(y%7Cx,%20pa_X)P(pa_X)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%5E-,%20pa_X%7D%20P(y%7Cx,%20pa_X,%20z%5E-)P(z%5E-%7Cx,%20pa_X)P(pa_X)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BExpand%20by%20%7D%20Z%5E-%20%5Ctext%7B%20(Total%20Probability)%7D%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%5E-,%20pa_X%7D%20P(y%7Cx,%20z)P(z%5E-%7Cpa_X)P(pa_X)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BApply%20Assumptions%20Condition%20(i)%20%5C&amp;%20(ii)%7D%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%5E-,%20pa_X%7D%20P(y%7Cx,%20z)P(z%5E-,%20pa_X)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BChain%20Rule%20%7D%20P(A%7CB)P(B)%20=%20P(A,B)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%7D%20P(y%7Cx,%20z)%20%5Csum_%7Bpa_X%20%5Csetminus%20z%7D%20P(z%5E-,%20pa_X)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BRearrange%20Summation%20%7D%20(Z%20%5Ccup%20(Pa_X%20%5Csetminus%20Z)%20=%20%5C%7BZ,%20Pa_X%5C%7D)%20%5C%5C%0A&amp;=%20%5Csum_%7Bz%7D%20P(y%7Cx,%20z)P(z)%20&amp;&amp;%20%5Cbecause%20%5Ctext%7BMarginalize%20out%20%7D%20Pa_X%20%5Csetminus%20Z%0A%5Cend%7Baligned%7D%0A"></p>
<ul>
<li><strong>결론:</strong> <br></li>
</ul>
<blockquote class="blockquote">
<p>Adjustment by <img src="https://latex.codecogs.com/png.latex?Z"> is equivalent to adjustment by direct parents whenever <img src="https://latex.codecogs.com/png.latex?Z"> is back-door admissible.</p>
</blockquote>
<ul>
<li>즉, <img src="https://latex.codecogs.com/png.latex?Z">가 Back-door criterion만 만족한다면, 직접적인 부모를 모두 측정하지 못하더라도 <img src="https://latex.codecogs.com/png.latex?Z">를 통해 인과 효과를 정확히 계산할 수 있음이 수학적으로 증명됩니다.</li>
</ul>


</section>
</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-04-part-03/</guid>
  <pubDate>Tue, 06 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 4. Confounding and Backdoor (Part 2)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-04-part-02/</link>
  <description><![CDATA[ 





<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<ul>
<li>지난 포스트에서는 인과 효과의 <strong>식별 가능성(Identifiability)</strong>에 대해 다루었습니다. 이번에는 현실 데이터 분석에서 가장 빈번하게 마주치는 문제이자, 인과추론이 필요한 가장 큰 이유 중 하나인 <strong>교란 편향(Confounding Bias)</strong>에 대해 구체적인 예시를 통해 알아보겠습니다.</li>
</ul>
<hr>
</section>
<section id="the-problem-of-confounding-exercise-and-cholesterol" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The Problem of Confounding: Exercise and Cholesterol</h1>
<ul>
<li>우리가 운동(<img src="https://latex.codecogs.com/png.latex?X">)이 콜레스테롤 수치(<img src="https://latex.codecogs.com/png.latex?Y">)에 미치는 인과 효과를 알고 싶다고 가정해 봅시다. 이를 위해 사람들의 운동 시간과 콜레스테롤 수치를 측정하여 데이터를 수집했습니다.</li>
</ul>
<section id="단순-관측-직관과-반대되는-결과" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="단순-관측-직관과-반대되는-결과"><span class="header-section-number">2.1</span> 1. 단순 관측: 직관과 반대되는 결과</h2>
<ul>
<li>수집한 데이터를 단순히 산점도(Scatter Plot)로 그려보았더니 놀라운 결과가 나타났습니다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-02/images/exercise_cholesterol_scatter.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Observed Correlation between Exercise and Cholesterol</figcaption>
</figure>
</div>
<ul>
<li><strong>관측 결과:</strong> 운동을 많이 하는 사람일수록 콜레스테롤 수치가 더 높게 나타납니다.</li>
<li><strong>의문:</strong> <img src="https://latex.codecogs.com/png.latex?P(%5Ctext%7Bcholesterol%7D%20%7C%20%5Ctext%7Bexercise%7D)">를 보면, 운동이 콜레스테롤을 높이는 것처럼 보입니다. 과연 “더 많은 운동 <img src="https://latex.codecogs.com/png.latex?%5CRightarrow"> 콜레스테롤 증가”라고 결론 내릴 수 있을까요?</li>
</ul>
</section>
<section id="교란-변수의-발견-나이age" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="교란-변수의-발견-나이age"><span class="header-section-number">2.2</span> 2. 교란 변수의 발견: 나이(Age)</h2>
<ul>
<li>이 이상한 현상을 이해하기 위해, 우리는 데이터에 숨겨진 제3의 변수인 <strong>‘나이(Age)’</strong>를 색상으로 구분하여 다시 시각화해보았습니다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-02/images/exercise_cholesterol_age.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2. Scatter Plot Stratified by Age</figcaption>
</figure>
</div>
<ul>
<li>그래프를 자세히 보면 다음과 같은 패턴이 드러납니다:
<ol type="1">
<li><strong>나이와 운동:</strong> 나이가 많은 사람(노란색 계열)들이 건강 관리를 위해 운동을 더 많이 하는 경향이 있습니다.</li>
<li><strong>나이와 콜레스테롤:</strong> 동시에, 나이가 많을수록 자연적으로 콜레스테롤 수치가 높습니다.</li>
</ol></li>
<li>즉, <strong>‘나이’</strong>가 운동량(<img src="https://latex.codecogs.com/png.latex?X">)과 콜레스테롤(<img src="https://latex.codecogs.com/png.latex?Y">) 모두에 영향을 미치는 <strong>교란 변수(Confounder)</strong>로 작용하고 있었던 것입니다.</li>
</ul>
</section>
<section id="계층별-분석-인과-효과의-확인" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="계층별-분석-인과-효과의-확인"><span class="header-section-number">2.3</span> 3. 계층별 분석: 인과 효과의 확인</h2>
<ul>
<li>이제 나이(Age)를 고정한 상태에서 운동과 콜레스테롤의 관계를 다시 살펴봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-02/images/exercise_cholesterol_stratified.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3. True Causal Effect within Age Groups</figcaption>
</figure>
</div>
<ul>
<li>각 연령대 그룹(같은 색깔) 내부를 들여다보면, 운동을 많이 할수록 콜레스테롤 수치가 <strong>낮아지는</strong> 것을 명확히 볼 수 있습니다.</li>
<li><strong>결론:</strong> 운동의 진짜 인과 효과는 콜레스테롤을 낮추는 것입니다. (<img src="https://latex.codecogs.com/png.latex?More%5C%20exercise%20%5CRightarrow%20Lower%5C%20Cholesterol">)</li>
</ul>
<hr>
</section>
</section>
<section id="confounding-bias-definition" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Confounding Bias Definition</h1>
<ul>
<li><p>위의 예시는 <strong>교란 편향(Confounding Bias)</strong>이 무엇인지 명확하게 보여줍니다.</p>
<ul>
<li><strong>Association (관측된 상관관계):</strong> <img src="https://latex.codecogs.com/png.latex?P(y%7Cx)">
<ul>
<li>데이터 전체를 그냥 보았을 때의 분포입니다. 여기서는 “운동을 하면 콜레스테롤이 높다”였습니다.</li>
</ul></li>
<li><strong>Causation (인과 효과):</strong> <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">
<ul>
<li>우리가 알고 싶은 진짜 효과입니다. “운동을 시키면(<img src="https://latex.codecogs.com/png.latex?do">) 콜레스테롤이 낮아진다”입니다.</li>
</ul></li>
</ul></li>
<li><p>이 둘의 차이가 바로 편향입니다.</p></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cx)%20%5Cneq%20P(y%7Cdo(x))"></p>
<ul>
<li>이 차이는 인과추론과 해석 가능성(Interpretability)을 가로막는 가장 큰 장애물 중 하나입니다.</li>
</ul>
<hr>
</section>
<section id="is-confounding-bias-removable" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Is Confounding Bias Removable?</h1>
<ul>
<li>그렇다면 이러한 교란 편향은 어떻게 제거할 수 있을까요?</li>
<li>위의 예시처럼 ’나이’라는 변수가 명확하다면 조정(Adjustment)하면 되지만, 변수 관계가 복잡해지면 어떤 변수를 통제해야 할지 결정하기가 쉽지 않습니다.</li>
</ul>
<section id="복잡한-인과-그래프에서의-문제" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="복잡한-인과-그래프에서의-문제"><span class="header-section-number">4.1</span> 복잡한 인과 그래프에서의 문제</h2>
<ul>
<li>다음과 같이 복잡한 인과 그래프를 고려해 봅시다.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-02/images/complex_dag.png" class="img-fluid figure-img"></p>
<figcaption>Figure 4. A Complex Causal Graph</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Goal:</strong> 변수 <img src="https://latex.codecogs.com/png.latex?Z_1,%20...,%20Z_k">가 측정되었을 때, <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 미치는 인과 효과 <img src="https://latex.codecogs.com/png.latex?Q%20=%20P(y%7Cdo(x))">를 찾아내는 것.</p></li>
<li><p>여기서 중요한 질문이 생깁니다.</p>
<ul>
<li><strong>“부모 변수(Parents) 중 일부만 관측되었을 때, 타겟 인과 효과 <img src="https://latex.codecogs.com/png.latex?Q">를 식별할 수 있는가?”</strong></li>
</ul></li>
</ul>
</section>
<section id="주의해야-할-구조-collider" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="주의해야-할-구조-collider"><span class="header-section-number">4.2</span> 주의해야 할 구조: Collider</h2>
<ul>
<li>그래프 분석 시 주의해야 할 점은 단순히 모든 변수를 통제(Conditioning)한다고 좋은 것이 아니라는 점입니다.</li>
<li>예를 들어 위 그래프에서 <strong><img src="https://latex.codecogs.com/png.latex?Z_4"></strong>와 같은 변수를 살펴봅시다.</li>
</ul>
<blockquote class="blockquote">
<p><strong>Note:</strong> <img src="https://latex.codecogs.com/png.latex?Z_4">는 <img src="https://latex.codecogs.com/png.latex?Z_1">과 <img src="https://latex.codecogs.com/png.latex?Z_2">의 화살표를 동시에 받는 <strong>Collider</strong> (<img src="https://latex.codecogs.com/png.latex?Z_1%20%5Crightarrow%20Z_4%20%5Cleftarrow%20Z_2">)입니다. <img src="https://latex.codecogs.com/png.latex?Z_4">를 조건부(given)로 잡을 경우, 오히려 <img src="https://latex.codecogs.com/png.latex?Z_1">과 <img src="https://latex.codecogs.com/png.latex?Z_2"> 사이에 길이 뚫리는 현상이 발생하여 새로운 편향을 만들 수 있습니다.</p>
</blockquote>
<ul>
<li>따라서 우리는 어떤 변수를 조정 집합(Adjustment Set)에 넣어야 편향을 제거하고 올바른 인과 효과를 구할 수 있는지 판단하는 체계적인 기준이 필요합니다. 이것이 바로 다음 포스트에서 다룰 <strong>Back-door Criterion</strong>입니다.</li>
</ul>


</section>
</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-04-part-02/</guid>
  <pubDate>Tue, 06 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 4. Confounding and Backdoor (Part 1)</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-04-part-01/</link>
  <description><![CDATA[ 





<section id="overview" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Overview</h1>
<p>이번 포스트에서는 인과추론에서 가장 핵심적인 개념 중 하나인 <strong>교란(Confounding)</strong>과 이를 해결하기 위한 <strong>백도어 기준(Back-door Criterion)</strong>으로 나아가기 전, <strong>식별 가능성(Identification Problem)</strong>에 대해 다시 한번 짚어보고자 합니다.</p>
<p>강의 자료는 서울대학교 데이터사이언스대학원 이상학 교수님의 “Confounding and Backdoor” 수업 자료를 바탕으로 합니다</p>
<section id="목차" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="목차"><span class="header-section-number">1.1</span> 목차</h2>
<ol type="1">
<li>Recap(Identification Problem) and Example of Identifiable and Non-identifiable Effects</li>
<li>Confounding Bias</li>
<li>Back-door Criterion</li>
<li>Evaluation</li>
</ol>
<hr>
</section>
</section>
<section id="recap-identification-problem" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Recap: Identification Problem</h1>
<p>인과추론의 궁극적인 목표는 우리가 관측할 수 없는 <strong>인과 효과(Causal Effect)</strong>, 즉 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">를 관측 가능한 데이터 <img src="https://latex.codecogs.com/png.latex?P(v)">와 가정한 인과 그래프(Causal Graph) <img src="https://latex.codecogs.com/png.latex?G">를 통해 계산해낼 수 있는지 확인하는 것입니다.</p>
<ul>
<li><strong>Identifiable (식별 가능):</strong> 관측 분포 <img src="https://latex.codecogs.com/png.latex?P(v)">와 그래프 <img src="https://latex.codecogs.com/png.latex?G">가 주어졌을 때, 유일한 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">가 도출되는 경우.</li>
<li><strong>Non-identifiable (식별 불가능):</strong> 동일한 <img src="https://latex.codecogs.com/png.latex?P(v)">와 <img src="https://latex.codecogs.com/png.latex?G">를 만족함에도 불구하고, 서로 다른 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))"> 값을 갖는 모델이 두 개 이상 존재하는 경우</li>
</ul>
<hr>
</section>
<section id="example-1-identifiable-effect" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Example 1: Identifiable Effect</h1>
<p>먼저, 인과 효과가 식별 가능한(Identifiable) 경우를 살펴보겠습니다. 아래와 같은 인과 그래프를 가정해 봅시다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-01/images/identifiable_graph.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1. Causal Graph where effect is identifiable</figcaption>
</figure>
</div>
<p>이 구조에서 관측 분포 <img src="https://latex.codecogs.com/png.latex?P(v)">는 다음과 같이 factorization 됩니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(v)%20=%20P(z)P(x%7Cz)P(y%7Cx,z)"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-01/images/identifiable_graph_intervened.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2. Causal Graph where effect is identifiable</figcaption>
</figure>
</div>
<p>우리가 구하고자 하는 개입(Intervention) 분포 <img src="https://latex.codecogs.com/png.latex?P(v'%7Cdo(x))">는 <img src="https://latex.codecogs.com/png.latex?x">로 들어오는 화살표를 끊어낸 그래프에서의 분포이므로 다음과 같습니다</p>
<p><img src="https://latex.codecogs.com/png.latex?P(v'%7Cdo(x))%20=%20P(z)P(y%7Cx,z)"></p>
<p>따라서, <img src="https://latex.codecogs.com/png.latex?Y">에 대한 Marginal Distribution를 구하면 <strong>Back-door Adjustment Formula</strong>와 동일한 결과를 얻게 됩니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))%20=%20%5Csum_%7Bz%7D%20P(z)P(y%7Cx,z)"></p>
<p>이 식의 중요한 점은 우변의 모든 항(<img src="https://latex.codecogs.com/png.latex?P(z)">, <img src="https://latex.codecogs.com/png.latex?P(y%7Cx,z)">)이 <strong>관측 데이터(Observational Data)</strong>로부터 추정할 수 있다는 것입니다. 즉, <img src="https://latex.codecogs.com/png.latex?P(v)">가 동일한 모든 모델은 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">에 대해서도 동일한 값을 내놓으므로, 이 효과는 <strong>식별 가능(Identifiable)</strong>합니다</p>
<hr>
</section>
<section id="example-2-non-identifiable-effect" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Example 2: Non-identifiable Effect</h1>
<p>그렇다면 식별 불가능한 경우는 어떤 모습일까요? 이를 증명하기 위해, <strong>동일한 그래프와 동일한 관측 분포 <img src="https://latex.codecogs.com/png.latex?P(v)">를 가지지만, 서로 다른 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">를 나타내는 두 개의 모델(<img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(1)%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(2)%7D">)</strong>을 구성해 보겠습니다</p>
<section id="설정-setup" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="설정-setup"><span class="header-section-number">4.1</span> 설정 (Setup)</h2>
<p>아래와 같은 “Bow-tie” 형태의 그래프를 고려합니다. 여기서 <img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D">는 <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y">에 동시에 영향을 주는 관측되지 않은 교란 변수(Unobserved Confounder)입니다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-01/images/non_identifiable_graph.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3. Causal Graph with Unobserved Confounder</figcaption>
</figure>
</div>
<p>두 모델 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(1)%7D">과 <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(2)%7D">는 다음과 같은 구조적 방정식(Structural Equations)을 갖습니다. 여기서 <img src="https://latex.codecogs.com/png.latex?U_Y,%20U_%7BXY%7D">는 모두 베르누이 분포(동전 던지기, <img src="https://latex.codecogs.com/png.latex?p=0.5">)를 따릅니다.</p>
<section id="model-1-mathcalh1" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="model-1-mathcalh1"><span class="header-section-number">4.1.1</span> Model 1 (<img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(1)%7D">)</h3>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0AX%20%5Cleftarrow%20U_%7BXY%7D%20%5C%5C%0AY%20%5Cleftarrow%20(X%20%5Coplus%20U_%7BXY%7D)%20%5Clor%20U_Y%0A%5Cend%7Bcases%7D%0A"> * 여기서 <img src="https://latex.codecogs.com/png.latex?%5Coplus">는 XOR 연산, <img src="https://latex.codecogs.com/png.latex?%5Clor">는 OR 연산을 의미합니다.</p>
</section>
<section id="model-2-mathcalh2" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="model-2-mathcalh2"><span class="header-section-number">4.1.2</span> Model 2 (<img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(2)%7D">)</h3>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0AX%20%5Cleftarrow%20U_%7BXY%7D%20%5C%5C%0AY%20%5Cleftarrow%20U_Y%0A%5Cend%7Bcases%7D%0A"> * 모델 2에서는 <img src="https://latex.codecogs.com/png.latex?X">가 <img src="https://latex.codecogs.com/png.latex?Y">에 아무런 영향을 주지 않습니다 (끊어진 인과 관계).</p>
</section>
</section>
<section id="관측-분포의-일치-observational-equivalence" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="관측-분포의-일치-observational-equivalence"><span class="header-section-number">4.2</span> 관측 분포의 일치 (Observational Equivalence)</h2>
<p>놀랍게도 두 모델은 <strong>관측 데이터 상으로는 완벽하게 동일</strong>합니다.</p>
<ol type="1">
<li><p><strong>Model 1의 경우:</strong> 구조 방정식을 보면 <img src="https://latex.codecogs.com/png.latex?X">는 <img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D">와 같습니다. 따라서 <img src="https://latex.codecogs.com/png.latex?X%20%5Coplus%20U_%7BXY%7D">는 항상 <img src="https://latex.codecogs.com/png.latex?0">이 됩니다 (<img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D">가 같으므로). <img src="https://latex.codecogs.com/png.latex?Y%20=%200%20%5Clor%20U_Y%20=%20U_Y"> 결국 관측 환경에서는 <img src="https://latex.codecogs.com/png.latex?Y">가 오직 <img src="https://latex.codecogs.com/png.latex?U_Y">에 의해서만 결정됩니다</p></li>
<li><p><strong>Model 2의 경우:</strong> 정의상 <img src="https://latex.codecogs.com/png.latex?Y%20%5Cleftarrow%20U_Y">이므로, 역시 <img src="https://latex.codecogs.com/png.latex?Y">는 <img src="https://latex.codecogs.com/png.latex?U_Y">에 의해 결정됩니다.</p></li>
</ol>
<p>결과적으로 두 모델 모두 <img src="https://latex.codecogs.com/png.latex?P(Y=1)%20=%20P(U_Y=1)%20=%200.5">이며, <img src="https://latex.codecogs.com/png.latex?X">와 <img src="https://latex.codecogs.com/png.latex?Y">의 결합 분포 표(Truth Table)도 완전히 일치합니다</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?U_Y"></th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D"> (<img src="https://latex.codecogs.com/png.latex?=X">)</th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?Y%5E%7B(1)%7D"> (Model 1)</th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?Y%5E%7B(2)%7D"> (Model 2)</th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?P(u)"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1/4</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1/4</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1/4</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1/4</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="인과-효과의-불일치-interventional-differences" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="인과-효과의-불일치-interventional-differences"><span class="header-section-number">4.3</span> 인과 효과의 불일치 (Interventional Differences)</h2>
<p>이제 <img src="https://latex.codecogs.com/png.latex?do(x)"> 연산을 통해 실제로 인과 효과를 계산해 보면 두 모델의 차이가 드러납니다. <img src="https://latex.codecogs.com/png.latex?do(x)">는 <img src="https://latex.codecogs.com/png.latex?X">를 강제로 특정 값으로 고정하는 것이므로, 더 이상 <img src="https://latex.codecogs.com/png.latex?X">는 <img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D">의 영향을 받지 않습니다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-04-part-01/images/non_identifiable_graph_intervened.png" class="img-fluid figure-img"></p>
<figcaption>Figure 4. Causal Graph with Unobserved Confounder</figcaption>
</figure>
</div>
<p>우리는 <strong><img src="https://latex.codecogs.com/png.latex?P(y=1%20%7C%20do(x=0))"></strong>을 계산해 보겠습니다</p>
<section id="case-1-model-mathcalh1" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="case-1-model-mathcalh1"><span class="header-section-number">4.3.1</span> Case 1: Model <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(1)%7D"></h3>
<p>구조 방정식: <img src="https://latex.codecogs.com/png.latex?Y%20%5Cleftarrow%20(x%20%5Coplus%20U_%7BXY%7D)%20%5Clor%20U_Y">. 여기서 <img src="https://latex.codecogs.com/png.latex?x=0">으로 고정했습니다.</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D=0,%20U_Y=0%20%5CRightarrow%20Y%20=%20(0%20%5Coplus%200)%20%5Clor%200%20=%200"></li>
<li><img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D=0,%20U_Y=1%20%5CRightarrow%20Y%20=%20(0%20%5Coplus%200)%20%5Clor%201%20=%201"> (<img src="https://latex.codecogs.com/png.latex?U_Y=1"> 이면 어차피 <img src="https://latex.codecogs.com/png.latex?Y=1">)</li>
<li><strong><img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D=1,%20U_Y=0%20%5CRightarrow%20Y%20=%20(0%20%5Coplus%201)%20%5Clor%200%20=%201"></strong> (<img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D=1%20%5CnRightarrow%20X=1"> 이므로, 여기서 차이 발생!)</li>
<li><img src="https://latex.codecogs.com/png.latex?U_%7BXY%7D=1,%20U_Y=1%20%5CRightarrow%20Y%20=%20(0%20%5Coplus%201)%20%5Clor%201%20=%201"> (<img src="https://latex.codecogs.com/png.latex?U_Y=1"> 이면 어차피 <img src="https://latex.codecogs.com/png.latex?Y=1">)</li>
</ul>
<p>4가지 경우 중 3가지 경우에 <img src="https://latex.codecogs.com/png.latex?Y=1">이 됩니다. <img src="https://latex.codecogs.com/png.latex?%5Ctherefore%20P%5E%7B(1)%7D(y=1%7Cdo(x=0))%20=%20%5Cfrac%7B3%7D%7B4%7D"></p>
</section>
<section id="case-2-model-mathcalh2" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="case-2-model-mathcalh2"><span class="header-section-number">4.3.2</span> Case 2: Model <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BH%7D%5E%7B(2)%7D"></h3>
<p>구조 방정식: <img src="https://latex.codecogs.com/png.latex?Y%20%5Cleftarrow%20U_Y">. <img src="https://latex.codecogs.com/png.latex?X">의 값과 상관없이 <img src="https://latex.codecogs.com/png.latex?Y">는 <img src="https://latex.codecogs.com/png.latex?U_Y">를 따릅니다.</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?U_Y=0%20%5CRightarrow%20Y=0"></li>
<li><img src="https://latex.codecogs.com/png.latex?U_Y=1%20%5CRightarrow%20Y=1"></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%5Ctherefore%20P%5E%7B(2)%7D(y=1%7Cdo(x=0))%20=%20%5Cfrac%7B1%7D%7B2%7D"></p>
</section>
</section>
<section id="결론" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="결론"><span class="header-section-number">4.4</span> 결론</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?Y"></th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?P%5E%7B(1)%7D(Y%7Cdo(x))"></th>
<th style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?P%5E%7B(2)%7D(Y%7Cdo(x))"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B4%7D"></td>
<td style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D"></td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B3%7D%7B4%7D"></td>
<td style="text-align: center;"><img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D"></td>
</tr>
</tbody>
</table>
<p>두 모델은 <strong>동일한 인과 그래프</strong>와 <strong>동일한 관측 분포 <img src="https://latex.codecogs.com/png.latex?P(v)"></strong>를 가지지만, 계산된 인과 효과 <img src="https://latex.codecogs.com/png.latex?P(y%7Cdo(x))">는 <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B3%7D%7B4%7D">와 <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B1%7D%7B2%7D">로 서로 다릅니다</p>
<blockquote class="blockquote">
<p><strong>Even though both models induce <img src="https://latex.codecogs.com/png.latex?I"> (Graph) and have the same <img src="https://latex.codecogs.com/png.latex?P(v)">, the effect <img src="https://latex.codecogs.com/png.latex?P%5E%7B(1)%7D(y%7Cdo(x))%20%5Cneq%20P%5E%7B(2)%7D(y%7Cdo(x))">.</strong></p>
</blockquote>
<p>이는 주어진 그래프 구조(Unobserved Confounder가 존재하는 경우)만으로는 데이터에서 인과 효과를 유일하게 식별해낼 수 없음을(Non-identifiable) 의미합니다. 이러한 경우, 추가적인 가정이나 데이터를 통한 식별 전략이 필요합니다.</p>


</section>
</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-04-part-01/</guid>
  <pubDate>Tue, 06 Jan 2026 15:00:00 GMT</pubDate>
</item>
<item>
  <title>[Causal Inference] 1. Introduction</title>
  <dc:creator>유성현 </dc:creator>
  <link>https://shsha0110.github.io/posts/causal-inference-01/</link>
  <description><![CDATA[ 





<p>데이터사이언스대학원(GSDS) 이상학 교수님의 <strong>“데이터사이언스를 위한 인과추론”</strong> 강의 1강을 정리한 포스트입니다. 왜 우리가 머신러닝을 넘어 인과추론을 배워야 하는지, 그리고 그 핵심 프레임워크인 <strong>Judea Pearl의 인과 계층</strong>에 대해 다룹니다.</p>
<section id="상관관계correlation는-인과관계causation가-아니다" class="level2">
<h2 class="anchored" data-anchor-id="상관관계correlation는-인과관계causation가-아니다">1. 상관관계(Correlation)는 인과관계(Causation)가 아니다</h2>
<p>통계학 수업을 들었다면 누구나 한 번쯤 들어봤을 문장입니다. 하지만 실제 데이터 분석에서 우리는 이 함정에 너무나 쉽게 빠집니다. 강의 자료에 나온 재미있는 예시들을 살펴봅시다.</p>
<section id="자폐증과-유기농-식품-판매량" class="level3">
<h3 class="anchored" data-anchor-id="자폐증과-유기농-식품-판매량">(1) 자폐증과 유기농 식품 판매량</h3>
<p>미국 내 자폐증(Autism) 진단 수와 유기농 식품 판매량의 추이를 그린 그래프입니다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://shsha0110.github.io/posts/causal-inference-01/autism_graph.png" class="img-fluid figure-img"></p>
<figcaption>Autism vs Organic Food Sales</figcaption>
</figure>
</div>
<p>두 변수의 상관계수(<img src="https://latex.codecogs.com/png.latex?r">)는 무려 <strong>0.9971</strong>입니다. 그렇다면 유기농 식품이 자폐증의 원인일까요? 당연히 아닙니다. 단순히 시간이 흐르며 두 지표가 같이 상승했을 뿐입니다. 이를 <strong>허위 상관(Spurious Correlation)</strong>이라고 합니다.</p>
</section>
<section id="소방관이-많으면-불이-커진다" class="level3">
<h3 class="anchored" data-anchor-id="소방관이-많으면-불이-커진다">(2) 소방관이 많으면 불이 커진다?</h3>
<p>데이터를 보면 <strong>투입된 소방관의 수(<img src="https://latex.codecogs.com/png.latex?X">)</strong>와 <strong>화재의 크기(<img src="https://latex.codecogs.com/png.latex?Y">)</strong>는 아주 강한 양의 상관관계를 가집니다.</p>
<p><img src="https://latex.codecogs.com/png.latex?Y%20=%20%5Cbeta%20X%20+%20%5Cbeta_0"></p>
<p>단순 회귀분석을 돌리면 <img src="https://latex.codecogs.com/png.latex?%5Cbeta">(기울기)는 양수가 나옵니다. 그렇다면 화재 피해를 줄이기 위해 소방관을 줄여야 할까요? 상식적으로 말이 안 됩니다. 사실은 <strong>화재가 크기 때문에(Cause) 소방관이 많이 출동한 것(Effect)</strong>이거나, 건물의 크기 같은 제3의 요인이 작용했을 것입니다. 데이터(<img src="https://latex.codecogs.com/png.latex?X,%20Y">)만 봐서는 이 인과의 방향을 알 수 없습니다.</p>
<hr>
</section>
</section>
<section id="심슨의-역설-simpsons-paradox-데이터는-거짓말을-한다" class="level2">
<h2 class="anchored" data-anchor-id="심슨의-역설-simpsons-paradox-데이터는-거짓말을-한다">2. 심슨의 역설 (Simpson’s Paradox): 데이터는 거짓말을 한다</h2>
<p>가장 충격적이었던 예시는 <strong>심슨의 역설</strong>입니다. 어떤 신약(Drug)의 회복률(Recovery Rate)을 분석한 데이터입니다.</p>
<section id="상황-1-전체-데이터-total" class="level3">
<h3 class="anchored" data-anchor-id="상황-1-전체-데이터-total">상황 1: 전체 데이터 (Total)</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>회복(Y)</th>
<th>미회복(<img src="https://latex.codecogs.com/png.latex?%5Cneg%20Y">)</th>
<th>회복률(Rate)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>약 복용 (Drug)</strong></td>
<td>20</td>
<td>20</td>
<td><strong>50%</strong></td>
</tr>
<tr class="even">
<td><strong>미복용 (No Drug)</strong></td>
<td>16</td>
<td>24</td>
<td><strong>40%</strong></td>
</tr>
</tbody>
</table>
<p>전체로 보면 약을 먹었을 때 회복률이 더 높습니다(50% &gt; 40%). 의사는 약을 처방해야 할 것 같습니다.</p>
</section>
<section id="상황-2-성별로-나누어-본-데이터-stratified-by-sex" class="level3">
<h3 class="anchored" data-anchor-id="상황-2-성별로-나누어-본-데이터-stratified-by-sex">상황 2: 성별로 나누어 본 데이터 (Stratified by Sex)</h3>
<p>하지만 남성과 여성으로 데이터를 쪼개서 보면 이야기가 달라집니다.</p>
<ul>
<li><strong>남성 (Male):</strong> 약 복용(60%) &lt; 미복용(70%)</li>
<li><strong>여성 (Female):</strong> 약 복용(20%) &lt; 미복용(30%)</li>
</ul>
<p><strong>남성 그룹에서도, 여성 그룹에서도 약을 안 먹는 게 회복률이 더 높습니다.</strong> 전체 데이터에서는 약이 좋다고 하는데, 쪼개보니 약이 나쁘다고 합니다. 도대체 의사는 어떤 테이블을 믿어야 할까요?</p>
</section>
<section id="결론-인과-그래프causal-graph가-필요하다" class="level3">
<h3 class="anchored" data-anchor-id="결론-인과-그래프causal-graph가-필요하다">결론: 인과 그래프(Causal Graph)가 필요하다</h3>
<p>정답은 <strong>“데이터만으로는 알 수 없다”</strong>입니다. 성별(<img src="https://latex.codecogs.com/png.latex?F">), 약 복용(<img src="https://latex.codecogs.com/png.latex?X">), 회복(<img src="https://latex.codecogs.com/png.latex?Y">) 사이의 인과 구조가 어떻게 그려지느냐에 따라 우리가 봐야 할 테이블이 달라집니다. 이것이 바로 우리가 단순히 데이터(<img src="https://latex.codecogs.com/png.latex?P(Y%7CX)">)를 보는 것을 넘어, <strong>인과 구조(Structure)</strong>를 고민해야 하는 이유입니다.</p>
<hr>
</section>
</section>
<section id="pearl의-인과-계층-pearls-causal-hierarchy" class="level2">
<h2 class="anchored" data-anchor-id="pearl의-인과-계층-pearls-causal-hierarchy">3. Pearl의 인과 계층 (Pearl’s Causal Hierarchy)</h2>
<p>Judea Pearl은 인과추론의 수준을 세 단계의 사다리(Ladder)로 정의했습니다.</p>
<section id="level-1-관찰-association-seeing" class="level3">
<h3 class="anchored" data-anchor-id="level-1-관찰-association-seeing">Level 1: 관찰 (Association / Seeing)</h3>
<ul>
<li><strong>질문:</strong> “What is?” (만약 <img src="https://latex.codecogs.com/png.latex?X">를 본다면, <img src="https://latex.codecogs.com/png.latex?Y">는 어떨까?)</li>
<li><strong>수식:</strong> <img src="https://latex.codecogs.com/png.latex?P(y%7Cx)"></li>
<li><strong>특징:</strong> 기존의 머신러닝(Deep Learning, Decision Tree 등)이 가장 잘하는 영역입니다. 데이터의 상관성을 파악합니다.</li>
</ul>
</section>
<section id="level-2-개입-intervention-doing" class="level3">
<h3 class="anchored" data-anchor-id="level-2-개입-intervention-doing">Level 2: 개입 (Intervention / Doing)</h3>
<ul>
<li><strong>질문:</strong> “What if I do?” (만약 내가 <img src="https://latex.codecogs.com/png.latex?X">를 강제로 시킨다면, <img src="https://latex.codecogs.com/png.latex?Y">는 어떻게 될까?)</li>
<li><strong>수식:</strong> <img src="https://latex.codecogs.com/png.latex?P(y%20%7C%20do(x))"></li>
<li><strong>특징:</strong> 여기서부터 진짜 인과추론의 영역입니다. 단순히 <img src="https://latex.codecogs.com/png.latex?X">를 관찰하는 것(<img src="https://latex.codecogs.com/png.latex?x">)과, 실험자가 개입하여 값을 바꾸는 것(<img src="https://latex.codecogs.com/png.latex?do(x)">)은 다릅니다. 강화학습(RL)이나 A/B 테스트가 여기에 속합니다.</li>
</ul>
</section>
<section id="level-3-반사실-counterfactuals-imagining" class="level3">
<h3 class="anchored" data-anchor-id="level-3-반사실-counterfactuals-imagining">Level 3: 반사실 (Counterfactuals / Imagining)</h3>
<ul>
<li><strong>질문:</strong> “What if I had acted differently?” (그때 내가 다른 선택을 했더라면, 결과는 달라졌을까?)</li>
<li><strong>수식:</strong> <img src="https://latex.codecogs.com/png.latex?P(y_x%20%7C%20x',%20y')"></li>
<li><strong>특징:</strong> 이미 일어난 일(<img src="https://latex.codecogs.com/png.latex?x',%20y'">)을 바탕으로, 일어나지 않은 가상의 세계(<img src="https://latex.codecogs.com/png.latex?y_x">)를 추론합니다. 인간만이 가진 고도의 추론 능력인 회고(Retrospection)와 상상(Imagining)의 영역입니다.</li>
</ul>
<hr>
</section>
</section>
<section id="마치며" class="level2">
<h2 class="anchored" data-anchor-id="마치며">4. 마치며</h2>
<p>기존의 머신러닝은 <strong>Level 1 (Association)</strong>에 머물러 있었습니다. 하지만 진정한 지능(Intelligent Agent)이나 정책 결정(Policy Making)을 위해서는 <strong>Level 2, 3</strong>의 추론이 필수적입니다. 이번 강의를 통해 단순히 데이터를 예측(Prediction)하는 것을 넘어, 세상의 작동 원리(Mechanism)를 이해하는 인과추론의 세계로 나아가고자 합니다.</p>
<p><strong>Reference:</strong> * Prof.&nbsp;Sanghack Lee, <em>Causal Inference for Data Science</em>, GSDS SNU. * Judea Pearl et al., <em>Causal Inference in Statistics: A Primer</em>.</p>


</section>

 ]]></description>
  <category>Causal Inference</category>
  <guid>https://shsha0110.github.io/posts/causal-inference-01/</guid>
  <pubDate>Mon, 05 Jan 2026 15:00:00 GMT</pubDate>
  <media:content url="https://shsha0110.github.io/posts/causal-inference-01/image.png" medium="image" type="image/png" height="63" width="144"/>
</item>
</channel>
</rss>
