---
title: "점 추정을 넘어 구간 추정으로: 인과추론의 불확실성을 다루는 법"
subtitle: "Paper Review: Conformal inference of counterfactuals and individual treatment effects (Section 2)"
author: "Reviewer"
date: "2026-01-22"
categories: [Causal Inference, Statistics, Uncertainty Quantification]
format:
  html:
    toc: true
    number-sections: true
    math: true
---

## 들어가며

이전 포스트에서는 왜 우리가 '평균'을 넘어 '개인'에 집중해야 하는지 살펴보았습니다. 이번 포스트(Section 2)에서는 이를 수학적으로 정식화(Formalization)하고, 기존의 **점 추정(Point Estimate)** 방식이 왜 불확실성을 담아내기에 부족한지, 그리고 우리가 목표로 하는 **구간 추정(Interval Estimate)**의 정의가 무엇인지 구체적으로 파고들어 보겠습니다.

---

## 문제 설정 (Problem Setup)

### 잠재적 결과 프레임워크 (Potential Outcome Framework)

논문은 Neyman(1923)과 Rubin(1974)이 정립한 **잠재적 결과 프레임워크**를 따릅니다. $n$명의 대상에 대해 다음과 같은 변수들을 정의합니다.

* $T_i \in \{0, 1\}$: 이진 처치 변수 (Treatment Indicator). (예: 1=약 복용, 0=미복용)
* $(Y_i(1), Y_i(0))$: 잠재적 결과 쌍.
    * $Y_i(1)$: 처치를 받았을 때의 결과.
    * $Y_i(0)$: 처치를 받지 않았을 때의 결과.
* $X_i$: 공변량 벡터 (Covariates, 예: 나이, 성별, 혈압 등).

우리는 데이터가 **I.I.D. (Independent and Identically Distributed)** 가정하에 생성된다고 봅니다.

$$
(Y_i(1), Y_i(0), T_i, X_i) \stackrel{i.i.d}{\sim} (Y(1), Y(0), T, X)
$$

### 관측된 데이터와 ITE의 정의

현실에서는 **SUTVA(Stable Unit Treatment Value Assumption)** 가정하에, 각 개인에 대해 오직 하나의 결과만 관측됩니다. 이를 **관측된 결과(Observed Outcome, $Y_i^{obs}$)**라고 합니다.

$$
Y_i^{obs} = \begin{cases} 
Y_i(1) & \text{if } T_i = 1 \\ 
Y_i(0) & \text{if } T_i = 0 
\end{cases}
$$

우리가 알고 싶은 **개별 처치 효과(ITE, Individual Treatment Effect)** $\tau_i$는 다음과 같이 정의됩니다.

$$
\tau_i \triangleq Y_i(1) - Y_i(0)
$$

**핵심 문제:** 정의상, 우리는 $Y_i(1)$과 $Y_i(0)$ 중 하나만 관측할 수 있습니다. 나머지 하나는 결측(Missing)됩니다. 따라서 ITE는 관측 불가능하며(Unobserved), 오직 추론만 가능합니다.

### 강력한 무시 가능성 (Strong Ignorability)

이 논문은 분석을 위해 **강력한 무시 가능성(Strong Ignorability)** 가정을 사용합니다.

$$
(Y(1), Y(0)) \perp T \mid X
$$

이는 공변량 $X$가 주어졌을 때, 처치 할당($T$)이 잠재적 결과와 독립적이라는 뜻입니다. 즉, 측정되지 않은 교란 변수(Unmeasured Confounders)가 없음을 의미합니다.

![Image: strong_ignorability_dag.png]
*Figure 1: 강력한 무시 가능성을 나타내는 인과 다이어그램(DAG). X가 주어졌을 때 T와 Y(t) 사이에는 직접적인 연결(Confounder)이 없다.*

---

## 기존의 추론 목표: CATE와 그 한계

### CATE의 정의 및 유도

기존 연구들은 대부분 **조건부 평균 처치 효과(CATE)** $\tau(x)$를 추정하는 데 집중했습니다.

$$
\tau(x) \triangleq \mathbb{E}[Y(1) - Y(0) \mid X = x]
$$

이를 분해하면 두 조건부 평균 함수 $m_1(x)$와 $m_0(x)$의 차이로 표현할 수 있습니다.

$$
\begin{align}
\tau(x) &= \mathbb{E}[Y(1) \mid X=x] - \mathbb{E}[Y(0) \mid X=x] \\
        &= m_1(x) - m_0(x)
\end{align}
$$

**[수학적 유도: 관측 데이터로의 연결]**
강력한 무시 가능성 가정($(Y(1), Y(0)) \perp T \mid X$) 덕분에, 우리는 잠재적 결과의 평균을 관측된 데이터의 평균으로 대체할 수 있습니다.

$$
\begin{align}
m_1(x) &= \mathbb{E}[Y(1) \mid X=x] \\
       &= \mathbb{E}[Y(1) \mid X=x, T=1] \quad (\because \text{Ignorability}) \\
       &= \mathbb{E}[Y^{obs} \mid X=x, T=1]
\end{align}
$$

마찬가지로 $m_0(x) = \mathbb{E}[Y^{obs} \mid X=x, T=0]$ 입니다. 이로써 인과 추론 문제는 통계적 회귀(Regression) 문제가 됩니다.

### CATE의 한계

1.  **불확실성 과소평가:** 고차원 회귀 함수($m(x)$) 주변의 신뢰대(Confidence Band)를 만드는 것은 매우 까다롭습니다. 일반적인 근사법이나 리샘플링 기법은 변동성을 과소평가하는 경향이 있습니다.
2.  **분위수(Quantile)의 혼동:** 평균 대신 분위수를 사용하는 **CQTE(Conditional Quantile Treatment Effect)**를 고려할 수도 있습니다. 하지만 주의해야 할 점은 **"차이의 분위수(Quantile of Difference)"**와 **"분위수의 차이(Difference of Quantiles)"**는 전혀 다르다는 것입니다.
    * 우리가 알고 싶은 것: Quantile of $(Y(1) - Y(0))$
    * CQTE: Quantile$(Y(1))$ - Quantile$(Y(0))$
    * 전자는 $Y(1)$과 $Y(0)$의 결합 분포(Joint Distribution)를 알아야만 식별 가능한데, 이는 관측이 불가능합니다.

---

## 새로운 목표: 구간 추정 (Interval Estimates)

### 커버리지(Coverage) 기준

이 연구의 목표는 단순히 점 값을 맞추는 것이 아니라, 실제 값(ITE 혹은 잠재적 결과)을 포함할 확률이 보장되는 **예측 구간(Prediction Interval)**을 만드는 것입니다.

예를 들어, $Y(1)$에 대한 예측 구간 $\hat{C}_1(X)$는 다음을 만족해야 합니다. (사전에 지정된 레벨 $\alpha$에 대해)

$$
\mathbb{P}(Y(1) \in \hat{C}_1(X)) \ge 1 - \alpha
$$

마찬가지로, ITE인 $Y(1)-Y(0)$에 대한 구간 $\hat{C}_{ITE}(X)$는 다음을 만족해야 합니다.

$$
\mathbb{P}(Y(1) - Y(0) \in \hat{C}_{ITE}(X)) \ge 1 - \alpha
$$

![Image: prediction_interval_concept.png]
*Figure 2: 점 추정(Point Estimate) vs 구간 추정(Interval Estimate). 점 추정은 하나의 선으로 나타나지만, 구간 추정은 데이터가 포함될 범위를 띠(Band) 형태로 제공하여 불확실성을 시각화한다.*

### 오라클(Oracle) 구간과 현실

만약 우리가 $Y(1)$의 조건부 분포를 완벽하게 안다면, 참 분위수(True Quantiles) $q_{\beta}(x)$를 이용해 최적의 구간을 만들 수 있습니다.

$$
C_1(x) = [q_{\alpha/2}(x), q_{1-\alpha/2}(x)]
$$

하지만 현실에서는 제한된 샘플 크기와 모델 불확실성 때문에 참 분위수를 알 수 없습니다. 이를 추정치로 대체하면 커버리지를 보장하기 어렵습니다. 저자들은 Conformal Inference를 통해 이 문제를 해결하고자 합니다.

---

## 일반화된 커버리지 기준 (General Coverage Criteria)

### ATE vs ATT

전통적인 인과추론에서는 전체 평균(ATE)보다 **처치군 평균 처치 효과(ATT, Average Treatment Effect on the Treated)**를 선호하는 경우가 많습니다.

$$
\text{ATT} = \mathbb{E}[Y(1) - Y(0) \mid T=1]
$$

이에 맞춰 커버리지 기준도 조건부 확률로 수정할 수 있습니다.

$$
\mathbb{P}(Y(t) \in \hat{C}_t(X) \mid T=1) \ge 1 - \alpha
$$

이는 $X$의 분포를 모집단 전체가 아닌, 처치를 받은 집단($T=1$)의 분포로 한정하여 평가하겠다는 의미입니다.

### 일반화 (Transportability)

더 나아가, 연구 대상 집단(Study Population)과 우리가 결과를 적용하고자 하는 타겟 집단(Target Population)이 다를 수 있습니다 (Covariate Shift). 이를 위해 저자들은 타겟 분포 $Q_X$를 도입한 일반화된 커버리지 기준을 제안합니다.

$$
\mathbb{P}_{(X, Y(t)) \sim Q_X \times P_{Y(t)|X}} (Y(t) \in \hat{C}_t(X)) \ge 1 - \alpha
$$

* $Q_X$: 타겟 집단의 공변량 분포.
* 이 식은 $Q_X$를 어떻게 설정하느냐에 따라 전체 인구(ATE 관점), 처치군(ATT 관점), 혹은 완전히 새로운 외부 집단(Generalizability/External Validity)에 대한 구간 추정을 모두 포괄합니다.

---

## 요약

Section 2에서는 CATE와 같은 점 추정치가 가진 불확실성 표현의 한계를 지적하고, 이를 극복하기 위해 **ITE에 대한 유효한 예측 구간**을 생성하는 것을 목표로 설정했습니다.

* **기존:** $E[Y(1)-Y(0)|X]$ (평균) 추정에 집중 -> 불확실성 정보 부족.
* **제안:** $P(Y(1)-Y(0) \in C(X)) \ge 1-\alpha$ (구간) 생성에 집중 -> 리스크 관리 가능.

다음 섹션(Section 3)부터는 실제로 관측된 데이터(Observables)를 이용해 어떻게 관측되지 않은 반사실적 결과(Counterfactuals)의 구간을 만들어낼지 구체적인 방법론을 다루게 됩니다.

***
**Reference:**
Lei, L., & Candès, E. J. (2021). Conformal inference of counterfactuals and individual treatment effects. [cite_start]*Journal of the Royal Statistical Society: Series B (Statistical Methodology)*, 83(5), 911-938. [cite: 107, 108]