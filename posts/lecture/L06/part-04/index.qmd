---
title: "[Causal Inference] 06. The Causal Calculus (Part 4)"
description: "Back to Simpson’s Paradox"
author: "유성현"
date: "2026-01-23"
categories: [Causal Inference]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# 1. Introduction

통계학을 공부하다 보면 직관과 데이터가 충돌하는 순간을 마주하게 됩니다. 가장 대표적인 예가 바로 **심슨의 역설(Simpson's Paradox)**입니다. 이는 부분 집합에서 나타나는 경향성이 데이터를 전체로 합쳤을 때 반전되는 현상을 말합니다.

[cite_start]초기 통계학자인 Karl Pearson은 이를 두고 "이질적인 그룹들이 섞여 있을 때 발생하는 가짜 상관관계(spurious correlation)"라고 표현하며 충격을 받았습니다[cite: 728, 731]. 하지만 Judea Pearl은 이 역설이 단순한 통계적 오류가 아니라, **인과적 구조(Causal Structure)를 무시한 채 데이터만 해석하려 할 때 발생하는 문제**라고 주장합니다.

이번 포스트에서는 심슨의 역설을 `do-operator`를 통해 수학적으로 해결(dissolve)하고, 인과추론이 왜 데이터 과학의 필수적인 도구인지 확인해 보겠습니다.

# 2. The Anatomy of the Paradox

심슨의 역설을 이해하기 위해 가상의 약물 치료 실험 데이터를 살펴보겠습니다. 목표는 약물(Drug, $X$)이 회복(Recovery, $Y$)에 도움이 되는지 판단하는 것입니다.

## 2.1. The Data: Statistical Reversal

[cite_start]다음은 전체 환자(Total)와 성별(Male/Female, $F$)로 나누어 본 회복률 데이터입니다[cite: 742, 746, 747].

| Group | Treatment ($X$) | Recovery ($Y=1$) | Rate ($P(Y|X)$) |
| :--- | :--- | :--- | :--- |
| **Total** | Drug | 20 / 40 | **50%** |
| | No Drug | 16 / 40 | 40% |
| **Male ($\neg F$)** | Drug | 18 / 30 | 60% |
| | No Drug | 7 / 10 | **70%** |
| **Female ($F$)** | Drug | 2 / 10 | 20% |
| | No Drug | 9 / 30 | **30%** |

여기서 충격적인 모순이 발생합니다.
* **전체 데이터:** 약물을 복용한 집단의 회복률(50%)이 복용하지 않은 집단(40%)보다 높습니다. ($P(Y|X) > P(Y|\neg X)$)
* **부분 데이터:** 남성과 여성 그룹 각각을 보면, 약물을 복용하지 않은 쪽의 회복률이 더 높습니다.
    * 남성: $P(Y|\neg F, X) < P(Y|\neg F, \neg X)$ (60% vs 70%)
    * 여성: $P(Y|F, X) < P(Y|F, \neg X)$ (20% vs 30%)

우리는 약을 써야 할까요, 말아야 할까요? [cite_start]남성에게도 해롭고 여성에게도 해로운 약이, 어떻게 전체 인류에게는 유익할 수 있을까요? [cite: 743-745]

## 2.2. Why This Happens
이 현상은 우리가 "본 것(Seeing)"과 "하는 것(Doing)"을 혼동하기 때문에 발생합니다. [cite_start]위 데이터에서 $X$와 $Y$는 단순한 사건(Events)으로 취급되었습니다[cite: 754]. 성별($F$)이 약물 복용 여부($X$)와 회복률($Y$) 모두에 영향을 미치는 교란 변수(Confounder)로 작용하여, 약물 복용 집단의 분포를 왜곡시킨 것입니다. (예: 회복력이 좋은 남성들이 약물을 더 많이 복용함)

# 3. Dissolving the Paradox with Do-Calculus

이 역설을 해결하기 위해서는 관측된 조건부 확률 $P(Y|X)$가 아니라, 개입에 의한 인과 효과 $P(Y|do(X))$를 비교해야 합니다.

## 3.1. The Inequality Flip
Do-notation을 사용하여 질문을 다시 쓰면 역설은 사라집니다. [cite_start]만약 각 하위 그룹(성별)에서 약물이 해롭다면, 전체 인구에 대해서도 약물 복용($do(X)$)이 약물 비복용($do(\neg X)$)보다 해로워야 합니다[cite: 760, 768].

$$
\text{If } \begin{cases} P(Y|F, do(X)) < P(Y|F, do(\neg X)) \\ P(Y|\neg F, do(X)) < P(Y|\neg F, do(\neg X)) \end{cases}
$$
$$
\text{Then, it must hold that: } P(Y|do(X)) < P(Y|do(\neg X))
$$

[cite_start]즉, 인과적 관점($do$-calculus)에서는 "부분의 합이 전체와 모순되는" 반전(Reversal)이 발생하지 않습니다[cite: 789].

## 3.2. Mathematical Proof

이를 수학적으로 증명해 봅시다. 우리는 전체 인과 효과 $P(y|do(x))$를 계산하기 위해 성별 $F$를 조정(adjustment)해야 합니다.

![Figure 1: 심슨의 역설을 설명하는 인과 그래프. 성별(F)은 약물 복용(X)과 회복(Y) 모두에 영향을 미치는 교란 요인(Confounder)입니다. X에서 Y로 가는 인과 효과를 올바르게 추정하기 위해서는 F로 인한 Back-door path를 차단해야 합니다.](./images/simpsons_paradox_graph.png)

[cite_start]Do-Calculus의 규칙과 전확률의 법칙(Law of Total Probability)을 사용하면 다음과 같이 유도됩니다[cite: 774].

$$
\begin{aligned}
P(y|do(x)) &= \sum_{f} P(y|do(x), f) P(f|do(x)) \\
&= \sum_{f} P(y|x, f) P(f)
\end{aligned}
$$

**유도 단계 설명:**
1.  **Rule 2 (Action to Observation):** $f$가 주어졌을 때 $x$와 $y$ 사이의 Back-door path가 차단되므로, $P(y|do(x), f) = P(y|x, f)$가 됩니다. 즉, 성별이 같은 그룹 내에서는 관측된 효과가 곧 인과 효과입니다.
2.  **Rule 3 (Deleting Action):** 성별($F$)은 약물 복용($X$)보다 먼저 결정되므로, 약물 복용에 개입한다고 해서 성별의 분포가 바뀌지 않습니다. 따라서 $P(f|do(x)) = P(f)$입니다.

**결론:**
이 공식($\sum P(y|x, f)P(f)$)은 각 그룹의 회복률($P(y|x, f)$)을, 약물 복용 여부에 편향되지 않은 **전체 인구의 성비($P(f)$)**로 가중 평균을 냅니다. 이렇게 하면 데이터의 불균형이 보정되어, 부분 그룹의 경향성(약물이 해롭다)이 전체 결과에도 그대로 반영됩니다.

# 4. The Sure Thing Principle

[cite_start]심슨의 역설의 해결은 Savage(1972)가 제창한 **Sure Thing Principle**과 맞닿아 있습니다[cite: 781].

> [cite_start]"만약 어떤 행동 $X$가 모든 하위 집단에서 사건 $Y$의 확률을 증가시킨다면, 그 행동은 전체 집단에서도 $Y$의 확률을 증가시켜야 한다. **단, 그 행동이 하위 집단의 분포를 변화시키지 않는다면.**" [cite: 784]

여기서 중요한 단서는 **"행동이 하위 집단의 분포를 변화시키지 않는다"**는 점입니다.
* 단순 관측 $P(Y|X)$에서는 $X$의 값에 따라 $F$의 분포가 달라집니다(예: 약을 먹은 그룹에 남자가 더 많음). 따라서 원칙이 적용되지 않고 역설이 발생할 수 있습니다.
* 개입 $P(Y|do(X))$에서는 $do(X)$가 $F$의 분포 $P(F)$를 변화시키지 않으므로($P(F|do(x)) = P(F)$), Sure Thing Principle이 성립하여 역설이 사라집니다.

# 5. Food for Thought: The Napkin Graph

[cite_start]강의의 마지막에는 흥미로운 도전 과제인 **Napkin Graph**가 제시됩니다[cite: 798].

![Figure 2: The Napkin Graph. 복잡한 인과 구조를 가진 그래프로, W는 두 개의 점선(양방향 화살표, 잠재적 교란 요인)의 충돌(Collider) 지점에 위치하며, Z와 X, Y가 얽혀 있습니다. 이 그래프에서 P(y|do(x))가 식별 가능한지가 문제입니다.](./images/napkin_graph.png)

**문제:** 위 Napkin Graph 구조에서 관측 데이터 $P(v)$만으로 인과 효과 $P(y|do(x))$를 식별(Identification)할 수 있을까요?

이 문제는 단순히 Back-door나 Front-door 기준만으로는 풀기 어려운 복잡한 구조를 가지고 있습니다. 하지만 Do-Calculus의 규칙들을 체계적으로 적용하거나, c-component 분해 알고리즘을 사용하면 식별 가능성을 판별할 수 있습니다. (정답은 독자 여러분의 연습 문제로 남겨둡니다!)

# 6. Summary of the Series

지금까지 우리는 Causal Calculus의 여정을 함께했습니다.

1.  [cite_start]**Do-Calculus의 필요성:** 정책 평가나 개입의 효과를 분석하기 위해 구문론적(syntactical) 접근이 필요합니다[cite: 793].
2.  [cite_start]**식별 문제의 해결:** 교란(Confounding)과 식별(Identification) 문제는 Do-Calculus를 통해 비모수적(non-parametrically)으로 완전히 해결되었습니다[cite: 794].
3.  [cite_start]**심슨의 역설 해결:** 역설은 수학적으로 정식화되었으며, 인과적 관점에서 해소되었습니다[cite: 795].

[cite_start]인과추론은 이제 사회과학, 보건학뿐만 아니라 머신러닝과 AI의 공정성(fairness) 문제를 다루는 핵심 도구가 되었습니다[cite: 796].

---

### 누락 방지 검증 체크리스트

* **포함된 내용:**
    * [x] **심슨의 역설 정의 및 역사:** Pearson의 "Spurious Correlation" 발언 및 역사적 배경.
    * [x] **구체적 예시:** UC Berkeley 및 약물/회복 테이블 데이터(Aggregated vs Segregated rates) 수치 포함.
    * [x] **역설의 핵심 모순:** 부등식의 역전 현상 ($P(Y|X)$ vs $P(Y|do(X))$) 명시.
    * [x] **해결 과정 (Dissolving):** Do-notation 도입 및 조건부 확률과 개입 확률의 차이 설명.
    * [x] **수학적 증명:** $P(y|do(x))$의 유도 과정 (Back-door adjustment 형태) 및 각 단계($P(f|do(x))=P(f)$ 등)의 근거.
    * [x] **Sure Thing Principle:** Savage의 정의 및 "하위 집단 분포 불변" 조건의 중요성 설명.
    * [x] **Napkin Graph:** "Food for Thought"로 제시된 그래프 구조 및 식별 문제 소개.
    * [x] **요약:** 강의 전체(Do-calculus, Identification, Applications)에 대한 요약.
    * [x] **이미지:** 테이블 데이터, 인과 그래프, Napkin Graph에 대한 태그 포함.

* **생략된 내용:**
    * 없음. 제공된 PDF 페이지 29~39의 모든 내용을 포괄함.