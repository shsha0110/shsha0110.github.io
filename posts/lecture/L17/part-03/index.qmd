---
title: "[Causal Inference] Transportability & External Validity"
description: "How to Generalize Causal Findings Across Environments using Selection Diagrams"
author: "유성현"
date: "2026-01-25"
categories: [Causal Inference, Data Science, Methodology]
format:
  html:
    toc: true
    number-sections: false
    code-fold: show
    math: true
---

# 1. Introduction: Moving from Lab to Real-World

[cite_start]데이터 과학과 인과 추론에서 가장 빈번하면서도 어려운 질문 중 하나는 **"어떤 환경(Source)에서 얻은 지식을 다른 환경(Target)에 적용할 수 있는가?"**입니다[cite: 1512].

예를 들어:
* [cite_start]미국의 교육 정책 효과를 한국에 그대로 적용할 수 있는가? [cite: 1513]
* [cite_start]LA에서 수행된 임상 시험 결과를 NYC의 환자들에게 적용할 수 있는가? [cite: 1594]
* [cite_start]통제된 실험실 환경(Lab)의 로봇 학습 데이터를 실제 도로(Real-World)에 쓸 수 있는가? [cite: 1524]

[cite_start]이 문제는 사회과학에서는 **외부 타당성(External Validity)**, 통계학에서는 **일반화(Generalizability)**, 머신러닝에서는 **도메인 적응(Domain Adaptation)** 등으로 불려왔습니다 [cite: 1517-1521].

**Causal Data Science**는 이 문제를 **Transportability(이송 가능성)**라는 수학적 프레임워크로 정의하고, **Selection Diagram**이라는 도구를 통해 데이터가 언제, 어떻게 이송 가능한지를 공식화합니다.

---

# 2. The Transportability Problem

우리의 목표는 Source Domain($\Pi$)에서 수집된 관찰($P$) 및 실험($P(y|do(x))$) 데이터를 사용하여, Target Domain($\Pi^*$)에서의 인과 효과 $Q = P^*(y|do(x))$를 계산하는 것입니다.

### 2.1. Trivial vs. Non-Trivial Cases
가장 단순한 가정($H_0$)은 Source와 Target의 모든 조건이 동일하다는 것입니다. [cite_start]이 경우 결과는 자명하게 이송 가능합니다(Trivially Transportable) [cite: 1543-1544].

하지만 현실($H_a$)에서는 두 도메인 간에 차이가 존재합니다.
* **분포의 차이:** $f_z \neq f^*_z$ (예: LA와 NYC의 연령 분포가 다름)
* **메커니즘의 차이:** $f_y \neq f^*_y$ (예: 동일한 치료제라도 인종적 특성에 따라 반응률이 다름)

![Figure 1: Source Domain과 Target Domain의 차이. 모든 구조적 방정식(Structural Equations) f가 동일하다면(H0) 문제는 간단하지만, 현실(Ha)에서는 변수들의 분포나 메커니즘이 다르다. 이를 'Spectrum'으로 표현할 수 있다.](./images/transportability_spectrum.png)

[cite_start]위 그림(Figure 1)은 Source와 Target 사이에 구조적 불일치가 존재할 때, 단순한 데이터 결합이 불가능함을 보여줍니다 [cite: 1570-1592].

---

# 3. Selection Diagrams: Encoding Differences

[cite_start]도메인 간의 차이를 체계적으로 표현하기 위해 Pearl과 Bareinboim은 **Selection Diagram**을 도입했습니다 [cite: 1671-1689].

### Definition
Selection Diagram은 기존의 Causal Graph $G$에 **Selection Node ($S$)**를 추가한 확장된 그래프입니다.
* **Selection Node (ㅁ, Yellow Square):** 특정 변수의 메커니즘이 도메인 간에 차이가 있음을 나타냅니다.
* 만약 변수 $V$에 대해 $f_V \neq f^*_V$라면, $S \to V$ 화살표를 추가합니다.
* 반대로, $S$가 가리키지 않는 변수는 도메인 간에 메커니즘이 동일(Invariant)하다고 가정합니다.

![Figure 2: Selection Diagram의 예시. 상단 그래프(G)는 일반적인 인과 그래프이고, 하단 우측 그래프(D)는 Selection Diagram이다. Z와 Y에 노란색 사각형(Selection Node)이 화살표를 보내고 있다. 이는 Z의 분포와 Y를 결정하는 메커니즘이 도메인 간에 다르다는 것을 의미한다. 반면 X와 W는 Selection Node가 없으므로 두 도메인에서 동일한 메커니즘을 가진다.](./images/selection_diagram_definition.png)

---

# 4. Deriving Transport Formulas

Selection Diagram을 사용하면, 타겟 도메인의 데이터를 사용하지 않고도(혹은 일부만 사용하여) 타겟의 인과 효과를 계산하는 **Transport Formula**를 유도할 수 있습니다. [cite_start]그래프 구조(Causal Story)에 따라 공식이 달라지는 세 가지 사례를 살펴보겠습니다 [cite: 1623-1670].

![Figure 3: 세 가지 다른 인과 구조에 따른 Transportability. (a) Z가 교란 변수(Confounder)인 경우, (b) Z가 결과의 결과(Outcome's outcome)인 경우, (c) Z가 매개 변수(Mediator)인 경우. 각 경우마다 Selection Node(노란색 사각형)의 위치가 다르며, 이에 따라 유도되는 공식도 다르다.](./images/three_transportability_cases.png)

### Case (a): Z represents Age (Confounder)
* **Scenario:** $Z$(나이)는 $X$(치료)와 $Y$(결과) 모두에 영향을 미치는 교란 요인입니다. 나이 분포($P(z)$)는 도메인마다 다릅니다($S \to Z$).
* **Formula:**
    $$P^*(y|do(x)) = \sum_{z} P(y|do(x), z) P^*(z)$$
* **Interpretation:** Source에서 $Z$별 인과 효과($P(y|do(x),z)$)를 구한 뒤, 이를 Target의 나이 분포($P^*(z)$)에 맞춰 가중 평균(Re-weighting)합니다. 이것이 표준적인 **Adjustment Formula**입니다.

### Case (b): Z represents Language Skill (Proxy)
* **Scenario:** $Z$(언어 능력)는 $Y$의 결과물일 뿐, $X$나 $Y$의 원인이 아닙니다. $Z$의 메커니즘이 도메인마다 다릅니다.
* **Formula:**
    $$P^*(y|do(x)) = P(y|do(x))$$
* **Interpretation:** $Z$는 인과 경로에 개입하지 않으므로, $Z$의 차이는 $X \to Y$ 효과에 영향을 주지 않습니다. 즉, Source의 결과를 그대로 Target에 적용할 수 있습니다.

### Case (c): Z represents Bio-marker (Mediator)
* **Scenario:** $Z$는 $X$와 $Y$ 사이의 매개 변수입니다. $X$가 $Z$에 미치는 영향은 동일하지만, $Z$의 기저 분포나 측정 방식이 다를 수 있습니다($S \to Z$).
* **Formula:**
    $$P^*(y|do(x)) = \sum_{z} P(y|do(x), z) P^*(z|x)$$
* **Interpretation:** $X \to Z$ 메커니즘이 다르다면, Target 도메인에서의 조건부 확률 $P^*(z|x)$ 정보를 사용하여 보정해야 합니다.

---

# 5. General Transportability: Data Fusion from Multiple Domains

[cite_start]더 복잡한 시나리오는 여러 Source Domain($\Pi^a, \Pi^b, \dots$)에서 부분적인 실험 데이터만 존재할 때, 이를 결합(Data Fusion)하여 Target($\Pi^*$)을 추론하는 것입니다 [cite: 1734-1774].

### Motivation: The LA & NYC Example
* **Target:** $Q = P^*(y|do(x))$
* **Source A (LA):** $X$에 대한 실험 가능. 하지만 $Z \to Y$ 메커니즘이 Target과 다름.
* **Source B (NYC):** $Z$에 대한 실험 가능. 하지만 $X \to Z$ 메커니즘이 Target과 다름.

![Figure 4: 다중 도메인 데이터 융합(Data Fusion). 좌측 그래프는 Source A(LA)로 Z->Y 메커니즘에 차이가 있고(Selection Node on Y), 우측 그래프는 Source B(NYC)로 X->Z 메커니즘에 차이가 있다(Selection Node on Z). 목표는 이 두 불완전한 소스를 결합하여 Target의 효과를 추정하는 것이다.](./images/multi_domain_fusion.png)

### Derivation Steps
우리는 **do-calculus**를 사용하여 Target Query를 Source들의 조합으로 변환합니다.

1.  **Definition & c-component Decomposition:**
    $$P^*(y|do(x)) = \sum_z P^*(y|do(x), z) P^*(z|do(x))$$
    그래프 구조상 $P^*(y|do(x), z) = P^*(y|do(z))$ (Rule 2), $P^*(z|do(x)) = P^*(z|x)$ (Rule 2) 등을 적용합니다.

2.  **Mapping to Sources:**
    * Target의 $Z \to Y$ 관계($P^*(y|do(z))$)는 Source B(NYC)와 공유됩니다(Source A는 $Y$에 Selection Node가 있어 불가).
        $$\rightarrow P^{(b)}(y|do(z))$$
    * Target의 $X \to Z$ 관계($P^*(z|do(x))$)는 Source A(LA)와 공유됩니다(Source B는 $Z$에 Selection Node가 있어 불가).
        $$\rightarrow P^{(a)}(z|do(x))$$

3.  **Final Transport Formula:**
    $$P^*(y|do(x)) = \sum_{z} P^{(b)}(y|do(z)) P^{(a)}(z|do(x))$$

이 공식은 **LA에서 얻은 $X$의 효과**와 **NYC에서 얻은 $Z$의 효과**를 수학적으로 결합하여, **두 도시 어디에서도 직접 실험하지 않은 전체 인과 효과**를 계산해 낸 것입니다.

---

# 6. Conclusion: Is the Gold Standard Golden?

무작위 대조군 실험(RCT)은 인과 추론의 "Gold Standard"로 여겨집니다. [cite_start]하지만 Transportability 이론은 RCT조차 완벽하지 않음을 시사합니다 [cite: 1775-1802].

![Figure 5: RCT의 한계. 랜덤화(Randomization)는 X로 들어오는 화살표를 제거(우측 그래프)하여 교란을 없애주지만, 환경적 차이를 나타내는 Selection Node(상단 노란 사각형)는 제거하지 못한다. 즉, RCT는 내부 타당성(Internal Validity)만 보장할 뿐, 외부 타당성(External Validity)은 별도의 문제이다.](./images/rct_limitations.png)

* [cite_start]**Lesson:** 완벽한 RCT 데이터가 있더라도, 모집단 간의 차이(Selection Node)가 존재한다면 반드시 **Transportability Exercise**를 거쳐야 합니다 [cite: 1800-1801].
* **Completeness:** 다행히도, Selection Diagram과 do-calculus를 이용한 이송 알고리즘은 **완전(Complete)**합니다. [cite_start]즉, 이 방법으로 이송 공식을 유도할 수 없다면, 해당 데이터만으로는 이론적으로 타겟 효과를 식별할 수 없음이 증명된 것입니다[cite: 1806].

---

### **Appendix: Verification Checklist**

* **포함된 내용:**
    * [x] Transportability의 정의 및 필요성 (Shadish et al., Manski 인용)
    * [x] Source vs Target Domain의 차이 ($H_0$ vs $H_a$)
    * [x] Selection Diagram의 정의 및 Selection Node ($\square \to V$) 설명
    * [x] 3가지 케이스(Age, Language, Bio-marker)에 따른 Transport Formula 유도 및 해석
    * [x] 다중 도메인(LA, NYC)에서의 Data Fusion 예시 및 수식 유도
    * [x] RCT의 한계("Is the Gold Standard Golden?")와 Transportability의 필요성
    * [x] Transportability 알고리즘의 Completeness 언급
    * [x] 주요 수식 LaTeX 처리 및 Figure Placeholder 삽입

* **생략된 내용:**
    * Slide 28의 복잡한 알고리즘 의사코드(Pseudocode)는 텍스트로 설명하기보다 핵심 원리(Factorization & Mapping) 위주로 서술함.
    * Meta-Analysis의 구체적인 통계적 기법은 다루지 않고, Transportability가 그 이론적 배경이 된다는 점만 언급함(Slide 33 참조).